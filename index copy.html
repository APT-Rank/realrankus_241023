<!DOCTYPE html>
<html lang="ko">
  <head>
    <!-- Google Tag Manager -->
    <script>
      (function (w, d, s, l, i) {
        w[l] = w[l] || [];
        w[l].push({ "gtm.start": new Date().getTime(), event: "gtm.js" });
        var f = d.getElementsByTagName(s)[0],
          j = d.createElement(s),
          dl = l != "dataLayer" ? "&l=" + l : "";
        j.async = true;
        j.src = "https://www.googletagmanager.com/gtm.js?id=" + i + dl;
        f.parentNode.insertBefore(j, f);
      })(window, document, "script", "dataLayer", "GTM-KNL2VQN");
    </script>
    <!-- End Google Tag Manager -->

    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-TEV7JMPP7S"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag() {
        dataLayer.push(arguments);
      }
      gtag("js", new Date());

      gtag("config", "G-TEV7JMPP7S");

      if ("serviceWorker" in navigator) {
        navigator.serviceWorker.register("serviceWorker.js").then((reg) => {
          //console.log('Service Worker Registered!', reg);
        });
      }
    </script>

    <title>
      리얼랭커스 - 데이터로 분석된 아파트 입지 순위 | 아파트 실거래가
    </title>
    <meta property="og:type" content="website" />
    <meta property="og:title" content="리얼랭커스" />
    <meta property="og:description" content="우리가 찾던 진짜 부동산 입지 분석 | 아파트 실거래가"/>
    <meta property="og:image" content="https://www.realrankus.com/thumbnail_4.jpg"/>
    <meta property="og:url" content="https://www.realrankus.com/" />

    <meta name="twitter:card" content="summary" />
    <meta name="twitter:url" content="https://www.realrankus.com/" />
    <meta name="twitter:title" content="리얼랭커스" />
    <meta name="twitter:description" content="우리가 찾던 진짜 부동산 입지 분석 | 숫자로 보는 아파트 입지 분석, 리얼랭커스 | 아파트 실거래가" />

    <meta name="keyword" content="리얼랭커스, 아파트순위, 부동산, 아파트, 입지, 순위, 아파트입지, 우리동네, 호가, 대장아파트, 최고가, 신고가, 호재, AI, 등수, 아파트 실거래가, 아파트 시세, 재건축, 재개발, 실거래가, 시세, 호가, 매매, 전세, 월세" />
    <meta name="description" content="우리가 찾던 진짜 부동산 입지 분석 | 숫자로 보는 아파트 입지 분석, 리얼랭커스 | 아파트 실거래가" />
    <meta name="author" content="리얼랭커스" />
    <meta name="robots" content="index,follow" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, minimal-ui, viewport-fit=cover" />
    <meta charset="utf-8" />

    <!-- 주소창 등의 웹 브라우저 UI를 표시하지 않기 -->
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <!-- 상태 바의 스타일을 지정 -->
    <meta name="apple-mobile-web-app-status-bar-style" content="default" />
    <meta name="theme-color" content="#fff" />
    <!-- 홈 화면에서 표시되는 앱 이름을 지정 -->
    <meta name="apple-mobile-web-app-title" content="리얼랭커스" />
    <!-- 홈 화면에서 표시되는 앱 아이콘을 지정 -->
    <link rel="apple-touch-icon" href="https://www.realrankus.com/apt-rank-152x152.png" />
    <!-- 웹 앱 매니페스트를 읽어 들이기 -->
    <link rel="manifest" href="manifest.json" />    

    <link rel="canonical" href="https://www.realrankus.com/" />
    <link href="https://fonts.googleapis.com/css?family=Roboto:100,300,400,500,700,900" rel="stylesheet" />
    <link href="https://cdn.jsdelivr.net/npm/@mdi/font@6.x/css/materialdesignicons.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" integrity="sha512-9usAa10IRO0HhonpyAIVpjrylPvoDwiPUiKdWk5t3PyolY1cOd4DSE0Ga+ri4AuTroPR5aQvXU9xC6qOPnzFeg==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous" />
    <link rel="shortcut icon" href="https://www.realrankus.com/apr-rank.png" />

    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://cdnjs.cloudflare.com/ajax/libs/spoqa-han-sans/3.2.1/css/SpoqaHanSansNeo.min.css" rel="stylesheet" type="text/css" />
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@100;200;300;400;500;600;700;800;900&display=swap" rel="stylesheet">

    <script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous" ></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js" integrity="sha256-VazP97ZCwtekAsvgPBSUwPFKdrwD3unUfSGVYrahUqU=" crossorigin="anonymous" ></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/0.5.0-beta4/html2canvas.min.js" crossorigin="anonymous" ></script>        
    <link href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.css" rel="stylesheet" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js"></script>
    <script src="https://developers.kakao.com/sdk/js/kakao.js"></script> 
    <script src="https://static.nid.naver.com/js/naveridlogin_js_sdk_2.0.2.js" charset="utf-8"></script>
    <!-- <script src="https://t1.kakaocdn.net/kakao_js_sdk/2.5.0/kakao.min.js" integrity="sha384-kYPsUbBPlktXsY6/oNHSUDZoTX6+YI51f63jCPEIPFP09ttByAdxd2mEjKuhdqn4" crossorigin="anonymous"></script> -->
    <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/pwacompat/2.0.17/pwacompat.min.js" integrity="sha512-4Dg9Iq0/VM+AW4tfM+/LLLX+Yopudo7SEsMyfTJzG/x7brKQ+NAMELrhA517cA2wFVOHo0m+n06XWCdE70Qsew==" crossorigin="anonymous" referrerpolicy="no-referrer"></script> -->
    
    <script src="./js/menu_select_box.js" type="text/javascript"></script>
    <script src="./js/draw_chart.js" type="text/javascript"></script>
    <script src="./js/sort.js" type="text/javascript"></script>
    <script src="./js/search.js" type="text/javascript"></script>
    <script src="./js/unfied_search.js" type="text/javascript"></script>
    <script src="./js/rearrange.js" type="text/javascript"></script>
    <script src="./js/share.js" type="text/javascript"></script>
    <script src="./js/weight_cal.js" type="text/javascript"></script>
    <script src="./js/weight_array.js" type="text/javascript"></script>
    <script src="./js/simulation.js" type="text/javascript"></script>
    <script src="./js/top300.js" type="text/javascript"></script>
    <script src="./js/kakao_sendtome.js" type="text/javascript"></script>
    <script src="./js/notice_aptrank.js" type="text/javascript"></script>
    <script src="./js/ad_aptrank.js" type="text/javascript"></script>
    <script src="./js/restrict_words.js" type="text/javascript"></script>
    <script src="./js/map_control.js" type="text/javascript"></script>
    <script src="./js/distance.js" type="text/javascript"></script>

    <link href="./css/style_common.css" rel="stylesheet" />
    <link href="./css/style.css" rel="stylesheet" />
    <link href="./css/slider.css" rel="stylesheet" />
    <link href="./css/style_board.css" rel="stylesheet" />

    <script src="./js/doubleSlider.js" type="text/javascript"></script>
  </head>
  <style></style>

  <body ontouchstart="">
    <!-- Google Tag Manager (noscript) -->
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-KNL2VQN" height="0" width="0" style="display: none; visibility: hidden" ></iframe></noscript>
    <!-- End Google Tag Manager (noscript) -->
    
    <div id="container">
      <div id="centerBox">
        <div id="titleBar">
          <!--검색 버튼 표시-->
          <div id="search" onClick="showSearchBar(this)">
            <i class="fas fa-search"></i>
          </div>
          <!--재정렬 버튼 표시-->
          <div
            id="rearrange"
            class="position-relative"
            onClick="showRearrangeBar(this)"
          >
            <i class="fa-solid fa-arrow-down-wide-short"></i>
          </div>
          <!--타이틀 표시-->          
          <!-- <div id="title" onClick="scrollUp()"> -->
          <div id="title" onClick="location.reload()">            
            <img src="./apt-rank_blank2.png" height="32px" />
          </div>
          <!-- <div id="title" onClick='sendTo()'>리얼랭커스</div> -->
          <!--공유 버튼-->
          <!-- <div id="search" onClick='share(shareTitle, shareText, shareURL)'><i class='fa-solid fa-arrow-up-right-from-square'></i></div> -->
          <!--단지 가중치 설정 버튼 표시-->
          <div id="sort" class="position-relative" data-bs-toggle="modal" data-bs-target="#baseModal" onClick="showSorting()" ><i class="fa-solid fa-sliders"></i></div>
          <div id="help" data-bs-toggle="offcanvas" data-bs-target="#offcanvasRight" id="offcanvas_right" aria-controls="offcanvasRight"><i class="fa-solid fa-ellipsis"></i></div>
        </div>

        <div id="selections">
          <div id="sido_selection">
            <select id="sido" onChange="sidoChange()"></select>
          </div>
          <div id="gungu_selection">
            <select id="gungu" onChange="updateRegion()"></select>
          </div>
          <div id="month_selection">
            <!-- 수정 -->
            <select id="month" onChange="updateMonth()">
              <option value="202410" selected>2024년 10월</option>
              <option value="202409">2024년 09월</option>
              <option value="202408">2024년 08월</option>
              <option value="202407">2024년 07월</option>
              <option value="202406">2024년 06월</option>
              <option value="202405">2024년 05월</option>
              <!--
              <option value="202404">2024년 04월</option>              
              <option value="202403">2024년 03월</option>              
              <option value="202402">2024년 02월</option>              
              <option value="202401">2024년 01월</option>              
              <option value="202312">2023년 12월</option>              
              <option value="202311">2023년 11월</option>
              <option value="202310">2023년 10월</option>              
              <option value="202309">2023년 09월</option>              
              <option value="202308">2023년 08월</option>
              <option value="202307">2023년 07월</option>
              <option value="202306">2023년 06월</option>
              <option value="202305">2023년 05월</option>
              <option value="202304">2023년 04월</option>            
              <option value="202303">2023년 03월</option>
              <option value="202302">2023년 02월</option>
              <option value="202301">2023년 01월</option>              
              <option value="202212">2022년 12월</option>
              <option value="202211">2022년 11월</option>
              <option value="202210">2022년 10월</option>
              <option value="202209">2022년 09월</option>
              <option value="202208">2022년 08월</option>
              <option value="202207">2022년 07월</option>
              <option value="202206">2022년 06월</option>
              <option value="202205">2022년 05월</option>
              <option value="202204">2022년 04월</option>
              <option value="202203">2022년 03월</option>
              <option value="202202">2022년 02월</option>
              <option value="202201">2022년 01월</option>
              --></select>
          </div>
        </div>

        <!--단지 가중치 표시창-->
        <!-- <div id="weight" data-bs-toggle='modal' data-bs-target='#baseModal' onClick='showSorting()'></div> -->
        <div id="weight"></div>

        <!--단지 검색창-->
        <div id="searchCard">
          <div id="iconSearch"><i class="fas fa-search"></i></div>
          <div id="searchGuide">
            <div id="searchNotice"></div>
            <div id="inputBox">
              <input
                id="inputSearch"
                type="text"
                placeholder="어느 단지를 찾아볼까요?"
                onkeyup="aptSearch()"
              />
            </div>
            <div id="searchExample">예) 서초동, 래미안, 힐스테이트, 주공</div>
          </div>
          <div id="closeSearch" onClick="closeSearch()">
            <i class="fas fa-times"></i>
          </div>
        </div>

        <!--통합 검색창-->
        <div id="unifiedSearchCard">
          <div id="iconSearch"><i class="fas fa-search"></i></div>
          <div id="unifiedSearchGuide">
            <div id="unifiedSearchNotice">
              <div>
                <label>
                  <input type="radio" class="searchRadio" name="options" id="option1" autocomplete="off" value="global" checked onchange="radioActive(this.value)"/>
                  <span style="padding-left: 5px; vertical-align: middle" >전국검색</span>
                </label>
              </div>
              <div>
                <label>
                  <input type="radio" class="searchRadio" name="options" id="option2" autocomplete="off" value="local" onchange="radioActive(this.value)" />
                  <span id="localSearch" style="padding-left: 5px; vertical-align: middle">지역내검색</span>
                </label>
              </div>
            </div>
            <div id="unifiedInputBox">
              <input id="inputUnifiedSearch" type="text" placeholder="두 글자 이상 입력해 주세요" onkeyup="goSearchBySearchType()" />
            </div>
            <div id="unifiedSearchExample">예) 서초동, 래미안, 힐스테이트, 주공</div>
          </div>
          <div id="closeUnifiedSearch" onClick="closeUnifiedSearch()"><i class="fas fa-times"></i></div>
        </div>

        <!--시군구 검색창-->
        <div id="regionSearchCard">
          <div id="iconSearch"><i class="fas fa-search"></i></div>
          <div id="regionSearchGuide">
            <div id="regionSearchNotice">전국 시군구 이름으로 검색합니다.</div>
            <div id="regionInputBox">
              <input id="regionInputSearch" type="text" placeholder="어느 시군구를 찾아볼까요?" onkeyup="regionSearch()"/>
            </div>
            <div id="regionSearchExample">예) 서울, 창원, 강남, 서구</div>
          </div>
          <div id="closeRegionSearch" onClick="closeRegionSearch()"><i class="fas fa-times"></i></div>
        </div>

        <!--단지 정렬창-->
        <div id="rearrangeCard">
          <div id="iconRearrange">
            <i class="fa-solid fa-arrow-down-wide-short"></i>
          </div>
          <div id="rearrangeContatiner">
            <div id="rearrangeNotice"></div>
            <div class="rearrangeArea">
              <div><input type="radio" class="btn-check" name="btnRearrange" autocomplete="off" id="rearrangeScore" onClick="rearrangeAPTList(this)"/><label class="btn btn-outline-danger" for="rearrangeScore">등급순</label></div>
              
              <div><input type="radio" class="btn-check" name="btnRearrange" autocomplete="off" id="rearrangePrice" onClick="rearrangeAPTList(this)"/><label class="btn btn-outline-danger" for="rearrangePrice">실거래가순</label></div>
              <div><input type="radio" class="btn-check" name="btnRearrange" autocomplete="off" id="rearrangeNew" onClick="rearrangeAPTList(this)"/><label class="btn btn-outline-danger" for="rearrangeNew">신축순</label></div>
              <div><input type="radio" class="btn-check" name="btnRearrange" autocomplete="off" id="rearrangeHouse" onClick="rearrangeAPTList(this)"/><label class="btn btn-outline-danger" for="rearrangeHouse">세대수순</label></div>
            </div>
          </div>
          <div id="closeRearrange" onClick="closeRearrange()">
            <i class="fas fa-times"></i>
          </div>
        </div>

        <!--시군구 정렬창-->
        <div id="rearrangeRegionCard">
          <div id="iconRearrange">
            <i class="fa-solid fa-arrow-down-wide-short"></i>
          </div>
          <div id="rearrangeContatiner">
            <div id="rearrangeRegionNotice"></div>
            <div class="rearrangeArea">
              <div><input type="radio" class="btn-check" name="btnRearrange" autocomplete="off" id="rearrangeRegionScore" onClick="rearrangeRegionList(this)"/><label class="btn btn-outline-danger" for="rearrangeRegionScore">총점순</label></div>
              <div><input type="radio" class="btn-check" name="btnRearrange" autocomplete="off" id="rearrangeRegionRank" onClick="rearrangeRegionList(this)"/><label class="btn btn-outline-danger" for="rearrangeRegionRank">순위변동순</label></div>
              <div><input type="radio" class="btn-check" name="btnRearrange" autocomplete="off" id="rearrangeRegionPop" onClick="rearrangeRegionList(this)"/><label class="btn btn-outline-danger" for="rearrangeRegionPop">인구순</label></div>
              <div><input type="radio" class="btn-check" name="btnRearrange" autocomplete="off" id="rearrangeRegionPopUpDown" onClick="rearrangeRegionList(this)"/><label class="btn btn-outline-danger" for="rearrangeRegionPopUpDown">인구증감순</label></div>
              <div><input type="radio" class="btn-check" name="btnRearrange" autocomplete="off" id="rearrangeRegionJob" onClick="rearrangeRegionList(this)"/><label class="btn btn-outline-danger" for="rearrangeRegionJob">일자리순</label></div>
              <div><input type="radio" class="btn-check" name="btnRearrange" autocomplete="off" id="rearrangeRegionIncome" onClick="rearrangeRegionList(this)"/><label class="btn btn-outline-danger" for="rearrangeRegionIncome">소득순</label></div>
            </div>
          </div>
          <div id="closeRegionRearrange" onClick="closeRegionRearrange()">
            <i class="fas fa-times"></i>
          </div>
        </div>
        <!--리스트 데이터 붙여넣는 영역-->        
        <div id="dataList_wrapper">
          <div id="dataList"></div>
        </div>
        <div id="dataMap"></div>

        <!--댓글서비스창-->
        <div id="commentBack" onClick="commentbox_animate()"></div>
        <div id="commentWrapper" style='display:none'>
          <div id="commentBox">
            <div id="comment_head" onClick="commentbox_animate()">
              <div id="comment_light"></div>
              <div id="comment_title">
                <div id="recent_comment_num"></div>
              </div>
            </div>
            <div id="comment_list"></div>
            <div id="writeBox"></div>
          </div>
        </div>

        <!--리얼랭커스 연결-->
        <div id="linkToAptrank_bottom"></div>

        <!--단지 검색창 닫기 플로팅 버튼-->
        <div id="closeSearch_floating" onClick="closeSearch()">
          <div id="closeSearch_floting_wraper">
            <div id="closeIcon_floating"><i class="fas fa-times"></i></div>
            <div id="clostText_floating">검색닫기</div>
          </div>
        </div>
        <!--통합 검색창 닫기 플로팅 버튼-->
        <div id="closeUnifiedSearch_floating" onClick="closeUnifiedSearch()">
          <div id="closeSearch_floting_wraper">
            <div id="closeIcon_floating"><i class="fas fa-times"></i></div>
            <div id="clostText_floating">검색닫기</div>
          </div>
        </div>
        <!--시군구 검색창 닫기 플로팅 버튼-->
        <div id="closeRegionSearch_floating" onClick="closeRegionSearch()">
          <div id="closeSearch_floting_wraper">
            <div id="closeIcon_floating"><i class="fas fa-times"></i></div>
            <div id="clostText_floating">검색닫기</div>
          </div>
        </div>
        <!--단지 재정렬창 닫기 플로팅 버튼-->
        <div id="closeRearrange_floating" onClick="closeRearrange()">
          <div id="closeSearch_floting_wraper">
            <div id="closeIcon_floating"><i class="fas fa-times"></i></div>
            <div id="clostText_floating">정렬닫기</div>
          </div>
        </div>
        <!--지역 재정렬창 닫기 플로팅 버튼-->
        <div id="closeRegionRearrange_floating" onClick="closeRegionRearrange()" >
          <div id="closeSearch_floting_wraper">
            <div id="closeIcon_floating"><i class="fas fa-times"></i></div>
            <div id="clostText_floating">정렬닫기</div>
          </div>
        </div>
      </div>
    </div>

    <!-- Vertically centered scrollable modal -->
    <!-- Button trigger modal -->
    <!-- Modal -->
    <div class="modal fade" id="baseModal" tabindex="-1" aria-labelledby="baseModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="baseModalLabel">잠시만 기다려 주세요</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body" id="aptDetail"></div>
          <div id="footer"></div>
        </div>
      </div>
    </div>

    <div class="modal fade" id="toggleModal1" tabindex="-1" aria-labelledby="toggleModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="toggleModalLabel">잠시만 기다려 주세요</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body" id="simulDetail"></div>
          <div id="toggle1footer"></div>
        </div>
      </div>
    </div>

    <div class="modal fade" id="toggleModal2" tabindex="-1" aria-labelledby="toggleModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="toggleModalLabe2">잠시만 기다려 주세요</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body" id="simulResult"></div>
          <div id="toggle2footer"></div>
        </div>
      </div>
    </div>

    <div class="modal fade" id="loginModal" tabindex="-1" aria-labelledby="loginModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="loginModalLabel">잠시만 기다려 주세요</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body" id="loginDetail"></div>
          <div id="loginfooter"></div>
        </div>
      </div>
    </div>
    
    <!-- Comment_Modal -->
    <div class="modal fade" id="commentModal" tabindex="-1" role="dialog" aria-labelledby="commentModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-dialog-scrollable" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <div class="modal-title" id="commentModalLabel"></div>
          </div>
          <div class="modal-body"></div>
          <div class="modal-footer"></div>
        </div>
      </div>
    </div>

    <div class="modal fade" id="commentModifyModal" tabindex="-1" role="dialog" aria-labelledby="commentModifyModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content"> 
          <div class="modal-header">
            <div class="modal-title" id="commentModifyModalLabel"></div>
          </div>         
          <div class="modal-body"></div>
          <div class="modal-footer"></div>
        </div>
      </div>
    </div>

    <div class="modal fade" id="noticeModal" tabindex="-1" aria-labelledby="noticeModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="noticeModalLabel">잠시만 기다려 주세요</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body" id="noticeDetail"></div>
          <div id="noticeFooter"></div>
        </div>
      </div>
    </div>    

    <!-- Offcanvas Right -->
    <div class="offcanvas offcanvas-end" tabindex="-1" id="offcanvasRight" aria-labelledby="offcanvasRightLabel">
      <div class="offcanvas-header">
        <h5 id="offcanvasRightLabel">MENU</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="offcanvas" aria-label="Close"></button>
      </div>
      <div class="offcanvas-body"></div>
    </div>

    <!-- Offcanvas Profile -->
    <div class="offcanvas offcanvas-end" tabindex="-1" id="offcanvasProfile" aria-labelledby="offcanvasProfileLabel">
      <div class="offcanvas-header">
        <h5 id="offcanvasRightLabel"></h5><i class="fa-solid fa-xmark"></i>
      </div>
      <div class="offcanvas-body"></div>
    </div>

    <!--모바일 지도/리스트 변환 버튼-->
    <div id="mobile_map_list" onClick="mapListModeChange()">
      <div id="mobile_map_list_wraper">
        <div id="mobile_map_list_icon"></div>
        <div id="mobile_map_list_text"></div>
      </div>
    </div>

    <!--검색 결과 표시해 주는 리스트-->
    <div id="searchingBox"></div>

    <!--지도에 등급 표시 필터-->
    <div id="gradeSelector">
      <div class='gradeSelector_check'><input class="form-check-input" type="checkbox" id="check_grade_S" value="S" checked onChange="setGradeFilter()"><label id="check_grade_S_text" for="check_grade_S">S</label></div>
      <div class='gradeSelector_check'><input class="form-check-input" type="checkbox" id="check_grade_A" value="A" checked onChange="setGradeFilter()"><label id="check_grade_A_text" for="check_grade_A">A</label></div>
      <div class='gradeSelector_check'><input class="form-check-input" type="checkbox" id="check_grade_B" value="B" checked onChange="setGradeFilter()"><label id="check_grade_B_text" for="check_grade_B">B</label></div>
      <div class='gradeSelector_check'><input class="form-check-input" type="checkbox" id="check_grade_C" value="C" checked onChange="setGradeFilter()"><label id="check_grade_C_text" for="check_grade_C">C</label></div>
    </div>

    <!--지도 위 배너-->
    <div id="map_banner" onClick='openOuterLink("https://naver.me/xDJJrRGf")'>
      리얼랭커스 CEO의 MY 데이터 맞춤 미팅
    </div>

    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p"
      crossorigin="anonymous"
    ></script>

    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.0.0/dist/chart.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2"></script>

    <script src="https://www.gstatic.com/firebasejs/8.8.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.2/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.8.1/firebase-database.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.8.1/firebase-auth.js"></script>    
    <script src="https://www.gstatic.com/firebasejs/10.7.2/firebase-firestore-compat.js"></script>   
    
    <script type="text/javascript" src="https://openapi.map.naver.com/openapi/v3/maps.js?ncpClientId=uod39kursd" ></script>
    <script src="https://cdn.jsdelivr.net/npm/open-graph-scraper@6.8.1/dist/cjs/index.min.js"></script>

    <script src="./js/login_240308.js" type="text/javascript"></script>
    <script src="./js/apple.js" type="text/javascript"></script>
    <script src="./js/board.js" type="text/javascript"></script>    
    <script type="module" src="./js/con_counter.js"></script>

    <script>
      window.fbAsyncInit = function() {
        FB.init({
          appId            : '2187909741587055',
          xfbml            : true,
          version          : 'v20.0'
        });
      };
    </script>
    <script async defer crossorigin="anonymous" src="https://connect.facebook.net/en_US/sdk.js"></script>

  </body>
  <script>
    var selectedMonth = "202410"; //수정
    var selectedRegion = "Seoul";
    var selectedSubRegion = "1168000000_Seoul_Gangnam";
    var selectedComplex = "";
    var searchType = "global";
    var update_ver = "?v=1.0";    

    var pageName = "aptrank" //20231020

    var regionName = "";
    var valueSum = 0;
    var livingSum = 0;
    var transportSum = 0;
    var infraSum = 0;
    var eduSum = 0;

    var regValueSum = 0;
    var regSupplySum = 0;
    var regPopSum = 0;
    var regJobSum = 0;
    var linked = "";
    var regionValue = "";

    var itemNum = 0;
    var aptData = "";
    var aptData_original = "";
    var sortData = "";
    var prevValue = 0;
    var regData = "";
    var regSortData = "";
    var adData = "";
    var blank_height = "3em";

    var internalSearching = []
 
    var modalState = 0;
    var searchState = 0;
    var popupHistory = [];

    var startNotice = false;
    var noticePop = false;
    var sortingPop = false;
    var alwaysSortingPop = "on";
    var regionSelection = false;

    var prev_selection = ""
    var current_selection = ""

    var lastRegion = localStorage.getItem("lastRegion");
    var lastSubRegion = localStorage.getItem("lastSubRegion");
    var lastMonth = localStorage.getItem("lastMonth");
    var lastNoticed = localStorage.getItem("lastNoticed");    

    var sales_history_price = [];
    var sales_history_date = [];
    var priceCharts = [];
    var dongDB = []
    var currentMenu = ""
    var show_up_complexs = []
    var mobile_mode = "map"

    var popMsg = "클립보드에 복사되었습니다.";

    var today = new Date();
    var today_year = today.getFullYear();
    var today_month = dateReturn(today.getMonth() + 1);
    var today_day = dateReturn(today.getDate());
    var today_num = Number("" + today_year + today_month + today_day);
    var today_str = today_year + "-" + today_month + "-" + today_day;  

    var pop_state = []

    var come_from_map = false

    function dateReturn(n) {
      return n < 10 ? "0" + n : n;
    }    

    $(document).ready(function () {
      Kakao.init(kakaoKey);
      countUp(pageName)
      // SDK 초기화 여부를 판단합니다.
      //console.log(Kakao.isInitialized());
      //login_checker()

      var option = "";
      for (i = 0; i < regions.length; i++) {
        option += "<option value='" + regions[i][1] + "'>" + regions[i][0] + "</option>";
      }
      $("#sido").html(option);
      alwaysSortingPop = localStorage.getItem("lastSortingPop");

      //var lastRegion = sessionStorage.getItem('lastRegion')
      //var lastSubRegion = sessionStorage.getItem('lastSubRegion')
      //var lastMonth = sessionStorage.getItem('lastMonth')

      const url = new URL(window.location.href);
      const urlParams = url.searchParams;
      //console.log(urlParams)
      if (urlParams.has("apt")) {
        metatag_apt_name = urlParams.get("apt");
        //console.log(metatag_apt_name)
        main_title = "'" + metatag_apt_name + "'" + " 입지분석, 시세, 실거래가 | 표준화된 리얼랭커스 입지분석";
        $(document).attr("title", main_title);
        $("meta[property='og\\:title']").attr("content", main_title);
        $("meta[property='og\\:url']").attr("content", url);

        meta_description = "'" + metatag_apt_name + "'" + "의 주거, 교통, 인프라, 교육 환경 분석 정보를 데이터로 확인하세요.";
        $("meta[property='og\\:description']").attr("content", meta_description);
        $("meta[property='og\\:site_name']").attr("content", "리얼랭커스");

        $("meta[name='twitter\\:card']").attr("content", "summary");
        $("meta[name='twitter\\:url']").attr("content", url);
        $("meta[name='twitter\\:title']").attr("content", main_title);
        $("meta[name='twitter\\:description']").attr("content", meta_description);
      }

      if (urlParams.has("reg")) {
        selectedRegion = urlParams.get("reg");
      } else if (lastRegion != null) {
        selectedRegion = lastRegion;
      }

      if (urlParams.has("sub")) {
        selectedSubRegion = urlParams.get("sub");
      } else if (lastSubRegion != null) {        
        selectedSubRegion = lastSubRegion;        
      } 

      if (urlParams.has("mon")) {
        selectedMonth = urlParams.get("mon");
      } else if (lastMonth != null) {
        selectedMonth = lastMonth;
      }

      if (urlParams.has("complex")) {
        selectedComplex = urlParams.get("complex");
      }

      if (urlParams.has("sort")) {
        sortSelection = urlParams.get("sort");
      } else {
        initSorting();
      }

      $("#month").val(selectedMonth).prop("selected", true);
      $("#sido").val(selectedRegion).prop("selected", true);
      $("#gungu").val(selectedSubRegion).prop("selected", true);
      regionName = $("#sido option:selected").val();

      $("#dataList").html("");
      month = selectedMonth;

      $('body').append("<div id='pageLoadingBack'><div class='spinner-grow text-pageLoading' role='status'></div><div style='font-size: 0.85em; color: white'><br>지역 정보를 불러오고 있어요!<br><br><div id='loading_reload' onClick='resetReload()'>로딩이 길다면 여기를 눌러 다시 불러오기!!</div></div></div>")

      //통합검색
      if (selectedMonth >= 202211) {
        //$('#search').css("visibility", "hidden")
        //searching_url = "https://www.realrankus.com/" + selectedMonth + "/Searching_list.json" + update_ver;
        searching_url = "./" + selectedMonth + "/Searching_list.json" + update_ver;
        $.getJSON(searching_url, function (json) {
          searchingData = json;
        }).done(function(){
          //지도서비스추가      
          region_url = "./" + selectedMonth + "/region_map.json";
          $.getJSON(region_url, function (json) {        
            //console.log(json);
            regionMapData = json.data;        
            }).done(function(){
              for (var i in regionMapData){
                if(regionMapData[i]['Level'] == "Level0"){
                  level0_loc.push(regionMapData[i])
                }
                if(regionMapData[i]['Level'] == "Level1"){
                  level1_loc.push(regionMapData[i])
                }
                if(regionMapData[i]['Level'] == "Level2"){
                  level2_loc.push(regionMapData[i])
                }
              }
              if(selectedRegion == "Korea"){
                loadMap(127.9564, 36.6778)
              }
              else{
                region_code = selectedSubRegion.split("_")[0]
                for(var i in level1_loc){
                  if(level1_loc[i]['법정동코드']+"" == region_code){
                    loadMap(level1_loc[i]['lng'], level1_loc[i]['lat'])
                    break;
                  }
                }
              }
              current_pos = defaultMap.getCenterPoint()
              projection = defaultMap.getProjection();
              current_coord = projection.fromPointToCoord(current_pos)

              origin_lat = current_coord['y']
              origin_lng = current_coord['x']

              nearby_region = []
              nearby_region = findNearbyRegion(origin_lat, origin_lng, 15)
              
              show_up_complexs = []
              show_up_complexs = defineMarkerList(nearby_region)

              current_zoom = defaultMap.getZoom()

              showHideMarker(current_zoom)
              $("#pageLoadingBack").remove()

              optionChange(selectedSubRegion, selectedRegion);
              updateRegion();
            })
        })
      }

      $("div.modal").on("show.bs.modal", function () {
        var modal = this;
        var hash = modal.id;
        window.location.hash = hash;
        window.onhashchange = function () {
          if (!location.hash) {
            $(modal).modal("hide");
          }
        };
      });
      $("#linkToAptrank_bottom").css({'width' : '100%'})
      if(regionName != "Korea"){
        $("#dataList_wrapper").css({'height' : window.innerHeight-$("#linkToAptrank_bottom").height()-$("#titleBar").height()-$("#selections").height()-90, 'margin-top':'170px'})      
      }
      else{
        $("#dataList_wrapper").css({'height' : window.innerHeight-$("#linkToAptrank_bottom").height()-$("#titleBar").height(), 'margin-top':'97px'})
        $("#dataList_wrapper").css({'margin-top':'96px', 'height': window.innerHeight - ( $("#titleBar").height() + $("#selections").height() + 23 +$("#linkToAptrank_bottom").height() )})
      }
      

      $("#baseModal").on("hidden.bs.modal", function () {
        changeMetaTagToDefault();
        current_selection = ""
        removeAnimation()
      });
      $("#noticeModal").on("hidden.bs.modal", function () {
        $("#baseModal").css({"z-index" : "1055"})
      });

      //optionChange(selectedSubRegion);
      //updateRegion();

      if ($.cookie("popCookie") != "202410" && urlParams.has("reg") == false && login_status == false) {
        startNotice = true;
        showNotice();
        //초기 진입 시 공지 팝업 표시하는 경우, 변수 startNotice에 true 할당
        $("#noticeModal").modal("show");
      }

      blank_height = "3em";
      $("#linkToAptrank").css("height", blank_height);
      $("#linkToAptrank").css("line-height", blank_height);      
      
      currentMenu = "aptrank"  //offcanvas  
      setOffcanvasMenu() //offcanvas

      if(!login_status){
        $('#sort').attr("data-bs-target", "#loginModal")
      }
      setBottomMenu()

      $("#searchingBox").css({'height': window.innerHeight - ( $("#titleBar").height() + $("#selections").height() + $("#weight").height()+23 +$("#linkToAptrank_bottom").height() )})
      $("#searchingBox").hide()
      var inHeight = window.innerHeight
      $("#commentBox").css({'height': inHeight-50-42})
      commentBox_height = $("#commentBox").height()      
      if(!isMobile){
        //$("#linkToAptrank_bottom").css({'width':'800px', 'margin':'0 auto'})
        $("#commentBox").css({'width':'580px', 'bottom': -commentBox_height + 92 + "px"})
        $("#mobile_map_list").hide()        
      }
      else{
        $("#dataList_wrapper").hide()
        $("#commentBox").css({'bottom': -commentBox_height + 92 + "px"})
        $("#rearrange").css({'visibility' : 'hidden'})
        $("#mobile_map_list_icon").html("<i class='fa-solid fa-list'></i>")
        $("#mobile_map_list_text").html("목록보기")
        
      }
      $("#commentBack").hide()
    });

    var commentBox_on = false
    function commentbox_animate(){
      commentBox_height = $("#commentBox").height()
      fixed_loc = -commentBox_height + 92 + "px"
      if(commentBox_on == true){
        commentBox_on = false        
        $('#comment_title').animate({ 'font-size' : '0.85em' }, 350, 'easeInCirc' )
        $('#comment_light').animate({ 'background-color' : '#ddd' }, 350, 'easeInCirc' )
        $('#commentBox').animate( { 'bottom': fixed_loc }, 350, 'easeInCirc' );
        $('#comment_direction').animate( { 'rotate': '0deg' }, 550, 'easeInCirc' );        
        $('#commentBack').animate( { 'opacity': '0'}, 350, 'linear' )
        .promise()
        .done(function(){
          $("#commentBack").hide()
          $('#commentWrapper').css({'z-index' : '850'})
          $('body').css({'overflow-y' : 'auto'})
        });
      }
      else{
        window.location.hash = "#board";
        window.onhashchange = function () {
          if (!location.hash) {
            commentbox_animate()
          }
        };
      
        commentBox_on = true
        $("#commentBack").show()
        $('#commentWrapper').css({'z-index' : '950'})
        $('#comment_title').animate({
          'font-size' : '1.1em'
        }, 350, 'easeOutCirc' )
        $('#comment_light').animate({
          'background-color' : '#e31939',
        }, 350, 'easeOutCirc' )
        $('#commentBox').animate( {
          'bottom': "40px"
        }, 350, 'easeOutCirc' );
        $('#comment_direction').animate( {
          'rotate': '180deg',
        }, 550, 'easeInCirc' );
        $('#commentBack').animate( {
          'opacity': '0.6'
        }, 350, 'linear' )
        .promise()
        .done(function(){
          $('body').css({'overflow-y' : 'hidden'})
        })
      }
    }

    function resetReload(){
      selectedRegion = "Seoul";
      selectedSubRegion = "1168000000_Seoul_Gangnam";

      localStorage.setItem("lastRegion", selectedRegion);
      localStorage.setItem("lastSubRegion", selectedSubRegion);
      
      location.reload()
    }

    function showWeight() {
      if (selectedRegion != "Korea") {
        $("#weight").show();

        var sortName = "";
        var priceRange = "";

        if (sortSelection == "sortDefault") {
          sortName = "균형잡힌";
        }
        if (sortSelection == "sortLiving") {
          sortName = "주거우선";
        }
        if (sortSelection == "sortTrans") {
          sortName = "교통우선";
        }
        if (sortSelection == "sortInfra") {
          sortName = "인프라우선";
        }
        if (sortSelection == "sortEdu") {
          sortName = "교육우선";
        }
        if (sortSelection == "sortCustom") {
          sortName = "커스텀";
        }

        if (minValue == 0 && maxValue == 60) {
          priceRange = "가격 전체";
        } else if (minValue == 0 && maxValue != 60) {
          priceRange = "가격 " + maxValue / 2 + "억 이하";
        } else if (minValue != 0 && maxValue == 60) {
          priceRange = "가격 " + minValue / 2 + "억 이상";
        } else {
          priceRange = "가격 " + minValue / 2 + "억~" + maxValue / 2 + "억";
        }

        var weightInfo = "";
        if (sortSelection == "sortDefault") {
          weightInfo = sortName + " 가중치 (기본값)";
          weightInfo += "   |   " + priceRange;
        } else {
          if ( selectedRegion == "Seoul" || selectedRegion == "Incheon" || selectedRegion == "Gyeonggi" || selectedRegion == "Busan" 
          || selectedRegion == "Daegu" || selectedRegion == "Daejeon" || selectedRegion == "Gwangju" ) {
            weightInfo = sortName + " : " + "주거 " + valLiving + ", " + "교통 " + valTrans + ", " + "인프라 " + valInfra + ", " + "교육 " + valEdu;
            weightInfo += "   |   " + priceRange;
          } else {
            weightInfo = sortName + " : " + "주거 " + valLiving + ", " + "인프라 " + valInfra + ", " + "교육 " + valEdu;
            weightInfo += "   " + priceRange;
          }
        }
        $("#weight").html(weightInfo);
      } else {
        $("#weight").hide();        
      }
    }

    function radioActive(val) {
      searchType = val;

      if(selectedRegion=="Korea" && selectedSubRegion=="1000000000_Korea" && searchType == "local"){
        $("#unifiedSearchExample").html("예) 강남, 분당, 수지, 해운대");
      }
      else{
        $("#unifiedSearchExample").html("예) 서초동, 래미안, 힐스테이트, 주공");
      }      

      $("#inputUnifiedSearch").val("");
      goSearchBySearchType();
      $("#inputUnifiedSearch").focus();
    }

    function sidoChange() {
      regionSelection = true;
      optionChange();
      updateRegion();
    }

    function saveLocalStorage() {
      localStorage.setItem("lastRegion", selectedRegion);
      localStorage.setItem("lastSubRegion", selectedSubRegion);
      //localStorage.setItem('lastMonth', selectedMonth)

      //sessionStorage.setItem('lastRegion', selectedRegion)
      //sessionStorage.setItem('lastSubRegion', selectedSubRegion)
      //sessionStorage.setItem('lastMonth', selectedMonth)
    }

    function scrollUp() {
      $("html, body").animate({ scrollTop: 0 }, 50);
    }

    function optionChange(subRegion, upperReion) {
      selectedSubRegion = subRegion;
      if(upperReion == null || upperReion == "" || upperReion == undefined){
        regionName = $("#sido option:selected").val();
      }
      else{
        regionName = upperReion        
        $("#gungu").val(selectedSubRegion).prop("selected", true);
      }      
      selectedRegion = regionName;
      $("#sido").val(selectedRegion).prop("selected", true);
      
      var changeItem;

      if (regionName == "Korea") {
        changeItem = inKorea;
      }
      if (regionName == "Seoul") {
        changeItem = inSeoul;
      }
      if (regionName == "Busan") {
        changeItem = inBusan;
      }
      if (regionName == "Incheon") {
        changeItem = inIncheon;
      }
      if (regionName == "Daegu") {
        changeItem = inDaegu;
      }
      if (regionName == "Gwangju") {
        changeItem = inGwangju;
      }
      if (regionName == "Daejeon") {
        changeItem = inDaejeon;
      }
      if (regionName == "Ulsan") {
        changeItem = inUlsan;
      }
      if (regionName == "Sejong") {
        changeItem = inSejong;
      }
      if (regionName == "Gyeonggi") {
        changeItem = inGyeonggi;
      }
      if (regionName == "Gangwondo") {
        if (Number(selectedMonth) >= 202307) {
          changeItem = inNewGangwondo;
        } else {
          changeItem = inGangwondo;
        }
      }
      if (regionName == "Chungcheongbukdo") {
        changeItem = inChungcheongbukdo;
      }
      if (regionName == "Chungcheongnamdo") {
        changeItem = inChungcheongnamdo;
      }
      if (regionName == "Jeollabukdo") {        
        if (Number(selectedMonth) >= 202404) {
          changeItem = inNewJeollabukdo;
        } else {
          changeItem = inJeollabukdo;
        }
      }
      if (regionName == "Jeollanamdo") {
        changeItem = inJeollanamdo;
      }
      if (regionName == "Gyeongsangbukdo") {
        changeItem = inGyeongsangbukdo;
      }
      if (regionName == "Gyeongsangnamdo") {
        changeItem = inGyeongsangnamdo;
      }
      if (regionName == "Jejudo") {
        changeItem = inJejudo;
      }
      $("#gungu").empty();

      for (var i = 0; i < changeItem.length; i++) {
        var subOption = $( "<option value='" + changeItem[i][1] + "'>" + changeItem[i][0] + "</option>" );
        $("#gungu").append(subOption);
      }

      if (selectedSubRegion == undefined) {
        $("#gungu").val(changeItem[0][1]).prop("selected", true);
        selectedSubRegion = $("#gungu option:selected").val();
      } else {
        $("#gungu").val(selectedSubRegion).prop("selected", true);
      }
      //updateRegion()
    }

    var monthSelect = false;

    function updateMonth() {
      selectedMonth = $("#month option:selected").val();
      //monthSelect = true
      updateRegion();
      regionName = $("#sido option:selected").text();
      //saveLocalStorage()

      //통합검색
      if (selectedMonth >= 202211) {
        //searching_url = "https://www.realrankus.com/" + selectedMonth + "/Searching_list.json" + update_ver;
        searching_url = "./" + selectedMonth + "/Searching_list.json" + update_ver;
        $.getJSON(searching_url, function (json) {
          searchingData = json;
        });
      }
    }
    function updateRegion() {
      $('body').append("<div id='pageLoadingBack'><div class='spinner-grow text-pageLoading' role='status'></div><div style='font-size: 0.85em; color: white'><br>지역 정보를 불러오고 있어요!<br><br><div id='loading_reload' onClick='resetReload()'>로딩이 길다면 여기를 눌러 다시 불러오기!!</div></div></div>")  
      minValue = 0;
      maxValue = 60;

      selectedRegion = $("#sido option:selected").val();
      selectedSubRegion = $("#gungu option:selected").val();

      localSearchText = shortRegionName( $("#sido option:selected").text() + " " + $("#gungu option:selected").text() );
      $("#localSearch").html(localSearchText + " 검색");      

      if (selectedSubRegion != "1000000000_Korea") {
        $("#commentWrapper").show()        
        if (selectedSubRegion == "Living_Top300" || selectedSubRegion == "Trans_Top300" || selectedSubRegion == "Infra_Top300" || selectedSubRegion == "Edu_Top300" || selectedSubRegion == "Balanced_Top300") {
          //로딩          
          updateTopTable(selectedMonth, selectedSubRegion);
        } else {
          //로딩
          $("#dataList").html("");
          //var detail_loading_html = "<div style='display: grid; text-align: center; justify-items: center;'><br><br><br><br><div class='spinner-border text-danger' role='status'></div></div>";
          //$("#dataList").html(detail_loading_html);

          updateTable(selectedMonth, selectedSubRegion);
        }
        comment_html = "<div><i class='fa-solid fa-comment'></i>" + " #" + "개의 " + localSearchText + " 이야기</div>"
        comment_html += "<div></div>"
        docRef = comment_db.collection("realrankus_comment").doc(selectedSubRegion)
        
        if(login_status == true){
          setWriteBox()
          read_comment("end")
        }

        $("#recent_comment_num").html(comment_html)
      } else {
        $("#commentWrapper").hide()        
        updateRegionTable(selectedMonth, selectedSubRegion);
      }
      showWeight();
    }

    var svg_loc = ""

    function updateTable(month, region) {
      removeMarkers()
      $('#rearrangeScore').prop("checked", true) 

      //$('div.modal').modal("hide");
      $("#sort").css("visibility", "visible");
      $("#rearrange").css("visibility", "visible");
      //$('html').scrollTop(0)
      //initSorting()      
      regionCountUp(pageName, region) //20231020      

      $("#dataList").html("");
      $("#dataList").html("<div id='tableLoading' style='display: grid; text-align: center; justify-items: center;'><br><br><br><div class='spinner-border text-danger' role='status'></div></div>")

      //강원특별자치도 변경으로 인한 코드 수정
      if (Number(month) < 202307 && region.substr(0, 2) == "51") {
        region = region.replace("51", "42");
      }
      //전북특별자치도 변경으로 인한 코드 수정
      if(Number(month) < 202404 && region.substr(0, 2) == "52"){
        region = region.replace('52', '45')
      }

      //광고정보 로딩
      $.ajaxSetup({ async: false });
      load_parrtnership(region);      
      $.ajaxSetup({ async: true });

      url = "https://www.realrankus.com/" + month + "/" + region + ".json" + update_ver;

      /*
      $.getJSON(url, function (json) {
        sortData = json;
      });

      $.getJSON(url, function (json) {
        aptData_original = json;
      });
      */
      $.getJSON(url, function (json) {        
        //console.log(json);
        aptData = json;
        aptData_original = deepCopy(aptData)
        sortData = deepCopy(aptData)
        //sortData = json;
        itemNum = json.data.length;
        valueSum = 0;
        livingSum = 0;
        transportSum = 0;
        infraSum = 0;
        eduSum = 0;               
      })
      .done(function(){
        $("#dataList").html("")
        //광고정보표시
        show_partnership();

        //동 DB 만들기
        dongDB = []        
        $("#dataList").append("<div class='dong_selector'><div id='dong_list'></div></div>")  
        for (var j = 0; j < itemNum; j++){          
          var split_addr = (aptData.data[j]["법정동주소"]).split(" ")
          var dong_name = split_addr[2]
          if(split_addr[0] == "경기도" || split_addr[0] == "충청남도" || split_addr[0] == "충청북도" || split_addr[0] == "전북도" || split_addr[0] == "전라북도" || split_addr[0] == "경상북도"  || split_addr[0] == "경상남도"){
            if(split_addr[1] == "고양시" || split_addr[1] == "안양시" || split_addr[1] == "안산시" || split_addr[1] == "수원시" || split_addr[1] == "용인시" || split_addr[1] == "성남시" || split_addr[1] == "부천시"
                || split_addr[1] == "천안시" || split_addr[1] == "청주시" || split_addr[1] == "전주시" || split_addr[1] == "포항시" || split_addr[1] == "창원시"){
              dong_name = split_addr[3]
            }
          }
          dongDB.push(dong_name)

          //동 이름 중복 제거
          var filtered_dongDB = dongDB.filter((element, index) => {
            return dongDB.indexOf(element) === index;
          });
          filtered_dongDB = filtered_dongDB.sort()
          filtered_dongDB.unshift(" <i class='fa-regular fa-thumbs-up'></i>")
          filtered_dongDB.unshift("전체")          
        }        
        dongDB = []
        //동DB에 인덱스 포함해서 저장
        for (var dongIndex = 0 ; dongIndex < filtered_dongDB.length ; dongIndex++){
          dongDB.push([filtered_dongDB[dongIndex], dongIndex])
        }        

        if(window.innerWidth <= 800){
          dong_cell_width = (window.innerWidth/4) * (7/8)
          btn_width = (dong_cell_width-10) + "px"
        }
        else{
          dong_cell_width = 90
        }

        var columns = "repeat(" + dongDB.length + ", " + dong_cell_width + "px)"        
        $("#dong_list").css({"grid-template-columns" : columns})

        var dong_list_html = ""
        for (var dongIndex = 0 ; dongIndex < dongDB.length ; dongIndex++){
          selection_id = 'dong_' + dongDB[dongIndex][1]
          dong_list_html += "<div><input type='radio' class='btnRadio_tab' name='dong_select' autocomplete='off' id=" + selection_id + " onClick='dong_filter(this)'><label class='btn btn-outline-danger' id='dong_select_" + dongDB[dongIndex][1] + "' for='" + selection_id + "'>#" + dongDB[dongIndex][0] + "</label></div>"                                                
        }
        $("#dong_list").html(dong_list_html)
        $("#dong_0").prop('checked', true)

        selector_width = $(".dong_selector").width()
        inner_width = dong_cell_width * dongDB.length        

        if(isMobile){
          $(".dong_selector").css({'height':'37px'})
          $(".btnRadio_tab+label").css({"width" : btn_width})
        }
        else{
          if(selector_width < inner_width){
            $(".dong_selector").css({'height':'50px'})
          }
          else{
            $(".dong_selector").css({'height':'37px'})
          }          
        }
        
        $("#dataList_wrapper").css({'margin-top':$("#titleBar").height() + $("#selections").height() + $("#weight").height() + $(".dong_selector").height() + 25,
                'height': window.innerHeight - ( $("#titleBar").height() + $("#selections").height() + $("#weight").height() + $(".dong_selector").height() + 23 +$("#linkToAptrank_bottom").height() )})

        if(isMobile){        
          $("#dataMap").css({'margin-top':$("#titleBar").height() + $("#selections").height()+ $("#weight").height() + 20,
                            'height': window.innerHeight - ( $("#titleBar").height() + $("#selections").height() + $("#weight").height() + $("#linkToAptrank_bottom").height() + 10 )})        
        }
        //동 DB 생성 완료

        internalSearching = []

        for (var i = 0; i < itemNum; i++) {
          var aptName = aptData.data[i]["아파트명"];
          var apt_m = aptData.data[i]["전용면적(m2)"];
          var apt_p = aptData.data[i]["전용면적(평)"];

          var apt_type = aptData.data[i]["매매타입"];

          var aptAddress = aptData.data[i]["도로명주소"];
          var aptAddress2 = aptData.data[i]["법정동주소"];
          var aptValue = Math.round(aptData.data[i]["가치 총점"] * 100) / 100;
          var house_num = aptData.data[i]["세대수"];
          var rank = aptData.data[i]["rank"].toFixed();
          var last_sales = aptData.data[i]["last_sales"].split(",");
          var last_sales_date = last_sales[0].toString();
          var last_sales_price = last_sales[1].toString();
          var last_sales_area = last_sales[2];
          last_sales_date_short = last_sales_date.substr(2);

          var split_addr2 = aptAddress2.split(" ")
          var compare_dong_name = split_addr2[2]          
          if(split_addr2[1] == "고양시" || split_addr2[1] == "안양시" || split_addr2[1] == "안산시" || split_addr2[1] == "수원시" || split_addr2[1] == "용인시" || split_addr2[1] == "성남시" || split_addr2[1] == "부천시"
              || split_addr2[1] == "천안시" || split_addr2[1] == "청주시" || split_addr2[1] == "전주시" || split_addr2[1] == "포항시" || split_addr2[1] == "창원시"){
              compare_dong_name = split_addr2[3]
          }

          valueSum += aptData.data[i]["가치 총점"];
          livingSum += aptData.data[i]["주거총점"];
          transportSum += aptData.data[i]["교통총점"];
          infraSum += aptData.data[i]["인프라총점"];
          eduSum += aptData.data[i]["학군총점"];

          var searchCode = aptData.data[i]["검색코드"];

          complex_grade = setGrade(aptValue)

          internalSearching[i] = {"아파트명" : aptName, "법정동주소":aptAddress2, "검색코드":searchCode}

          //가격필터 적용 시
          if (checkPrice(last_sales[1])) {
            //console.log(valueSum)
            for(var j = 0 ; j < dongDB.length ; j++){
              var dong_compare = dongDB[j][0]

              if(compare_dong_name == dong_compare){
                var dongClass = "dong_" + dongDB[j][1]
                var addon_html = "<div class='listBox2 " + dongClass + "' data-bs-toggle='modal' data-bs-target='#baseModal' id='aptSelect_" + i + "' onClick='showDetail(" + i + ")' value=" + i + ">";
                break
              }
            }           

            /*
            if (selectedMonth == "202201") {
              addon_html += "<div class='rank'>";
              addon_html += "<div class='rank'>" + rank + "위</div>";
              addon_html += "</div>";
            } else {
              addon_html += "<div class='rank_content'>";
              addon_html += "<div class='rank'>" + rank + "위</div>";
              if (aptData.data[i]["rank_gap"] == 0) {
                addon_html += "<div class='ranksame'> -- </div>";
              } else if (aptData.data[i]["rank_gap"] == 9999) {
                addon_html += "<div class='ranksame'> NEW! </div>";
              } else if (aptData.data[i]["rank_gap"] > 0) {
                addon_html +=
                  "<div class='rankup'> ▲" +
                  Math.abs(aptData.data[i]["rank_gap"]) +
                  "</div>";
              } else if (aptData.data[i]["rank_gap"] < 0) {
                addon_html +=
                  "<div class='rankdown'> ▼" +
                  Math.abs(aptData.data[i]["rank_gap"]) +
                  "</div>";
              }

              addon_html += "</div>";
            }
            */
            addon_html += "<div class='rank_content'>"
              addon_html += "<div class='ranksame'>RANK</div>"
              addon_html += "<div class='rank'>" + complex_grade + "</div>";
            addon_html += "</div>"

            addon_html += "<div class='content'>";
            //addon_html += "<div class='apt_name'>" + aptName + " " + apt_p + "(" + apt_m + ")</div>";

            addon_html += "<div class='apt_name'>" + aptName;

            if (Number(selectedMonth) > 202203) {
              if (apt_type == "아파트") {
                addon_html += "<span class='aptYear'> (" + aptData.data[i]["준공년차"] + "년차)</span></div>";
              }
              if (apt_type == "재건축") {
                addon_html += "<span class='aptYear'> (" + aptData.data[i]["준공년차"] + "년차, 재건축)</span></div>";
              }
              if (apt_type == "분양권") {
                addon_html += "<span class='aptYear'> (분양권, " + aptData.data[i]["준공년월"].substr(0, 7) + " 예정)</span></div>";
              }
              if (apt_type == "분양(예정)") {
                addon_html += "<span class='aptYear'> (분양예정)</span></div>";
              }
            } else {
              addon_html += "<span class='aptYear'> (" + aptData.data[i]["준공년차"] + "년차)</span></div>";
            }

            if (house_num == null) {
              addon_html += "<div class='apt_info'>" + "세대수 미정 / <span class='aptPrice'>거래 정보 없음</span></div>";
            } else {
              if (last_sales_date == "1800-01-01") {
                addon_html += "<div class='apt_info'>" + house_num.toLocaleString() + "세대 / <span class='aptPrice'>거래 정보 없음</span></div>";
              } else {
                addon_html += "<div class='apt_info'>" + house_num.toLocaleString() + "세대 / <span class='aptPrice'>" + Math.round(last_sales_price / 100) / 100 + "억, " + last_sales_area + ", " + last_sales_date_short + "</span></div>";
              }
            }

            if (
              Number(selectedMonth) > 202203 &&
              (apt_type == "분양권" || apt_type == "분양(예정)")
            ) {
              addon_html += "<div class='apt_address'>" + aptData.data[i]["법정동주소"] + "</div>";
            } else {
              addon_html += "<div class='apt_address'>" + aptAddress2 + "</div>";
            }

            addon_html += "</div>";
            addon_html += "<div class='value_score'>";
              //"<div class='value_score'>" + (Math.round(aptValue * 100) / 100).toFixed(2) + "점</div>";
              //"<div class='value_score'></div>";
                addon_html +="<div class='complex_list_like' id='complex_" + searchCode +"\'>"
                  addon_html +="<div><i class='fa-solid fa-thumbs-up'></i></div>"
                  addon_html +="<div id='complex_like_num_" + searchCode +"\'>0</div>"
                addon_html +="</div>"
              addon_html +="</div>"
            addon_html += "</div>";

            $("#dataList").append(addon_html);            
          }          
        }        
        
        //console.log(blank_height);
        $("#dataList").append(
          "<div id='blank_list' style='height: " + blank_height + "'></div>"
        );
        if (!(minValue == 0 && maxValue == 60)) {
          $(".aptPrice").css({ color: "#fe4040", "font-weight": "600" });
        }

        if (sortSelection != "sortDefault") {
          changeSort();
        }

        if(!come_from_map){
          region_code = selectedSubRegion.split("_")[0]
          
          for(var i in level1_loc){
            if(level1_loc[i]['법정동코드']+"" == region_code){
              //new_center = new naver.maps.LatLng(level1_loc[i]['lat'], level1_loc[i]['lng'])
              new_center = new naver.maps.LatLng(aptData.data[0]['Y'], aptData.data[0]['X'])
              
              defaultMap.setCenter(new_center);
              current_zoom = defaultMap.getZoom()

              if(current_zoom < 14){
                defaultMap.setZoom(16)
              }              

              origin_lat = level1_loc[i]['lat']
              origin_lng = level1_loc[i]['lng']

              //origin_lat = aptData.data[0]['lat']
              //origin_lng = aptData.data[0]['lng']

              nearby_region = []
              nearby_region = findNearbyRegion(origin_lat, origin_lng, 15)

              show_up_complexs = []
              show_up_complexs = defineMarkerList(nearby_region)  

              showHideMarker(current_zoom)
              $("#pageLoadingBack").remove()

              break;
            }
          }
        }
        else{
          come_from_map = false;
          showHideMarker(current_zoom)
          $("#pageLoadingBack").remove()
        }        

        if(temp_code != ""){
          complex_idx = searchAndShow(temp_code)
          if(aptData.data[complex_idx]){
            map_center = {"lat": aptData.data[complex_idx]['Y'], "lng": aptData.data[complex_idx]['X']}
            defaultMap.setCenter(map_center);
          }

          temp_code = ""
          temp_coord = ""
          
          showDetail(complex_idx)
          
          setTimeout(function(){
            $('#baseModal').modal("show")            
          }, 350)          
        }

        if (selectedComplex != "") {
          $("html").scrollTop(70 * Number(selectedComplex));

          var selectedComplexNum = selectedComplex
          
          map_center = {"lat": aptData.data[selectedComplex]['Y'], "lng": aptData.data[selectedComplex]['X']}
          
          setTimeout(function(){
            if(defaultMap){
              defaultMap.setCenter(map_center);
              //if(!isMobile){
                setTimeout(function(){                
                    showDetail(selectedComplexNum);
                    $('#baseModal').modal("show")                
                }, 500)
              //}
            }
            else{
              setTimeout(function(){
                defaultMap.setCenter(map_center);
                //if(!isMobile){
                  setTimeout(function(){                
                      showDetail(selectedComplexNum);
                      $('#baseModal').modal("show")                
                  }, 500)
                //}
              }, 500)
            }
          }, 500)
          
          selectedComplex = "";
        }

        if (searched_code != "") {
          pos = searchAndShow(searched_code);
          $("html").scrollTop(70 * pos);
          showDetail(pos);
          searched_code = "";
        }
        //console.log("Table Update")
        complex_list_like_status()
        $("#pageLoadingBack").remove()        
      })
      .fail(function(jqXMLHttpRequest,status,error){
        $("#gungu option:eq(0)").prop("selected", true);
        var changeRegion = $("#gungu > option:selected").val();
        updateTable(month, changeRegion);
      })

      showWeight();
      saveLocalStorage();
    }

    function searchAndShow(searched_code) {
      findArray = ""
      if(sortSelection != "sortDefault"){
        findArray = sortData.data
      }
      else{
        findArray = aptData.data
      }
      
      var itemNums = findArray.length;
      for (var p = 0; p < itemNums; p++) {
        var aptCode = findArray[p]["검색코드"];
        if (aptCode == searched_code) {
          return p;
        }
      }
    }

    var detail_loading = false

    function showDetail(index) {
      if(isMobile){
        $(".modal-backdrop").css({"width":"100%"})
        $("#baseModal").css({"width":"100%"})
      }
      else{
        $(".modal-backdrop").css({"width":"600px"})
        $("#baseModal").css({"width":"600px"})
      }      

      detail_loading = true
      titleHtml = "";
      detailHtml = "";
      footerHtml = "";
      /*
      if(sortSelection == "sortDefault"){
        aptData = aptData_original
        var aptRank = aptData.data[index]["rank"] + "/" + aptData.data[itemNum-1]["rank"] + "위"
      }
      else{
        aptData = sortData
        var aptRank = (index+1) + "/" + aptData.data[itemNum-1]["rank"] + "위"
      }
    */

      aptData = sortData;

      var aptName = aptData.data[index]["아파트명"];
      var rank = aptData.data[index]["rank"].toFixed();
      var apt_m = aptData.data[index]["전용면적(m2)"];
      var apt_p = aptData.data[index]["전용면적(평)"];
      var apt_type = aptData.data[index]["매매타입"];
      var aptAddress = aptData.data[index]["도로명주소"];
      var aptValue = Math.round(aptData.data[index]["가치 총점"] * 100) / 100;
      var aptDuration = aptData.data[index]["준공년차"];
      var aptYear = "";
      var short_name = $("#sido option:selected").text() + " " + $("#gungu option:selected").text();

      var aptRank = "";

      complex_grade = setGrade(aptValue)

      changeMetaTag( aptName, aptData.data[index]["법정동주소"], rank, $("#gungu option:selected").text(), kakaoShareURL, aptValue );

      //log_date = new Date()
      //post(aptName, log_date, short_name)

      if ( sortSelection == "sortDefault" && rearrangeAPTSelection == "rearrangeScore" ) {
        aptRank = rank + "/" + aptData.data[itemNum - 1]["rank"] + "위";
      } else {
        aptRank = Number(index) + 1 + "/" + itemNum + "위";
      }

      if (Number(selectedMonth) > 202211) {
        eventURL = aptData.data[index]["sURL"];
      } else {
        eventURL = "";
      }

      gtag("event", "아파트상세", {
        event_category: short_name,
        event_label: aptName + "(" + short_name + ")",
      });

      if (Number(selectedMonth) > 202203) {
        if (apt_type == "아파트") { aptYear =   aptData.data[index]["준공년월"] + " (" + aptDuration + "년차)"; }
        if (apt_type == "재건축") { aptYear =   aptData.data[index]["준공년월"] +   " (" +   aptDuration +   "년차, 재건축)"; }
        if (apt_type == "분양권") { aptYear =   "(분양권, " +   aptData.data[index]["준공년월"].substr(0, 7) +   " 예정)"; }
        if (apt_type == "분양(예정)") { aptYear = "(분양예정)"; }
      } else {
        if (aptDuration >= 30) { aptYear =   aptData.data[index]["준공년월"] +   " (" +   aptDuration +   "년차, 재건축 대상)"; }
        else { aptYear =   aptData.data[index]["준공년월"] + " (" + aptDuration + "년차)"; }
      }

      var nearestStation = aptData.data[index]["가까운역이름"] + "역" + "(" + ( Math.round(aptData.data[index]["가까운역거리"] * 100) / 100 ).toFixed() + "m)";
      var stationArea = aptData.data[index]["역세권여부"];
      var stationPoint_30m = aptData.data[index]["30분이내주요거점역"];
      var stationPoint_1h = aptData.data[index]["1시간이내주요거점역"];
      var departmentStore_3km = aptData.data[index]["3km이내백화점수"] + "개";
      var OutletMall_5km = aptData.data[index]["5km이내아울렛몰수"] + "개";
      var bigMart_1km = aptData.data[index]["1km이내대형먀트수"] + "개";
      var bank_500m = aptData.data[index]["500m이내은행수"] + "개";
      var hospital_500m = aptData.data[index]["500m이내병원수"] + "개";
      var bigHospital_5km = aptData.data[index]["5km이내대형병원수"] + "개";
      var park_500m = aptData.data[index]["500m이내공원수"] + "개";
      var big_park_1km = aptData.data[index]["800m이내대형공원수"] + "개";
      var harmful_3km = aptData.data[index]["3km이내혐오시설수"] + "개";
      var pSchool_edu = aptData.data[index]["초등학교학업성취도"];
      var pSchool_distance = aptData.data[index]["초등학교거리"];
      var mSchool_edu = aptData.data[index]["중학교학업성취도"] + "%";
      var academy_edu = aptData.data[index]["500m이내학원가"] + "개" + "(총 " + aptData.data[index]["500m이내학원수"] + "개 학원)";
      if (Number(selectedMonth) > 202208) {
        var academy_edu_long = aptData.data[index]["1km이내학원가"] + "개" + "(총 " + aptData.data[index]["1km이내학원수"] + "개 학원)";
      }
      var market_infra = aptData.data[index]["300m이내상권"] + "개" + "(총 " + aptData.data[index]["300m이내점포수"] + "개 지점)";
      var livingScore = (
        Math.round(aptData.data[index]["주거총점"] * 100) / 100
      ).toFixed(2);
      var transportScore = (
        Math.round(aptData.data[index]["교통총점"] * 100) / 100
      ).toFixed(2);
      var infraScore = (
        Math.round(aptData.data[index]["인프라총점"] * 100) / 100
      ).toFixed(2);
      var eduScore = (
        Math.round(aptData.data[index]["학군총점"] * 100) / 100
      ).toFixed(2);
      var area_info = aptData.data[index]["area_info"];
      if (Number(selectedMonth) > 202203) {
        var maintainance = aptData.data[index]["maintenance"];
      }
      var rooms = aptData.data[index]["room"];
      var baths = aptData.data[index]["bath"];
      var house_num = aptData.data[index]["세대수"];
      var parking = aptData.data[index]["주차"];
      var heating = aptData.data[index]["난방"];
      var entrance = aptData.data[index]["현관구조"];
      var sales_info = aptData.data[index]["sales_info"];
      var price_per = aptData.data[index]["price_per"];
      var floor_noise = aptData.data[index]["층간소음"];

      var searchCode = aptData.data[index]["검색코드"];
      var coord_y = aptData.data[index]["Y"];
      var coord_x = aptData.data[index]["X"];

      var drink_pub = aptData.data[index]["300m이내유흥주점"];
      var daran_pub = aptData.data[index]["300m이내단란주점"];
      var motel = aptData.data[index]["300m이내모텔"];

      var last_sales = aptData.data[index]["last_sales"].split(",");
      var last_sales_date = last_sales[0].toString();
      var last_sales_price = last_sales[1].toString();
      var last_sales_area = last_sales[2];

      if (Number(selectedMonth) > 202207) {
        var rent_info = aptData.data[index]["rent_info"];
        var rent_ratio = aptData.data[index]["rent_ratio"];
        var last_rent = aptData.data[index]["last_rent"].split(",");
        var last_rent_date = last_rent[0].toString();
        var last_rent_price = last_rent[1].toString();
        var last_rent_area = last_rent[2];
      }

      var floor_rate = "";
      if (aptData.data[index]["용적률"] == "0") {
        floor_rate = "--%";
      } else {
        floor_rate = aptData.data[index]["용적률"] + "%";
      }

      var cover_rate = "";
      if (aptData.data[index]["건폐율"] == "0") {
        cover_rate = "--%";
      } else {
        cover_rate = aptData.data[index]["건폐율"] + "%";
      }

      var populationScore =
        Math.round(aptData.data[index]["인구총점"] * 100) / 100;
      var jobScore = Math.round(aptData.data[index]["일자리총점"] * 100) / 100;

      if (Number(selectedMonth) > 202211) {
        shareURL = aptData.data[index]["sURL"];
        kakaoShareURL = "https://www.realrankus.com" + "?reg=" + selectedRegion + "&sub=" + selectedSubRegion + "&mon=" + selectedMonth + "&complex=" + index + "&sort=" + sortSelection + "&apt=" + short_name + " " + aptName;
      } else {
        shareURL = "https://www.realrankus.com" + "?reg=" + selectedRegion + "&sub=" + selectedSubRegion + "&mon=" + selectedMonth + "&complex=" + index + "&sort=" + sortSelection + "&apt=" + short_name + " " + aptName;
        kakaoShareURL = "https://www.realrankus.com" + "?reg=" + selectedRegion + "&sub=" + selectedSubRegion + "&mon=" + selectedMonth + "&complex=" + index + "&sort=" + sortSelection + "&apt=" + short_name + " " + aptName;

        //https://www.realrankus.com/?reg=Gyeonggi&sub=4146500000_Gyeonggi_Yongin_Suji&mon=202407&complex=0&sort=sortDefault&apt=%EC%83%81%ED%98%84%EB%8F%99%20%EA%B4%91%EA%B5%90%EC%9E%90%EC%9D%B4%EB%8D%94%ED%81%B4%EB%9E%98%EC%8A%A4
      }

      //타이틀
      //titleHtml += "<div class='popupTitle'>" + aptName + " " + apt_p + "(" + apt_m + ")</div>";
      //titleHtml += "<div class='popupTitle'><a href='#' onclick='return false;' style='text-decoration: none; color: black'>" + aptName + "</a></div>";
      titleHtml += "<div class='popupTitle'><h1 style='font-size: 1em; font-weight: 600'>" + aptName + "</h></div>";
      titleHtml += "<div class='popupSubtitle'>" + aptYear + "</div>";

      if (
        Number(selectedMonth) > 202203 &&
        (apt_type == "분양권" || apt_type == "분양(예정)")
      ) {
        titleHtml += "<div class='popupSubtitle'>" + aptData.data[index]["법정동주소"] + "</div>";
      } else {
        titleHtml += "<div class='popupSubtitle' style='font-size: 0.6em'>(신) " + aptAddress + "</div>";
        titleHtml += "<div class='popupSubtitle' style='font-size: 0.6em'>(구) " + aptData.data[index]["법정동주소"] + "</div>";
      }
      detailHtml += "<div class='card'>";
        detailHtml += "<div class='card-body' style='padding-top: 5px; padding-bottom: 5px;'>";
          detailHtml += "<div class='complex_like'>";

            detailHtml += "<div class='complex_like_category'>";
              detailHtml += "<div class='complex_like_living' onclick='complex_like_updown(\"living\", \"" + searchCode + "\", \"" + aptName + "\")'>";
                detailHtml += "<div class='complex_like_name'>주거</div>";
                detailHtml += "<div class='complex_like_num' id='complex_like_living_" + searchCode + "\'>";
                  detailHtml += "<div class='complex_like_thumb'><i class='fa-regular fa-thumbs-up'></i></div>";
                  detailHtml += "<div id='complex_like_num_living_" + searchCode + "\'>##</div>";
                detailHtml += "</div>";
              detailHtml += "</div>";
            detailHtml += "</div>";

            if (isNaN(transportScore) == false) {
              detailHtml += "<div class='complex_like_category'>";
                detailHtml += "<div class='complex_like_trans' onclick='complex_like_updown(\"trans\", \"" + searchCode + "\", \"" + aptName + "\")'>";
                  detailHtml += "<div class='complex_like_name'>교통</div>";
                  detailHtml += "<div class='complex_like_num' id='complex_like_trans_" + searchCode + "\'>";
                    detailHtml += "<div class='complex_like_thumb'><i class='fa-regular fa-thumbs-up'></i></div>";
                    detailHtml += "<div id='complex_like_num_trans_" + searchCode + "\'>##</div>";
                  detailHtml += "</div>";
                detailHtml += "</div>";
              detailHtml += "</div>";
            }
            
            detailHtml += "<div class='complex_like_category'>";
              detailHtml += "<div class='complex_like_infra' onclick='complex_like_updown(\"infra\", \"" + searchCode + "\", \"" + aptName + "\")'>";
                detailHtml += "<div class='complex_like_name'>인프라</div>";
                detailHtml += "<div class='complex_like_num' id='complex_like_infra_" + searchCode + "\'>";
                  detailHtml += "<div class='complex_like_thumb'><i class='fa-regular fa-thumbs-up'></i></div>";
                  detailHtml += "<div id='complex_like_num_infra_" + searchCode + "\'>##</div>";
                detailHtml += "</div>";
              detailHtml += "</div>";
            detailHtml += "</div>";
            
            detailHtml += "<div class='complex_like_category'>";
              detailHtml += "<div class='complex_like_edu' onclick='complex_like_updown(\"edu\", \"" + searchCode + "\", \"" + aptName + "\")'>";
                detailHtml += "<div class='complex_like_name'>교육</div>";
                detailHtml += "<div class='complex_like_num' id='complex_like_edu_" + searchCode + "\'>";
                  detailHtml += "<div class='complex_like_thumb'><i class='fa-regular fa-thumbs-up'></i></div>";
                  detailHtml += "<div id='complex_like_num_edu_" + searchCode + "\'>##</div>";
                detailHtml += "</div>";
              detailHtml += "</div>";
            detailHtml += "</div>";

          detailHtml += "</div>"
        detailHtml += "</div>"
      detailHtml += "</div>"

      //임장기
      detailHtml += "<div class='card'>";
      detailHtml += "<div class='card-header'>";
      detailHtml += "<div class='popTitle' id='blog_popTitle'><div><i class='fa-solid fa-tags'></i>&nbsp 리얼포스팅</div>";
      detailHtml += "<div id='blog_register' onClick='showBlogGuide()'><i class='fa-solid fa-circle-question'></i> 등록신청</div>";
      detailHtml += "</div></div>";
      detailHtml += "<div class='card-body' id='blog_list_area'>";
      detailHtml += "</div>";
      detailHtml += "</div>";

      //총점,순위
      detailHtml += "<div class='card'>";
      detailHtml += "<div class='card-header'>";

      var sortName = "";

      if (sortSelection == "sortDefault") {
        sortName = "균형잡힌";
      }
      if (sortSelection == "sortLiving") {
        sortName = "주거우선";
      }
      if (sortSelection == "sortTrans") {
        sortName = "교통우선";
      }
      if (sortSelection == "sortInfra") {
        sortName = "인프라우선";
      }
      if (sortSelection == "sortEdu") {
        sortName = "교육우선";
      }
      if (sortSelection == "sortCustom") {
        sortName = "커스텀";
      }

      if (rearrangeAPTSelection == "rearrangeRank") {
        sortName = "순위변동순";
      }
      if (rearrangeAPTSelection == "rearrangePrice") {
        sortName = "실거래가순";
      }
      if (rearrangeAPTSelection == "rearrangeNew") {
        sortName = "신축순";
      }
      if (rearrangeAPTSelection == "rearrangeHouse") {
        sortName = "세대수순";
      }

      detailHtml += "<div class='popupSubtitle' style='font-size: 0.75em; text-align: center'>- " + $("#sido option:selected").text() + " " + $("#gungu option:selected").text() + " -</div>";
      detailHtml += "<div class='popRank'>Rank " + complex_grade

      if (sortSelection == "sortDefault" && (rearrangeAPTSelection == "rearrangeScore" || rearrangeAPTSelection == "rearrangeRank")) {
        detailHtml += "<span class='ranksame'></div></div>"
      }
      else{
        detailHtml += "<span class='ranksame'> (" + sortName + ") </span>"  + "</div></div>"
      }

      /*
      if (selectedMonth == "202201") {
        detailHtml += "<div class='popRank'><i class='fas fa-trophy'></i> " + aptRank + "</div></div>";
      } else {
        detailHtml += "<div class='popRank'><i class='fas fa-trophy'></i> " + aptRank;

        if (sortSelection == "sortDefault" && (rearrangeAPTSelection == "rearrangeScore" || rearrangeAPTSelection == "rearrangeRank")) {
          if (aptData.data[index]["rank_gap"] == 0) {
            detailHtml += "<span class='ranksame'> (--) </span>";
          } else if (aptData.data[index]["rank_gap"] == 9999) {
            detailHtml += "<span class='ranksame'> (NEW!) </span>";
          } else if (aptData.data[index]["rank_gap"] > 0) {
            detailHtml +=
              "<span class='rankup'> (▲" +
              Math.abs(aptData.data[index]["rank_gap"]) +
              ")</span>";
          } else if (aptData.data[index]["rank_gap"] < 0) {
            detailHtml +=
              "<span class='rankdown'>(▼" +
              Math.abs(aptData.data[index]["rank_gap"]) +
              ")</span>";
          }
        } else {
          detailHtml += "<span class='ranksame'>(" + sortName + ") </span>";
        }
        detailHtml += "</div></div>";
      }
      */      

      if(login_status == false){
          detailHtml += "<div class='loginBox'>"
          detailHtml += "<div id='aptrankLoginGuide'>더 자세한 정보와 분석을 확인하세요</div>"
          detailHtml += "<div id='aptrankLoginButton' data-bs-toggle='modal' data-bs-target='#loginModal' onClick='showLogin()'>리얼랭커스 로그인</div>"
          detailHtml += "</div>"
        //$("#dataList").append(login_html);
        //$('#loginPopup').show()
      }
      else{
        detailHtml += "<div class='card-body' style='padding-top: 2px'>";
        detailHtml += "<div class='graph' style='height: 200px'> <canvas id='valueChart'></canvas></div>";
        detailHtml += "<div class='comment'>(지역구의 모든 단지에 대해 100점으로 환산한 상대 점수 입니다.)</div>";

        if (Number(selectedMonth) > 202206) {
          detailHtml += "<hr>";
          detailHtml += "<div class='popupSubtitle' style='text-align: center; margin-top: 10px'>↓↓ 내 생각과 다르다면, 데이터를 바꿔 보세요! ↓↓</div>";
          detailHtml += "<div id='rankSimul' onclick='openSimulation(aptData.data," + index + ")'>랭크 시뮬레이션 <span style='font-size: 0.8em; outline: 1px solid white; border-radius: 10px; padding: 0px 7px 0px 7px'> BETA </span></div>";
        }        
      }

      detailHtml += "</div></div>"

      /*
      if (Number(selectedMonth) > 202203) {
        detailHtml +=
          "<hr style='margin-bottom: 0'><div class='rankGraphTitle'>- 균형잡힌 가중치 순위 변동 -</div><div class='graph' style='height: 120px;'> <canvas id='rankChart'></canvas></div>";
      }
      */
      /*
    if(Number(selectedMonth) > 202205){
      detailHtml += "<div id='rankSimul' onclick='openSimulation(aptData.data," + index + ")'>랭크 시뮬레이션 <span style='font-size: 0.8em; outline: 1px solid white; border-radius: 10px; padding: 0px 7px 0px 7px'> BETA </span></div>"
    }
    */
      

      if (Number(selectedMonth) > 202212) {
        //지도
        detailHtml += "<div class='card'>";
        detailHtml += "<div class='card-body' style='padding: 0'>";

        if (apt_type == "분양(예정)") {
          go_url = "https://hogangnono.com/apt/" + searchCode;
        } else {
          if(isMobile){
            go_url = "https://m.land.naver.com/complex/info/" + searchCode;
          }
          else{
            go_url = "https://new.land.naver.com/complexes/" + searchCode;
          }
        }
        detailHtml += "<div id='part_map_wrap' onClick='goMap(go_url)'>";
        detailHtml += "<div id='detail_map' ></div>";
        detailHtml += "</div>";
        detailHtml += "</div></div></div>";
      }

      //주거
      detailHtml += "<div class='card'>";
      detailHtml += "<div class='card-header'>";
      detailHtml += "<div class='popTitle'><i class='fas fa-home'></i>&nbsp&nbsp주거</div>";
      detailHtml += "</div>";
      detailHtml += "<div class='card-body'>";
      detailHtml += "<div id='popLiving'>";
      if(login_status){
        detailHtml += "<div class='graph' style='height: 120px'> <canvas id='livingChart'></canvas></div>";
        if(apt_type == "분양(예정)"){
          detailHtml += "<div class='comment'>\'미정\' 항목이 있는 경우 평균치로 대체되어 계산되며,<br>향후 정보 업데이트에 따라 점수가 변경될 수 있습니다.</div><hr>";          
        }
        if(apt_type == "재건축"){
          detailHtml += "<div class='comment'>재건축의 경우, 향후 신축이 될 가능성을 고려하여<br>용적률과 건폐율로 주거 점수를 계산합니다.</div><hr>";          
        }        
      }      
      detailHtml += "<div class='popTable'>";
      if (Number(selectedMonth) > 202205 && aptData.data[index]["한강"] > 0) {
        detailHtml += "<div class='popSubTable'><div class='popContent'>" + "한강 프리미엄" + "</div>" + "<div class='popResult'>적용</div></div>";
      }
      if (Number(selectedMonth) > 202205 && aptData.data[index]["해운대"] > 0) {
        detailHtml += "<div class='popSubTable'><div class='popContent'>" + "해운대 프리미엄" + "</div>" + "<div class='popResult'>적용</div></div>";
      }

      if (house_num != null) {
        detailHtml += "<div class='popSubTable'><div class='popContent'>" + "세대수" + "</div>" + "<div class='popResult'>" + house_num.toLocaleString() + "세대</div></div>";
      } else {
        detailHtml += "<div class='popSubTable'><div class='popContent'>" + "세대수" + "</div>" + "<div class='popResult'>미정</div></div>";
      }

      if (Number(selectedMonth) > 202203) {
        if (apt_type >= "재건축") {
          detailHtml += "<div class='popSubTable'><div class='popContent'>" + "용적률" + "</div>" + "<div class='popResult'>" + floor_rate + "</div></div>";
          detailHtml += "<div class='popSubTable'><div class='popContent'>" + "건폐율" + "</div>" + "<div class='popResult'>" + cover_rate + "</div></div>";
        }
      } else {
        if (aptDuration >= 30) {
          detailHtml += "<div class='popSubTable'><div class='popContent'>" + "용적률" + "</div>" + "<div class='popResult'>" + floor_rate + "</div></div>";
          detailHtml += "<div class='popSubTable'><div class='popContent'>" + "건폐율" + "</div>" + "<div class='popResult'>" + cover_rate + "</div></div>";
        }
      }
      if (Number(selectedMonth) > 202203) {
        detailHtml += "<div class='popSubTable' id='popSubStation'><div class='popContent'>" + "주차" + "</div>" + "<div class='popResult'>" + parking + "</div></div>";
        detailHtml += "<div class='popSubTable'><div class='popContent'>" + "난방방식" + "</div>" + "<div class='popResult'>" + heating + "</div></div>";
        detailHtml += "<div class='popSubTable'><div class='popContent'>" + "현관구조" + "</div>" + "<div class='popResult'>" + entrance + "</div></div>";
      }

      //console.log(apt_type)

      if (Number(selectedMonth) > 202203) {
        if (apt_type == "분양(예정)") {
        } else {
          var area_array = area_info.split(",");
          var maintainance_array = maintainance.split(",");
          var rooms_array = rooms.split(",");
          var baths_array = baths.split(",");
          detailHtml +=
            "<div class='table-responsive' style='max-height: 200px; overflow-y: scroll'>";
          detailHtml +=
            "<table class='table table-striped' style='font-size:0.8em'>";
          detailHtml +=
            "<thead class='table-light' style='position:sticky ;top: 0'>";
          detailHtml += "<tr>";
          detailHtml += "<th scope='col'>" + "평형" + "</th>";
          detailHtml += "<th scope='col'>" + "방수/욕실수" + "</th>";
          detailHtml += "<th scope='col'>" + "평균 관리비" + "</th>";
          detailHtml += "</tr>";
          detailHtml += "</thead>";

          detailHtml += "<tbody>";
          for (var k = 0; k < area_array.length; k++) {
            detailHtml += "<tr>";
            detailHtml += "<td>" + area_array[k] + "</td>";
            detailHtml += "<td>" + parseInt(rooms_array[k]) + " / " + parseInt(baths_array[k]) + "</td>";
            if (isNaN(maintainance_array[k]) == true) {
              detailHtml += "<td>" + "---" + "</td>";
            } else {
              detailHtml += "<td>" + Number(maintainance_array[k]).toLocaleString() + "원" + "</td>";
            }
            detailHtml += "</tr>";
          }
          detailHtml += "</tbody>";
          detailHtml += "</table>";
          detailHtml += "</div>";
        }
      } else {
        detailHtml += "<div id='popSubLiving'><div class='popContent'>" + "면적 구성" + "<br>" + "<span class='popResult'>" + area_info + "</span></div></div>";
      }
      if(login_status){
        detailHtml += "<div class='comment2'>주거총점 계산을 위한 정보는 네이버 부동산으로 취득하며, 세대수/평형/난방방식 등의 항목을 상대점수로 산정합니다.</div>";
      }
      detailHtml += "</div></div></div></div>";
      avgLivingScore = Math.round((livingSum / itemNum) * 100) / 100;

      if (Number(selectedMonth) > 202207 && apt_type != "분양(예정)") {
        //층간소음
        detailHtml += "<div class='card'>";
        detailHtml += "<div class='card-header'>";
        detailHtml += "<div class='popTitle'><i class='fa-solid fa-bell-slash'></i>&nbsp&nbsp층간소음</div>";
        detailHtml += "</div>";
        detailHtml += "<div class='card-body' style='padding-top: 5px'>";
        detailHtml += "<div id='popLiving'>";
        detailHtml += "<div class='popTable'>";

        noise_level = "";

        if (floor_noise == "좋음" || floor_noise == "우수") {
          noise_level = "<span style='color:#148523'><i class='fa-solid fa-face-laugh'></i>" + "우수" + "</span>";
        } else if (floor_noise == "보통") {
          noise_level = "<span style='color:#148185'><i class='fa-solid fa-face-smile'></i>" + floor_noise + "</span>";
        } else {
          noise_level = "<span style='color:black'>" + "정보 없음" + "</span>";
        }

        detailHtml += "<div class='popSubTable'><div class='popContent'>" + "층간소음 관리" + "</div>" + "<div class='popResult'>" + noise_level + "</div></div>";
        detailHtml += "<div class='comment2' style='font-size: 0.7em'>층간소음 관리 정보는 층간소음 전문 연구소 <span style='color:#4542f5; font-weight:600'>주거문화개선연구소/층간소음에 안전한 아파트(앱)</span>에서 제공됩니다.</div>";
        detailHtml += "</div></div></div></div>";
      }

      if (isNaN(transportScore) == false) {
        //교통
        detailHtml += "<div class='card'>";
        detailHtml += "<div class='card-header'>";
        detailHtml += "<div class='popTitle'><i class='fas fa-bus'></i>&nbsp&nbsp교통</div>";
        detailHtml += "</div>";
        detailHtml += "<div class='card-body'>";
        detailHtml += "<div id='popTransport'>";
        if(login_status){
          detailHtml += "<div class='graph' style='height: 120px'> <canvas id='transportChart'></canvas></div>";
        }
        detailHtml += "<div class='popTable'>";
        detailHtml += "<div class='popSubTable' id='popSubStation'><div class='popContent'>" + "가장 가까운 역" + "</div>" + "<div class='popResult'>" + nearestStation + "</div></div>";
        if (Number(selectedMonth) > 202211) {
          var subway_line = aptData.data[index]["역노선"];
          detailHtml += "<div class='stationList'><div></div><div class='stationText'>" + subway_line + "</div></div>";
        }

        detailHtml += "<div class='popSubTable'><div class='popContent'>" + "30분 이내 도착 가능 주요역" + "</div>" + "<div class='popResult'>" + stationPoint_30m + "개</div></div>";
        if (stationPoint_30m != 0 && selectedMonth != "202201") {
          var stations_30m = aptData.data[index]["30분거점역이름"];
          stations_30m = stations_30m.replace("[", "").replace("]", "").replace(/\'/g, "");
          detailHtml += "<div class='stationList'><div></div><div class='stationText'>" + stations_30m + "</div></div>";
        }

        detailHtml += "<div class='popSubTable' id='stationTable'><div class='popContent'>" + "1시간 이내 도착 가능 주요역" + "</div>" + "<div class='popResult'>" + stationPoint_1h + "개</div></div>";
        if (stationPoint_1h != 0 && selectedMonth != "202201") {
          var stations_1h = aptData.data[index]["1시간거점역이름"];
          stations_1h = stations_1h.replace("[", "").replace("]", "").replace(/\'/g, "");
          detailHtml += "<div class='stationList'><div></div><div class='stationText'>" + stations_1h + "</div></div><hr style='margin-top: 2px'>";
        }

        detailHtml += "<div class='comment2'>가장 가까운 역은 직선거리로 계산됩니다.<br>주요역은 평일 출근시간대 하차인원이 가장 많은 역을 의미합니다.<br>30분, 1시간 이동 거리는 구글 대중교통 이동 시간 정보를 사용합니다.</div>";
        detailHtml += "</div></div></div></div>";
        avgTransportScore = ( Math.round((transportSum / itemNum) * 100) / 100 ).toFixed(2);
      }

      //인프라
      detailHtml += "<div class='card'>";
      detailHtml += "<div class='card-header'>";
      detailHtml += "<div class='popTitle'><i class='fas fa-hospital-user'></i>&nbsp&nbsp인프라</div>";
      detailHtml += "</div>";
      detailHtml += "<div class='card-body'>";
      detailHtml += "<div id='popInfra'>";
      if(login_status){
        detailHtml += "<div class='graph' style='height: 120px'> <canvas id='infraChart'></canvas></div>";
      }      
      detailHtml += "<div class='popTable'>";
      detailHtml += "<div class='popSubTable'><div class='popContent'>" + "3km 이내 백화점" + "</div>" + "<div class='popResult'>" + departmentStore_3km + "</div></div>";
      detailHtml += "<div class='popSubTable'><div class='popContent'>" + "5km 이내 아울렛/몰" + "</div>" + "<div class='popResult'>" + OutletMall_5km + "</div></div>";
      detailHtml += "<div class='popSubTable'><div class='popContent'>" + "1km 이내 대형마트" + "</div>" + "<div class='popResult'>" + bigMart_1km + "</div></div>";
      if (Number(selectedMonth) > 202204) {
        if (aptData.data[index]["300m이내상권"] == "0") {
          detailHtml += "<div class='popSubTable' style='grid-template-columns:1fr 1fr'><div class='popContent'>" + "300m 이내 상권" + "</div>" + "<div class='popResult'>0개</div></div>";
        } else {
          detailHtml += "<div class='popSubTable' style='grid-template-columns:1fr 1fr'><div class='popContent'>" + "300m 이내 상권" + "</div>" + "<div class='popResult'>" + market_infra + "</div></div>";
        }
      }
      detailHtml += "<div class='popSubTable'><div class='popContent'>" + "500m 이내 은행" + "</div>" + "<div class='popResult'>" + bank_500m + "</div></div>";
      detailHtml += "<div class='popSubTable'><div class='popContent'>" + "500m 이내 병원" + "</div>" + "<div class='popResult'>" + hospital_500m + "</div></div>";
      detailHtml += "<div class='popSubTable'><div class='popContent'>" + "5km 이내 대형병원" + "</div>" + "<div class='popResult'>" + bigHospital_5km + "</div></div>";
      detailHtml += "<div class='popSubTable'><div class='popContent'>" + "500m 이내 공원" + "</div>" + "<div class='popResult'>" + park_500m + "</div></div>";
      if (Number(selectedMonth) > 202205) {
        detailHtml += "<div class='popSubTable'><div class='popContent'>" + "1km 이내 대형공원" + "</div>" + "<div class='popResult'>" + big_park_1km + "</div></div>";
      }
      detailHtml += "<div class='popSubTable'><div class='popContent'>" + "3km 이내 혐오시설" + "</div>" + "<div class='popResult'>" + harmful_3km + "</div></div>";
      if (Number(selectedMonth) > 202204) {
        detailHtml += "<div class='comment2'>인프라 정보는 각 백화점/마트 홈페이지, 은행연합회, 자원순환정보시스템, 공공데이터 포탈의 정보를 기반으로 산정되며, 상권은 호갱노노 정보를 사용합니다.</div>";
      } else {
        detailHtml += "<div class='comment2'>인프라 정보는 각 백화점/마트 홈페이지, 은행연합회, 자원순환정보시스템, 공공데이터 포탈의 정보를 기반으로 산정됩니다.</div>";
      }
      detailHtml += "</div></div></div></div>";
      avgInfraScore = (Math.round((infraSum / itemNum) * 100) / 100).toFixed(2);

      //교육
      detailHtml += "<div class='card'>";
      detailHtml += "<div class='card-header'>";
      detailHtml += "<div class='popTitle'><i class='fas fa-graduation-cap'></i>&nbsp&nbsp교육</div>";
      detailHtml += "</div>";
      detailHtml += "<div class='card-body'>";
      detailHtml += "<div id='popEducation'>";
      if(login_status){
        detailHtml += "<div class='graph' style='height: 120px'> <canvas id='eduChart'></canvas></div>";
      }
      detailHtml += "<div class='popTable'>";
      if (Number(selectedMonth) > 202204) {
        if (pSchool_distance - 100 < 0) {
          minDistance = parseInt(pSchool_distance * 0.8);
        } else {
          minDistance = parseInt(pSchool_distance - 100);
        }
        maxDistance = parseInt(pSchool_distance);
        detailHtml += "<div class='popSubTable'><div class='popContent'>" + "초등학교 거리" + "</div>" + "<div class='popResult'>" + minDistance.toLocaleString() + "~" + maxDistance.toLocaleString() + "m</div></div>";
      }

      if (pSchool_edu > 95 && pSchool_edu <= 100) {
        pSchool_edu_result = "많은 전입";
      } else if (pSchool_edu >= 92 && pSchool_edu <= 95) {
        pSchool_edu_result = "적은 전입";
      } else if (pSchool_edu >= 88 && pSchool_edu < 92) {
        pSchool_edu_result = "전입/전출 적음";
      } else if (pSchool_edu >= 85 && pSchool_edu < 88) {
        pSchool_edu_result = "적은 전출";
      } else {
        pSchool_edu_result = "많은 전출";
      }
      detailHtml += "<div class='popSubTable'><div class='popContent'>" + "초등학교 학생증감" + "</div>" + "<div class='popResult'>" + pSchool_edu_result + "</div></div>";
      detailHtml += "<div class='popSubTable'><div class='popContent'>" + "중학교 보통 학력 이상" + "</div>" + "<div class='popResult'>" + mSchool_edu + "</div></div>";
      if (Number(selectedMonth) > 202204 && Number(selectedMonth) <= 202206) {
        detailHtml += "<div class='popSubTable' style='grid-template-columns:1fr 1fr'><div class='popContent'>" + "500m 이내 학원가" + "</div>" + "<div class='popResult'>" + academy_edu + "</div></div>";
        detailHtml += "<div class='comment2'>교육 정보는 교육통계서비스 정보를 기반으로 산정되며, 학원가는 호갱노노의 정보를 사용합니다.<br>초등학교까지의 거리는 직선거리로 계산됩니다.</div>";
      } else if (Number(selectedMonth) > 202206 && Number(selectedMonth) <= 202207) {
        detailHtml += "<div class='popSubTable' style='grid-template-columns:1fr 1fr'><div class='popContent'>" + "500m 이내 학원가" + "</div>" + "<div class='popResult'>" + academy_edu + "</div></div>";
        detailHtml += "<div class='popSubTable'><div class='popContent'>" + "300m 이내 유흥시설/모텔" + "</div>" + "<div class='popResult'>" + (drink_pub + daran_pub + motel) + "개</div></div>";
        detailHtml += "<div class='comment2'>교육 정보는 교육통계서비스 정보를 기반으로 산정되며,<br>학원가는 호갱노노의 정보를 사용합니다.<br>초등학교까지의 거리는 직선거리로 계산됩니다.<br>유흥시설과 모텔정보는 교육 감점요소로 적용됩니다.</div>";
      } else if (Number(selectedMonth) > 202307 && Number(selectedMonth) <= 202208) {
        detailHtml += "<div class='popSubTable' style='grid-template-columns:1fr 1fr'><div class='popContent'>" + "300m 이내 학원가" + "</div>" + "<div class='popResult'>" + academy_edu + "</div></div>";
        detailHtml += "<div class='popSubTable'><div class='popContent'>" + "300m 이내 유흥시설/모텔" + "</div>" + "<div class='popResult'>" + (drink_pub + daran_pub + motel) + "개</div></div>";
        detailHtml += "<div class='comment2'>교육 정보는 교육통계서비스 정보를 기반으로 산정되며,<br>학원가는 호갱노노의 정보를 사용합니다.<br>초등학교까지의 거리는 직선거리로 계산됩니다.<br>유흥시설과 모텔정보는 교육 감점요소로 적용됩니다.</div>";
      } else if (Number(selectedMonth) > 202308) {
        detailHtml += "<div class='popSubTable' style='grid-template-columns:1fr 1fr'><div class='popContent'>" + "300m 이내 학원가" + "</div>" + "<div class='popResult'>" + academy_edu + "</div></div>";
        detailHtml += "<div class='popSubTable' style='grid-template-columns:1fr 1fr'><div class='popContent'>" + "1km 이내 학원가" + "</div>" + "<div class='popResult'>" + academy_edu_long + "</div></div>";
        detailHtml += "<div class='popSubTable'><div class='popContent'>" + "300m 이내 유흥시설/모텔" + "</div>" + "<div class='popResult'>" + (drink_pub + daran_pub + motel) + "개</div></div>";
        detailHtml += "<div class='comment2'>교육 정보는 교육통계서비스 정보를 기반으로 산정되며,<br>학원가는 호갱노노의 정보를 사용합니다.<br>초등학교까지의 거리는 직선거리로 계산됩니다.<br>유흥시설과 모텔정보는 교육 감점요소로 적용됩니다.</div>";        
      } else {
        detailHtml +=
          "<div class='comment2'>교육 정보는 교육통계서비스 정보를 기반으로 산정됩니다.</div>";
      }
      detailHtml += "</div></div></div></div>";
      avgEduScore = (Math.round((eduSum / itemNum) * 100) / 100).toFixed(2);

      //실거래가
      if (Number(selectedMonth) > 202207) {
        var rent_info_array = rent_info.split(",");
        var rent_ratio_array = rent_ratio.split(",");
      }

      if (Number(selectedMonth) > 202203 && apt_type != "분양(예정)") {
        var sales_info_array = sales_info.split(",");
        var price_per_array = price_per.split(",");

        detailHtml += "<div class='card'>";
        detailHtml += "<div class='card-header'>";
        detailHtml +=
          "<div class='popTitle'><i class='fa-solid fa-coins'></i>&nbsp&nbsp실거래가 <span style='font-size: 0.7em; color:#fe4040'> (최근 1개월내 실거래는 빨간색으로 표시)</span> </div>";
        detailHtml += "</div>";
        detailHtml +=
          "<div class='card-body' style='padding-left: 5px ; padding-right: 5px; padding-top: 5px;'>";
        detailHtml += "<div id='popEducation'>";
        detailHtml += "<div class='popTable'>";
        detailHtml +=
          "<div id='popSubStation' style='grid-template-columns: 0.3fr 1fr; margin-left: 5px ; margin-right: 5px; margin-top: 10px;'>";
        detailHtml += "<div class='popContent'>최근 매매</div>";

        //var current_year = selectedMonth.substr(0, 4)
        //var current_month = selectedMonth.substr(4, 2) - 1
        //var current_day = "01"
        var start_date = new Date();
        start_date.setMonth(today.getMonth() - 1);

        if (isNaN(last_sales_price)) {
          detailHtml += "<div class='popResult'>거래 정보 없음</div></div>";
        } else {
          var compare_year = Number(last_sales_date.substr(0, 4));
          var compare_month = Number(last_sales_date.substr(5, 2) - 1);
          var compare_day = Number(last_sales_date.substr(8, 2));
          var compare_date = new Date(compare_year, compare_month, compare_day);

          if (compare_date > today) {
            detailHtml += "<div class='popResult' style='color: #fe4040'>" + last_sales_area + ", " + Math.round(last_sales_price / 100) / 100 + "억, " + last_sales_date.substr(2) + "</div></div>";
          } else {
            detailHtml += "<div class='popResult'>" + last_sales_area + ", " + Math.round(last_sales_price / 100) / 100 + "억, " + last_sales_date.substr(2) + "</div></div>";
          }
        }
        detailHtml += "<hr>";
        detailHtml += "<table class='table table-striped' style='font-size:0.8em'>";
        detailHtml += "<thead class='table-light'>";
        detailHtml += "<tr>";
        if (Number(selectedMonth) > 202207) {
          detailHtml += "<th scope='col' style='line-height: 2.9em;'>" + "평형" + "</th>";
          detailHtml += "<th scope='col'>" + "매매 실거래가<br>전세 실거래가" + "</th>";
          detailHtml += "<th scope='col'>" + "평단가<br>전세가율" + "</th>";
        } else {
          detailHtml += "<th scope='col'>" + "평형" + "</th>";
          detailHtml += "<th scope='col'>" + "실거래가" + "</th>";
          detailHtml += "<th scope='col'>" + "평단가" + "</th>";
        }
        detailHtml += "</tr>";
        detailHtml += "</thead>";

        detailHtml += "<tbody>";
        for (var k = 0; k < area_array.length; k++) {
          detailHtml += "<tr>";
          if (sales_info_array[k] == "거래 정보 없음") {
            if (Number(selectedMonth) > 202207) {
              detailHtml += "<td>" + area_array[k] + "</td>";
              detailHtml += "<td>" + "거래 정보 없음" + "<br>";
              if (rent_ratio_array[k] == "정보 없음") {
                detailHtml += "거래 정보 없음</td>";
              }
            } else {
              detailHtml += "<td>" + area_array[k] + "</td>";
              detailHtml += "<td>" + "거래 정보 없음" + "</td>";
            }
          } else {
            var sales_info_split = sales_info_array[k].split("억");
            var compare_year = Number(sales_info_split[1].substr(2, 4));
            var compare_month = Number(sales_info_split[1].substr(7, 2) - 1);
            var compare_day = Number(sales_info_split[1].substr(10, 2));
            var compare_date = new Date( compare_year, compare_month, compare_day );

            if (Number(selectedMonth) > 202207) {
              var rent_info_split = rent_info_array[k].split("억");
              if (rent_info_split[0] == "거래 정보 없음") {
              } else {
                var compare_rent_year = Number(rent_info_split[1].substr(2, 4));
                var compare_rent_month = Number(
                  rent_info_split[1].substr(7, 2) - 1
                );
                var compare_rent_day = Number(rent_info_split[1].substr(10, 2));
                var compare_rent_date = new Date( compare_rent_year, compare_rent_month, compare_rent_day );
              }

              if (compare_date > start_date) {
                detailHtml +=
                  "<td><span style='color:#fe4040; font-weight:600'>" +
                  area_array[k] +
                  "</span></td>";
                detailHtml +=
                  "<td><span style='color:#fe4040; font-weight:600'>" +
                  (Math.round(sales_info_split[0] * 100) / 100).toFixed(2) +
                  "억" +
                  "<span style='font-size: 0.85em'>" +
                  sales_info_split[1] +
                  "</span></span><br>";
              } else {
                detailHtml += "<td>" + area_array[k] + "</td>";
                detailHtml +=
                  "<td>" +
                  (Math.round(sales_info_split[0] * 100) / 100).toFixed(2) +
                  "억" +
                  "<span style='font-size: 0.85em'>" +
                  sales_info_split[1] +
                  "</span><br>";
              }

              if (compare_rent_date > start_date) {
                if (rent_info_split[0] == "거래 정보 없음") {
                  detailHtml += "거래 정보 없음</td>";
                } else {
                  detailHtml +=
                    "<span style='color:#fe4040; font-weight:600'>" +
                    (Math.round(rent_info_split[0] * 100) / 100).toFixed(2) +
                    "억" +
                    "<span style='font-size: 0.85em'>" +
                    rent_info_split[1] +
                    "</span></span></td>";
                }
              } else {
                if (rent_info_split[0] == "거래 정보 없음") {
                  detailHtml += "거래 정보 없음</td>";
                } else {
                  detailHtml +=
                    "" +
                    (Math.round(rent_info_split[0] * 100) / 100).toFixed(2) +
                    "억" +
                    "<span style='font-size: 0.85em'>" +
                    rent_info_split[1] +
                    "</span></td>";
                }
              }
            } else {
              if (compare_date > start_date) {
                detailHtml +=
                  "<td><span style='color:#fe4040; font-weight:600'>" +
                  area_array[k] +
                  "</span></td>";
                detailHtml +=
                  "<td><span style='color:#fe4040; font-weight:600'>" +
                  (Math.round(sales_info_split[0] * 100) / 100).toFixed(2) +
                  "억" +
                  "<span style='font-size: 0.85em'>" +
                  sales_info_split[1] +
                  "</span></span></td>";
              } else {
                detailHtml += "<td>" + area_array[k] + "</td>";
                detailHtml +=
                  "<td>" +
                  (Math.round(sales_info_split[0] * 100) / 100).toFixed(2) +
                  "억" +
                  "<span style='font-size: 0.85em'>" +
                  sales_info_split[1] +
                  "</span></td>";
              }
            }
          }

          if (Number(selectedMonth) > 202207) {
            if (price_per_array[k] == "nan" || price_per_array[k] == 0) {
              detailHtml += "<td>" + "---" + "<br>";
            } else {
              if (compare_date > start_date) {
                detailHtml +=
                  "<td><span style='color:#fe4040; font-weight:600'>" +
                  Number(price_per_array[k]).toLocaleString() +
                  "만원" +
                  "</span><br>";
              } else {
                detailHtml +=
                  "<td>" +
                  Number(price_per_array[k]).toLocaleString() +
                  "만원<br>";
              }
            }

            if (rent_ratio_array[k] == "정보 없음") {
              detailHtml += "---" + "</td>";
            } else {
              if (compare_rent_date > start_date) {
                detailHtml +=
                  "<span style='color:#fe4040; font-weight:600'>" +
                  (Math.round(rent_ratio_array[k] * 100) / 100).toFixed(2) +
                  "%" +
                  "</span></td>";
              } else {
                detailHtml +=
                  (Math.round(rent_ratio_array[k] * 100) / 100).toFixed(2) +
                  "%" +
                  "</td>";
              }
            }
          } else {
            if (price_per_array[k] == "nan") {
              detailHtml += "<td>" + "---" + "</td>";
            } else {
              if (compare_date > start_date) {
                detailHtml +=
                  "<td><span style='color:#fe4040; font-weight:600'>" +
                  Number(price_per_array[k]).toLocaleString() +
                  "만원" +
                  "</span></td>";
              } else {
                detailHtml +=
                  "<td>" +
                  Number(price_per_array[k]).toLocaleString() +
                  "만원" +
                  "</td>";
              }
            }
          }

          detailHtml += "</tr>";
        }
        detailHtml += "</tbody>";
        detailHtml += "</table>";
        detailHtml += "<div class='comment2'>&nbsp&nbsp실거래가 정보는 네이버 부동산으로 취득합니다.</div>";
        detailHtml += "</div></div></div></div>";
      }

      if (Number(selectedMonth) > 202209 && apt_type != "분양(예정)") {
        //매매 실거래가
        detailHtml += "<div class='card'>";
        detailHtml += "<div class='card-header'>";
        detailHtml += "<div class='popPriceTitle'><i class='fa-solid fa-chart-line'></i>&nbsp&nbsp매매가변동<span id='themeLogo'>BETA</span></div>";
        detailHtml += "</div>";

        detailHtml += "<div class='card-body' style='padding-top: 5px; padding-left: 5px; padding-right: 5px;'>";
        detailHtml += "<div class='priceHistoryOption'>";
        detailHtml += "<div style='text-align:left; padding-left:10px'><input type='checkbox' id='showGraph' onChange='graphShowHide(this)' style='width: 0.8em; height: 0.8em'>";
        detailHtml += "<label for='showGraph' style='font-size: 0.85em; padding-left: 3px'>그래프보기</label></input></div>";
        detailHtml += "<div style='text-align: right'><select id='pStart' onChange='price_sDateChange(this.value)'></select> - <select id='pEnd' onChange='price_eDateChange(this.value)'></select></div>";
        detailHtml += "</div>";
        detailHtml += "<div id='popEducation'>";
        detailHtml += "<div class='popTable'>";

        sales_history_price = aptData.data[index]["sales_history_price"];
        if (sales_history_price[0][0] == undefined) {
          sales_history_price = [sales_history_price];
        }
        sales_history_date = aptData.data[index]["매매실거래날짜목록"];
        //console.log(sales_history_price)

        priceCharts = [];
        for (var p = 0; p < area_array.length; p++) {
          generatedID = "pChart" + p;
          generated_priceID = "pChange" + p;
          generated_ratioID = "pRatio" + p;

          //console.log(sales_history_price[p])
          if (Math.max(...sales_history_price[p]) <= 0) {
            showGraph = false;
          } else {
            showGraph = true;
          }

          detailHtml += "<div class='popSubPriceTable' style='background: #eee'>";
          detailHtml += "<div class='priceResult' style='padding-left: 5px'>" + area_array[p] + "</div>";
          detailHtml += "<div class='popSubPriceTableDetail'>";
          if (showGraph) {
            detailHtml += "<div class='priceResult' style='text-align: right; padding-right: 4px'><span id=" + generated_priceID + "></span>" + "</div>";
            detailHtml += "<div class='priceResult' style='text-align: right; padding-right: 8px'><span id=" + generated_ratioID + "></span>" + "</div>";
          } else {
            detailHtml += "<div class='priceResult' style='text-align: right; padding-right: 4px'>거래 정보 없음" + "</div>";
            detailHtml += "<div class='priceResult' style='text-align: right; padding-right: 8px'>( --- , --- )</div>";
          }
          detailHtml += "</div>";
          detailHtml += "</div>";

          detailHtml += "<div class='priceGraph' style='height: 100px; border-bottom: 1px solid #ddd'> <canvas id=" + generatedID + "></canvas></div>";
          priceCharts.push(generatedID);
        }
        detailHtml += "</div></div></div></div>";
      }

      //지역구
      if(login_status){
        detailHtml += "<div class='card'>";
        detailHtml += "<div class='card-header'>";
        detailHtml += "<div class='popTitle'><i class='fas fa-layer-group'></i>&nbsp&nbsp" + $("#sido option:selected").text() + " " + $("#gungu option:selected").text() + "</div>";
        detailHtml += "</div>";
        detailHtml += "<div class='card-body'>";
        detailHtml += "<div id='popEducation'>";
        detailHtml += "<div class='graph' style='height: 120px'> <canvas id='regionChart'></canvas></div>";
        detailHtml += "<div class='comment2'>지역구 정보는 공공데이터포탈 정보를 기반으로 산정됩니다.</div>";
        detailHtml += "</div></div></div>";
      }

      //Footer에 네이버 부동산 버튼
      footerHtml += "<div class='modal-footer'>";
      //footerHtml += "<div></div>"
      shareTitle = "[리얼랭커스 ";
      shareTitle +=
        selectedMonth.substr(2, 2) +
        "년 " +
        Number(selectedMonth.substr(4, 2)).toString() +
        "월]\n\n";

      shareText = "『" + aptName;
      if (Number(selectedMonth) > 202203) {
        if (apt_type == "재건축") {
          shareText += "(" + aptDuration + "년차, 재건축)』";
        } else if (apt_type == "분양권") {
          shareText +=
            "(" + aptData.data[index]["준공년월"].substr(0, 7) + " 예정)』";
        } else {
          shareText += "(" + aptDuration + "년차)』";
        }
      } else {
        if (aptDuration >= 30) {
          shareText += "(" + aptDuration + "년차, 재건축 대상)』";
        } else {
          shareText += "(" + aptDuration + "년차)』";
        }
      }

      shareText +=
        "\nㆍ지역 : " +
        $("#sido option:selected").text() +
        " " +
        $("#gungu option:selected").text();
      //shareText += "\nㆍ순위 : " + aptRank + " (" + sortName + ")";
      shareText += "\nㆍ등급 : Rank " + complex_grade + " (" + sortName + ")";

      if (isNaN(last_sales_price)) {
        shareText += "\nㆍ최근실거래 : 거래 정보 없음";
      } else {
        shareText +=
          "\nㆍ최근실거래\n    : " +
          last_sales_area +
          ", " +
          Math.round(last_sales_price / 100) / 100 +
          "억, " +
          last_sales_date.substr(2);
      }
      if (house_num == null) {
        house_num = 0;
      }

      if (Number(selectedMonth) > 202203) {
        if (apt_type >= "재건축") {
          shareText += "\nㆍ용적률 : " + floor_rate;
          shareText += "\nㆍ건폐율 : " + cover_rate;
        } else {
          shareText += "\nㆍ세대수 : " + house_num.toLocaleString() + "세대";
          shareText += "\nㆍ주차 : " + parking;
        }
      } else {
        if (aptDuration >= 30) {
          shareText += "\nㆍ용적률 : " + floor_rate;
          shareText += "\nㆍ건폐율 : " + cover_rate;
        } else {
          shareText += "\nㆍ세대수 : " + house_num.toLocaleString() + "세대";
          shareText += "\nㆍ주차 : " + parking;
        }
      }

      //if(aptData.data[index]["가까운역이름"] != "NA" || aptData.data[index]["가까운역이름"] != null){
      //  shareText += "\nㆍ가장 가까운 역 : " + nearestStation
      //}
      shareText += "\nㆍ5km 이내 대형병원 : " + bigHospital_5km;
      shareText += "\nㆍ중학교 보통 학력 이상 : " + mSchool_edu;
      shareText += "\n";

      shareText += "\n" + shareURL;

      if (UserAgent.indexOf("inApp") > -1) {
        if (apt_type == "분양(예정)") {
          footerHtml +=
            "<div><button type='button' class='goLink_HGNN' onclick='openHGNN(\"" +
            searchCode +
            "\")'>호갱노노 보기</button></div>";
        } else {
          footerHtml +=
            "<div><button type='button' class='goLink' onclick='openNaver(" +
            searchCode +
            ")'>네이버 부동산 보기</button></div>";
        }

        if (checkMobile() == "ios") {
          footerHtml +=
            "<div class='tShare' onClick='share(shareTitle, shareText, shareURL)'><i class='fa-solid fa-arrow-up-right-from-square'></i></div>";
        } else {
          footerHtml +=
            "<div class='kakaoShare' onClick='kakaoShare(shareTitle, shareText, kakaoShareURL)'><img src = './kakao_icon.png' height='32px'></div>";
        }

        footerHtml +=
          "<div class='tShare' onClick='CopyToClipboard(shareText, popMsg)'><i class='fa-regular fa-copy'></i></div>";
      } else {
        if (apt_type == "분양(예정)") {
          footerHtml +=
            "<div><button type='button' class='goLink_HGNN' onclick='openHGNN(\"" +
            searchCode +
            "\")'>호갱노노 보기</button></div>";
        } else {
          footerHtml +=
            "<div><button type='button' class='goLink' onclick='openNaver(\"" +
            searchCode +
            "\")'>네이버 부동산 보기</button></div>";
        }

        if (checkMobile() == "ios") {
          footerHtml +=
            "<div class='tShare' onClick='CopyToClipboard(shareText, popMsg)'><i class='fa-regular fa-copy'></i></div>";
        } else {
          footerHtml +=
            "<div class='kakaoShare' onClick='kakaoShare(shareTitle, shareText, kakaoShareURL)'><img src = './kakao_icon.png' height='32px'></div>";
        }

        footerHtml +=
          "<div class='tShare' onClick='share(shareTitle, shareText, shareURL)'><i class='fa-solid fa-arrow-up-right-from-square'></i></div>";
      }
      footerHtml += "</div>";

      $("#baseModalLabel").html(titleHtml);
      $("#aptDetail").html(detailHtml);
      $("#footer").html(footerHtml);

      //임장기 로딩해서 넣는 함수
      complex_blog(searchCode, aptName) 

      //지도 그리는 함수
      if (isMobile) {
        var dw = $(window).innerWidth() - 40;
        //var dw = 372;
      } else {
        var dw = 459;
      }
      var dh = 200;

      if (Number(selectedMonth) > 202212) {
        var detailMapOptions = {
          center: new naver.maps.LatLng(Number(coord_y)+0.0003, Number(coord_x)+0.0003),
          size: new naver.maps.Size(dw, dh),
          zoom: 16, //지도의 초기 줌 레벨
          zoomControl: false, //줌 컨트롤의 표시 여부
          draggable: false,
          pinchZoom: false,
          scrollWheel: false,
          keyboardShortcuts: false,
          disableDoubleTapZoom: true,
          disableDoubleClickZoom: true,
          disableTwoFingerTapZoom: true,
        };

        var detailMap = new naver.maps.Map("detail_map", detailMapOptions);

        ///////////////////////////////////////        
        var last_sales_date = last_sales[0].toString();
        var last_sales_price = last_sales[1].toString();
        var last_sales_area = last_sales[2];

        if (isNaN(last_sales_price)) {
          last_sales_price_kor = "정보없음"
          last_sales_area_kor = "--"
        } else {
          last_sales_price_kor = Math.round(last_sales_price / 100) / 100 + "억"
          last_sales_area_kor = last_sales_area
        }
        
        var svg_color = "#CC0000"
        var grade = ""
        if(aptValue >= 70){
          svg_color = "#CC0000"
          grade = "gradeS"
        }
        else if(aptValue < 70 && aptValue >= 55){
          svg_color = "#F72020"
          grade = "gradeA"
        }
        else if(aptValue < 55 && aptValue >= 40){
          svg_color = "#F36637"
          grade = "gradeB"
        }
        else{
          svg_color = "#ED8618"
          grade = "gradeC"
        }

        svg_loc_detail = `
        <svg version="1.1" class="detail_marker_${grade}" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
            viewBox="0 0 35 35" style="enable-background:new 0 0 800 1200;" xml:space="preserve" width="68", height="60">
            
        <defs>
        <style>
        .detail_marker_${grade}{fill:${svg_color}}
        .large_marker_${grade} {stroke:${svg_color}; stroke-width:0.5}      
        .cls-2{fill:#fff;}
        .cls-3_text{fill:#fff; font-size:8px; font-weight:600}
        .cls-4_text{fill:#000; font-size:7px; font-weight:600}            
        .cls-5_text{fill:#000; font-size:5px; font-weight:600}
        .cls-6_text{fill:#000; font-size:4px; font-weight:600}
        </style>
        </defs>
        <g class="svg_loc_large">
        <path class="cls-1 large_marker_${grade}" d="M.12,12.29V8.81A.88.88,0,0,1,.55,8L15.31.47a3.07,3.07,0,0,1,2.83,0L33,8a.85.85,0,0,1,.43.77v3.48Z"/>
        <path class="cls-2 large_marker_${grade}" d="M.13,12.29V26.36c0,1.37.63,2.47,1.4,2.47H3.36L4.52,31l1.16,2.15L6.84,31,8,28.83H32.06c.78,0,1.41-1.1,1.41-2.47V12.29Z"/>
        <text class="cls-3_text" text-anchor="middle" x="16.5" y="10">${complex_grade}</text>
        <text class="cls-4_text" text-anchor="middle" x="17" y="20">${last_sales_price_kor}</text>
        <text class="cls-5_text" text-anchor="middle" x="17" y="26">${last_sales_area_kor}</text>
        </g>
        </svg>
        `
        var detailMarker = new naver.maps.Marker({
          position: new naver.maps.LatLng(Number(coord_y), Number(coord_x)),
          icon: {
              content: svg_loc_detail,
              size: new naver.maps.Size(24, 37),
              anchor: new naver.maps.Point(12, 60),
              origin: new naver.maps.Point( Number(coord_y), Number(coord_x)),
          },
          zIndex: 100,
          map: detailMap,
        });
        ///////////////////////////////////////
      }

      if (isNaN(transportScore) == false){
        $(".complex_like").css({'grid-template-columns': '1fr 1fr 1fr 1fr'})
      }
      else{
        $(".complex_like").css({'grid-template-columns': '1fr 1fr 1fr'})
      }
      //if(UserAgent.indexOf("inApp")>-1){
      //  $('.modal-footer').css({"grid-template-columns" : "0.2fr 1fr 0.2fr", "text-align":"center", "text-align": "-webkit-center"})
      //}
      //else{
      $(".modal-footer").css({
        "grid-template-columns": "1fr 0.15fr 0.15fr",
        "text-align": "center",
        "text-align": "-webkit-center",
      });
      //}

      /*
      if (Number(selectedMonth) > 202203) {
        rank_history = aptData.data[index]["rank_history"];
        rankMonth = [""];
        rankData = [null];
        for (var j = 0; j < rank_history.length; j++) {
          if (rank_history[j][1] == 9999) {
          } else if (rank_history[j][1] == 0) {
            rankMonth.push(
              "'" +
                rank_history[j][0].substr(2, 2) +
                "." +
                rank_history[j][0].substr(4, 2)
            );
            rankData.push(aptData.data[index]["rank"]);
          } else {
            rankMonth.push(
              "'" +
                rank_history[j][0].substr(2, 2) +
                "." +
                rank_history[j][0].substr(4, 2)
            );
            rankData.push(rank_history[j][1]);
          }
        }
        rankMonth.push("");
        rankData.push(null);

        rankMonth.reverse();
        rankData.reverse();
        drawRankChart(rankMonth, rankData, aptData.data[itemNum - 1]["rank"]);
      }
      */

      if(login_status){
        drawChart( aptValue.toFixed(2), livingScore, transportScore, infraScore, eduScore );
        drawSubChart( livingScore, avgLivingScore, "주거총점", "지역평균", "#fe4040", "#9f9f9f", "livingChart" );
        if (isNaN(transportScore) == false) {
          drawSubChart( transportScore, avgTransportScore, "교통총점", "지역평균", "#fe4040", "#9f9f9f", "transportChart" );
        }
        drawSubChart( infraScore, avgInfraScore, "인프라총점", "지역평균", "#fe4040", "#9f9f9f", "infraChart" );
        drawSubChart( eduScore, avgEduScore, "교육총점", "지역평균", "#fe4040", "#9f9f9f", "eduChart" );
        drawSubChart( eduScore, avgEduScore, "인구총점", "일자리총점", "#fe4040", "#fe4040", "regionChart" );
      }

      if (Number(selectedMonth) > 202209) {
        price_sOption = "";
        price_eOption = "";
        for (w = 0; w < sales_history_date.length - 1; w++) {
          price_sOption +=
            "<option value='" +
            w +
            "'>" +
            "'" +
            sales_history_date[w].substr(2, 2) +
            "." +
            sales_history_date[w].substr(4, 2) +
            "</option>";
        }
        for (w = 1; w < sales_history_date.length; w++) {
          price_eOption +=
            "<option value='" +
            w +
            "'>" +
            "'" +
            sales_history_date[w].substr(2, 2) +
            "." +
            sales_history_date[w].substr(4, 2) +
            "</option>";
        }
        $("#pStart").html(price_sOption);
        $("#pStart").val(5).prop("selected", true);

        $("#pEnd").html(price_eOption);
        $("#pEnd")
          .val(sales_history_date.length - 1)
          .prop("selected", true);

        if (apt_type != "분양(예정)") {
          priceChartDraw(
            priceCharts,
            sales_history_price,
            sales_history_date,
            0,
            sales_history_date.length
          );
        }
      }

      //초기 그래프 표시 안 함
      $(".priceGraph").hide();
      $(".popSubPriceTable").css({
        "margin-top": "3px",
        "margin-bottom": "0px",
      });
      price_sDateChange($("#pStart").val());
      setComplexLike(searchCode.toString(), aptName)

      //리스트 선택 시, 지도 아이콘 애니메이션
      mapBounds = defaultMap.getBounds();
      current_zoom = defaultMap.getZoom()      
      target_position = {'lat':coord_y, 'lng':coord_x}

      if(mapBounds.hasLatLng(target_position)){
        if(current_zoom >= zoom_levels[0]){      
          marker_obj = window["large_marker_obj_" + searchCode]
        }
        else if(current_zoom < zoom_levels[0] && current_zoom >= zoom_levels[1]){      
          marker_obj = window["small_marker_obj_" + searchCode]
        }
        marker_obj.setZIndex(marker_z_depth += 1)
        animateMarker(marker_obj)
      }
      else{
        defaultMap.setCenter(target_position)
        if(current_zoom >= zoom_levels[0]){      
          marker_obj = window["large_marker_obj_" + searchCode]
        }
        else if(current_zoom < zoom_levels[0] && current_zoom >= zoom_levels[1]){      
          marker_obj = window["small_marker_obj_" + searchCode]
        }
        marker_obj.setZIndex(marker_z_depth += 1)
        animateMarker(marker_obj)        
      }

      if(current_zoom < zoom_levels[1]){
        defaultMap.setZoom(zoom_levels[0])
      }
      
      prev_selection = current_selection
      current_selection = searchCode

      /*
      //리스트 이동
      if(isMobile){
        table_offset_y = 165
      }
      else{
        table_offset_y = 175
      }
      scroll_back = "#dataList_wrapper"        
      find_id = "#aptSelect_" + index

      currentY = $(scroll_back).scrollTop()
      offsetY = $(find_id).offset().top - table_offset_y
      destY = Math.abs(currentY + offsetY)        
      $(scroll_back).animate( { scrollTop : destY }, 1500, 'easeOutQuart');
      */

      $("#pageLoadingBack").remove()
    }

    function changeMetaTag(aptName, addr, rank, short_name, url, aptValue) {
      dong_name = "";
      split_addr = addr.split(" ");
      if (split_addr[1].slice(-1) == "구") {
        dong_name = split_addr[2];
      } else {
        if (split_addr[2].slice(-1) == "구") {
          dong_name = split_addr[3];
        } else {
          dong_name = split_addr[2];
        }
      }

      main_title =
        "'" +
        dong_name +
        " " +
        aptName +
        "'" +
        " 입지분석, 시세, 실거래가 | 표준화된 리얼랭커스 입지분석";
      $(document).attr("title", main_title);

      meta_title =
        "'" +
        aptName +
        "'" +
        "의 입지 점수는 " +
        aptValue +
        "점 | 표준화된 리얼랭커스 입지분석";
      $("meta[property='og\\:title']").attr("content", main_title);

      $("meta[property='og\\:url']").attr("content", url);

      meta_description =
        "'" +
        aptName +
        "'" +
        "의 주거, 교통, 인프라, 교육 환경 분석 정보를 데이터로 확인하세요.";
      $("meta[property='og\\:description']").attr("content", meta_description);

      $("meta[property='og\\:site_name']").attr("content", "리얼랭커스");

      $("meta[name='twitter\\:card']").attr("content", "summary");
      $("meta[name='twitter\\:url']").attr("content", url);
      $("meta[name='twitter\\:title']").attr("content", meta_title);
      $("meta[name='twitter\\:description']").attr("content", meta_description);

      //$('link[rel=canonical]').attr('href', 'https://realrankus.com/apt/' + aptName);
    }

    function changeMetaTagToDefault() {
      main_title = "리얼랭커스 - 데이터로 분석된 아파트 입지 순위";
      $(document).attr("title", main_title);

      meta_title = "객관적이고 표준화된 아파트 입지분석 | 리얼랭커스";
      $("meta[property='og\\:title']").attr("content", main_title);

      $("meta[property='og\\:url']").attr("content", "https://www.realrankus.com/");

      meta_description = "데이터로 분석된 대한민국 아파트 입지";
      $("meta[property='og\\:description']").attr("content", meta_description);

      $("meta[property='og\\:site_name']").attr("content", "리얼랭커스");

      $("meta[name='twitter\\:card']").attr("content", "summary");
      $("meta[name='twitter\\:url']").attr(
        "content",
        "https://www.realrankus.com/"
      );
      $("meta[name='twitter\\:title']").attr("content", meta_title);
      $("meta[name='twitter\\:description']").attr("content", meta_description);
    }

    function graphShowHide(obj) {
      if (obj.checked) {
        $(".priceGraph").show();
        $(".popSubPriceTable").css({
          "margin-top": "10px",
          "margin-bottom": "10px",
        });
      } else {
        $(".priceGraph").hide();
        $(".popSubPriceTable").css({
          "margin-top": "3px",
          "margin-bottom": "0px",
        });
      }
    }

    function price_sDateChange(val) {
      startVal = Number(val) + 1;
      endVal = $("#pEnd").val();

      eDateOption = "";
      for (var w = startVal; w < sales_history_date.length; w++) {
        eDateOption +=
          "<option value='" +
          w +
          "'>" +
          "'" +
          sales_history_date[w].substr(2, 2) +
          "." +
          sales_history_date[w].substr(4, 2) +
          "</option>";
      }
      $("#pEnd").html(eDateOption);

      if (endVal > startVal) {
        $("#pEnd").val(endVal).prop("selected", true);
      } else {
        endVal = $("#pEnd").val();
      }

      priceChartUpdate(
        priceCharts,
        sales_history_price,
        sales_history_date,
        startVal,
        endVal
      );
    }

    function price_eDateChange(val) {
      startVal = $("#pStart").val();
      endVal = Number(val) - 1;

      priceChartUpdate(
        priceCharts,
        sales_history_price,
        sales_history_date,
        startVal,
        endVal
      );
    }

    function priceChartUpdate(
      priceChart,
      sales_history_price,
      sales_history_date,
      sVal,
      eVal
    ) {
      for (var p = 0; p < priceChart.length; p++) {
        sales_grayHistory1 = [];
        sales_pHistory = [];
        sales_grayHistory2 = [];

        sales_pHistory.push(null);
        sales_grayHistory1.push(null);
        sales_grayHistory2.push(null);

        sales_dHistory = [];
        sales_dHistory.push("");

        for (var y = 0; y < sales_history_date.length; y++) {
          if (y < sVal) {
            if (sales_history_price[p][y] == 0) {
              sales_grayHistory1.push(0);
            } else {
              sales_grayHistory1.push(
                (sales_history_price[p][y] / 10000).toFixed(1)
              );
            }
            sales_pHistory.push(null);
            sales_grayHistory2.push(null);
          }
          if (y >= sVal && y <= eVal) {
            sales_grayHistory1.push(null);
            if (sales_history_price[p][y] == 0) {
              sales_pHistory.push(0);
            } else {
              sales_pHistory.push(
                (sales_history_price[p][y] / 10000).toFixed(1)
              );
            }
            sales_grayHistory2.push(null);
          }
          if (y > eVal) {
            sales_grayHistory1.push(null);
            sales_pHistory.push(null);
            if (sales_history_price[p][y] == 0) {
              sales_grayHistory2.push(0);
            } else {
              sales_grayHistory2.push(
                (sales_history_price[p][y] / 10000).toFixed(1)
              );
            }
          }
          //sales_pHistory.push( (sales_history_price[p][y]/10000).toFixed(1) )
          sales_dHistory.push(
            "'" +
              sales_history_date[y].substr(2, 2) +
              "." +
              sales_history_date[y].substr(4, 2)
          );
        }
        sales_pHistory.push(null);
        sales_grayHistory1.push(null);
        sales_grayHistory2.push(null);
        sales_dHistory.push("");

        chartView[p].data.datasets[0].data = sales_grayHistory1;
        chartView[p].data.datasets[1].data = sales_pHistory;
        chartView[p].data.datasets[2].data = sales_grayHistory2;
        chartView[p].update();

        sPrice = sales_history_price[p][sVal];
        ePrice = sales_history_price[p][eVal - 1];
        priceGap = ((ePrice - sPrice) / 10000).toFixed(2);
        priceRatio = ((ePrice / sPrice - 1) * 100).toFixed(1);

        priceChangeText = "";
        priceChangeText +=
          (sPrice / 10000).toFixed(2) +
          " → " +
          (ePrice / 10000).toFixed(2) +
          "억";

        priceRatioText = "";
        if (sPrice == 0) {
          priceRatioText += " ( --- , --- )";
        } else {
          if (priceGap >= 0) {
            priceRatioText += " (+" + priceGap + "억, ";
          } else {
            priceRatioText += " (" + priceGap + "억, ";
          }

          if (priceRatio > 0) {
            priceRatioText +=
              "<span style='color:#fe4040'>▲" + priceRatio + "%</span>)";
          } else if (priceRatio == 0) {
            priceRatioText +=
              "<span style='color:#000'>" + priceRatio + "%</span>)";
          } else {
            priceRatioText +=
              "<span style='color:blue'>▼" + priceRatio * -1 + "%</span>)";
          }
        }
        $("#pChange" + p).html(priceChangeText);
        $("#pRatio" + p).html(priceRatioText);
      }
    }

    function priceChartDraw(
      priceChart,
      sales_history_price,
      sales_history_date,
      sVal,
      eVal
    ) {
      for (var p = 0; p < priceChart.length; p++) {
        sales_grayHistory1 = [];
        sales_pHistory = [];
        sales_grayHistory2 = [];

        sales_pHistory.push(null);
        sales_grayHistory1.push(null);
        sales_grayHistory2.push(null);

        sales_dHistory = [];
        sales_dHistory.push("");

        for (var y = 0; y < sales_history_date.length; y++) {
          if (y < sVal) {
            if (sales_history_price[p][y] == 0) {
              sales_grayHistory1.push(0);
            } else {
              sales_grayHistory1.push(
                (sales_history_price[p][y] / 10000).toFixed(1)
              );
            }
            sales_pHistory.push(null);
            sales_grayHistory2.push(null);
          }
          if (y >= sVal && y <= eVal) {
            sales_grayHistory1.push(null);
            if (sales_history_price[p][y] == 0) {
              sales_pHistory.push(0);
            } else {
              sales_pHistory.push(
                (sales_history_price[p][y] / 10000).toFixed(1)
              );
            }
            sales_grayHistory2.push(null);
          }
          if (y > eVal) {
            sales_grayHistory1.push(null);
            sales_pHistory.push(null);
            if (sales_history_price[p][y] == 0) {
              sales_grayHistory2.push(0);
            } else {
              sales_grayHistory2.push(
                (sales_history_price[p][y] / 10000).toFixed(1)
              );
            }
          }
          //sales_pHistory.push( (sales_history_price[p][y]/10000).toFixed(1) )
          sales_dHistory.push(
            "'" +
              sales_history_date[y].substr(2, 2) +
              "." +
              sales_history_date[y].substr(4, 2)
          );
        }
        sales_pHistory.push(null);
        sales_grayHistory1.push(null);
        sales_grayHistory2.push(null);
        sales_dHistory.push("");

        priceMax = Math.max(...sales_pHistory) * 1.3;
        drawPriceChart(
          sales_dHistory,
          sales_grayHistory1,
          sales_pHistory,
          sales_grayHistory2,
          priceChart[p],
          priceMax,
          p
        );

        sPrice = sales_history_price[p][sVal];
        ePrice = sales_history_price[p][eVal - 1];
        priceGap = ((ePrice - sPrice) / 10000).toFixed(2);
        priceRatio = ((ePrice / sPrice - 1) * 100).toFixed(1);

        sPrice = sales_history_price[p][sVal];
        ePrice = sales_history_price[p][eVal - 1];
        priceGap = ((ePrice - sPrice) / 10000).toFixed(2);
        priceRatio = ((ePrice / sPrice - 1) * 100).toFixed(1);

        priceChangeText = "";
        priceChangeText +=
          (sPrice / 10000).toFixed(2) +
          " → " +
          (ePrice / 10000).toFixed(2) +
          "억";

        priceRatioText = "";
        if (sPrice == 0) {
          priceRatioText += " ( --- , --- )";
        } else {
          if (priceGap >= 0) {
            priceRatioText += " (+" + priceGap + "억, ";
          } else {
            priceRatioText += " (" + priceGap + "억, ";
          }

          if (priceRatio > 0) {
            priceRatioText +=
              "<span style='color:#fe4040'>▲" + priceRatio + "%</span>)";
          } else if (priceRatio == 0) {
            priceRatioText +=
              "<span style='color:#000'>" + priceRatio + "%</span>)";
          } else {
            priceRatioText +=
              "<span style='color:blue'>▼" + priceRatio * -1 + "%</span>)";
          }
        }
        $("#pChange" + p).html(priceChangeText);
        $("#pRatio" + p).html(priceRatioText);
      }
    }

    function updateRegionTable(month, region) {
      //$('html').scrollTop(0)
      $("#sort").css("visibility", "hidden");
      $("#rearrange").css("visibility", "visible");
      //url = "https://www.realrankus.com/" + month + "/" + region + ".json" + update_ver;
      url = "./" + month + "/" + region + ".json" + update_ver;

      $("#dataList_wrapper").css({'margin-top':'96px', 'height': window.innerHeight - ( $("#titleBar").height() + $("#selections").height() + 23 +$("#linkToAptrank_bottom").height() )})      

      if(isMobile){        
        $("#dataMap").css({'margin-top':$("#titleBar").height() + $("#selections").height() + 20,
                          'height': window.innerHeight - ( $("#titleBar").height() + $("#selections").height() + $("#linkToAptrank_bottom").height() )})
      }      
      $("#dataList").html("");      

      //광고정보 로딩
      $.ajaxSetup({ async: false });
      load_parrtnership(region);
      $.ajaxSetup({ async: true });

      $.getJSON(url, function (json) {
        regData = json;
        regSortData = regData;
        itemNum = json.data.length;
        regValueSum = 0;
        regSupplySum = 0;
        regPopSum = 0;
        regJobSum = 0;
      }).done(function(){
        //광고정보표시
        show_partnership();

        for (var i = 0; i < itemNum; i++) {
          var regName = regData.data[i]["시도"];

          var regSuplyLevel = regData.data[i]["공급수준"];
          var regPopChange = regData.data[i]["인구증감"];
          var regPop = regData.data[i]["인구수"];
          var regIncome = regData.data[i]["소득수준"];
          var regValue = Math.round(regData.data[i]["가치 총점"] * 100) / 100;
          var regRank = regData.data[i]["rank"];
          var regJob = regData.data[i]["일자리"];

          regValueSum += regData.data[i]["가치 총점"];
          regSupplySum += regData.data[i]["지역구공급총점"];
          regPopSum += regData.data[i]["인구총점"];
          regJobSum += regData.data[i]["일자리총점"];

          var addon_html = "<div class='listBox' data-bs-toggle='modal' data-bs-target='#baseModal' id='myModal' onClick='showRegionDetail(" + i + ")'>";

          region_grade = ""

          if(regValue >= 60){
            region_grade = "S"
          }
          else if(regValue >= 40 && regValue < 60){
            region_grade = "A"
          }
          else if(regValue >= 15 && regValue < 40){
            region_grade = "B"
          }
          else{
            region_grade = "C"
          }

          addon_html += "<div class='rank_content'>"
            addon_html += "<div class='ranksame'>INVEST</div>"
            addon_html += "<div class='rank'>" + region_grade + "</div>";
          addon_html += "</div>"

          addon_html += "<div class='content'>";
          addon_html += "<div class='apt_name'>" + regName + "</div>";
          addon_html += "<div class='reg_subTable'>";

          addon_html +=
            "<div class='apt_address'>아파트 공급량 <span style='font-weight:900; color:#0f0f0f'>" +
            regSuplyLevel +
            "</span></div>";

          var upDown = "";
          var popChange = "";
          if (regPopChange < 0) {
            upDown = "감소";
            popChange = "▼" + Math.abs(regPopChange).toLocaleString();
          } else {
            upDown = "증가";
            popChange = "▲" + Math.abs(regPopChange).toLocaleString();
          }
          addon_html += "<div class='apt_address'><span class='regionPop'>인구 " + Math.abs(regPop).toLocaleString() + "명</span>";
          if (regPopChange >= 0) {
            addon_html += "<span class='regionPopUp'> (" + popChange + ")</span></div>";
          } else {
            addon_html += "<span class='regionPopDown'> (" + popChange + ")</span></div>";
          }
          addon_html += "<div class='apt_address'><span class='regionJob'>일자리 " + Number(Number(regJob).toFixed(0)).toLocaleString() + "개</span></div>";
          addon_html += "<div class='apt_address'>소득 " + regIncome.toLocaleString() + "원</div>";
          addon_html += "</div></div>";
          //addon_html += "<div class='value_score'>" + (Math.round(regValue * 100) / 100).toFixed(2) + "점</div>";
          addon_html += "<div class='value_score'></div>";
          addon_html += "</div>";

          $("#dataList").append(addon_html);
        }
        $("#dataList").append( "<div style='height: " + blank_height + "'></div>");

        if(!isMobile){
          region_center = new naver.maps.LatLng(regData.data[0]["y"], regData.data[0]["x"])

          if(!defaultMap){
            setTimeout(function(){
              if(defaultMap){        
                defaultMap.setCenter(region_center)
                defaultMap.setZoom(13)              
                $("#pageLoadingBack").remove()
              }
            }, 1000)    
          }
          else{    
            defaultMap.setCenter(region_center)
            defaultMap.setZoom(13)
            $("#pageLoadingBack").remove()
          }
        }
        else{
          defaultMap.setCenter({'lat':36.6778, 'lng':127.9564})
          defaultMap.setZoom(8)
          showHideMarker(8)          
          $("#pageLoadingBack").remove()
        }
      });

      saveLocalStorage();      
      $("#pageLoadingBack").remove()
    }

    function showRegionDetail(index) {
      if(isMobile){
        $(".modal-backdrop").css({"width":"100%"})
        $("#baseModal").css({"width":"100%"})
      }
      else{
        $(".modal-backdrop").css({"width":"600px"})
        $("#baseModal").css({"width":"600px"})
      }

      titleHtml = "";
      detailHtml = "";
      footerHtml = "";
      var regRank = regData.data[index]["rank"] + "/" + regData.data[itemNum - 1]["rank"] + "위";
      var regName = regData.data[index]["시도"];
      var regValue = ( Math.round(regData.data[index]["가치 총점"] * 100) / 100 ).toFixed(2);

      var regSupplyAll = regData.data[index]["총물량"];
      var regSupplyProper = regData.data[index]["적정입주물량"];
      var regSupplyUpDown = Math.abs(regData.data[index]["과부족수"]);

      if (Number(selectedMonth) > 202208) {
        var regSupplyAll_nearby = regData.data[index]["인근총합공급량"];
        var regSupplyProper_nearby = regData.data[index]["총합적정공급량"];
        var regSupplyUpDown_nearby = Math.abs( regData.data[index]["총합과부족수"] );
        var nearby_info = regData.data[index]["인근지역정보"];
      }

      var regSupplyLevel = regData.data[index]["공급수준"];
      var regSupplyScore = ( Math.round(regData.data[index]["지역구공급총점"] * 100) / 100 ).toFixed(2);

      var regPop = regData.data[index]["인구수"];
      var regPopUpDown = regData.data[index]["인구증감"];
      var regPopScore = ( Math.round(regData.data[index]["인구총점"] * 100) / 100 ).toFixed(2);

      var regJob = regData.data[index]["일자리"];
      var regIncome = regData.data[index]["소득수준"];
      var regJobScore = ( Math.round(regData.data[index]["일자리총점"] * 100) / 100 ).toFixed(2);
      linked = regData.data[index]["연결명"];

      //지도 표시 추가
      var lat = regData.data[index]["y"];
      var lng = regData.data[index]["x"];

      region_center = new naver.maps.LatLng(lat, lng)
      defaultMap.setCenter(region_center);
      defaultMap.setZoom(13);

      //Title
      //titleHtml += "<div class='popupTitle'>" + aptName + " " + apt_p + "(" + apt_m + ")</div>";
      titleHtml += "<div class='popupTitle'>" + regName + "</div>";

      //총점,순위
      detailHtml += "<div class='card'>";
      detailHtml += "<div class='card-header'>";

      region_grade = ""
      if(regValue >= 60){
        region_grade = "S"
      }
      else if(regValue >= 40 && regValue < 60){
        region_grade = "A"
      }
      else if(regValue >= 15 && regValue < 40){
        region_grade = "B"
      }
      else{
        region_grade = "C"
      }

      /*
      if (selectedMonth == "202201") {
        detailHtml +=
          "<div class='popRank'><i class='fas fa-trophy'></i> " +
          regRank +
          "</div></div>";
      } else {
        detailHtml +=
          "<div class='popRank'><i class='fas fa-trophy'></i> " + regRank;
        if (regData.data[index]["rank_gap"] == 0) {
          detailHtml += "<span class='ranksame'> (--) </span>";
        } else if (regData.data[index]["rank_gap"] == 9999) {
          detailHtml += "<span class='ranksame'> (NEW!) </span>";
        } else if (regData.data[index]["rank_gap"] > 0) {
          detailHtml +=
            "<span class='rankup'> (▲" +
            Math.abs(regData.data[index]["rank_gap"]) +
            ")</span>";
        } else if (regData.data[index]["rank_gap"] < 0) {
          detailHtml +=
            "<span class='rankdown'>(▼" +
            Math.abs(regData.data[index]["rank_gap"]) +
            ")</span>";
        }
        detailHtml += "</div></div>";
      }
      */

      detailHtml += "<div class='popRank'>Invest '" + region_grade + "'</div></div>";

      detailHtml += "<div class='card-body'>";
      detailHtml +=
        "<div class='graph' style='height: 200px'> <canvas id='valueChart'></canvas></div>";
      detailHtml +=
        "<div class='comment'>(전국 모든 시군구에 대해 100점으로 환산한 상대 점수 입니다.)</div>";

      /*
      if (Number(selectedMonth) > 202203) {
        detailHtml +=
          "<hr><div class='graph' style='height: 120px;'> <canvas id='rankChart'></canvas></div>";
      }
      */

      detailHtml += "</div></div>";

      //물량
      detailHtml += "<div class='card'>";
      detailHtml += "<div class='card-header'>";
      var start_y = selectedMonth.substr(0, 4);
      var end_y = (Number(start_y) + 1).toString();
      var start_m = selectedMonth.substr(4, 2);
      var duration =
        "<span style='font-size:0.8em'> (" + start_y + "-" + start_m + " ~ " + end_y + "-" + start_m + ") </span>";
      if (Number(selectedMonth) > 202208) {
        detailHtml += "<div class='popTitle'><i class='fas fa-building'></i>&nbsp&nbsp공급량" + duration + "</div>";
        detailHtml += "<div class='comment2'>2022년 9월 부터 인근 지역의 공급량 총합으로 과부족을 표시합니다.</div>";
        detailHtml += "<div class='comment2'>적정 공급량은 \"인구 X 0.5%\"로 계산됩니다.</div>";
      } else {
        detailHtml += "<div class='popTitle'><i class='fas fa-building'></i>&nbsp&nbsp공급량</div>";
      }
      detailHtml += "</div>";
      detailHtml += "<div class='card-body'>";
      detailHtml += "<div id='popLiving'>";
      detailHtml += "<div class='popTable'>";
      //detailHtml += "<div class='graph' style='height: 120px'> <canvas id='supplyChart'></canvas></div>"
      if (Number(selectedMonth) < 202209) {
        detailHtml += "<div class='popSubTable'><div class='popContent'>" + "총 공급량" + "</div>" + "<div class='popResult'>" + Math.round(regSupplyAll).toLocaleString() + "세대</div></div>";
        detailHtml += "<div class='popSubTable'><div class='popContent'>" + "적정 공급량" + "</div>" + "<div class='popResult'>" + Math.round(regSupplyProper).toLocaleString() + "세대</div></div>";
        detailHtml += "<div class='popSubTable'><div class='popContent'>" + "과부족" + "</div>" + "<div class='popResult'>" + Math.round(regSupplyUpDown).toLocaleString() + "세대 " + regSupplyLevel + "</div></div>";
        detailHtml += "</div></div></div></div>";
      } else {
        detailHtml += "<div class='popSubTable'><div class='popContent'>" + "총 공급량" + "</div>" +
          "<div class='popResult'>" + Math.round(regSupplyProper_nearby).toLocaleString() + "세대</div></div>";
        detailHtml += "<div class='popSubTable'><div class='popContent'>" + "적정 공급량" + "</div>" +
          "<div class='popResult'>" + Math.round(regSupplyAll_nearby).toLocaleString() + "세대</div></div>";
        detailHtml += "<div class='popSubTable'><div class='popContent'>" + "과부족" + "</div>" +
          "<div class='popResult'>" + Math.round(regSupplyUpDown_nearby).toLocaleString() + "세대 " + regSupplyLevel + "</div></div>";

        detailHtml += "<div class='column2'>";
        detailHtml += "<div class='column_table'>";
        detailHtml += "<div class='column_table_title'>" + regName + "</div>";
        detailHtml += "<div class='column_table_content'>";
        if (regData.data[index]["과부족수"] > 0) {
          vol_info = "부족";
        } else if (regData.data[index]["과부족수"] < 0) {
          vol_info = "과다";
        } else if (regData.data[index]["과부족수"] == 0) {
          vol_info = "적정";
        }
        detailHtml += "<div class='supplySubTable'><div class='supplyResult'>" + regSupplyUpDown.toFixed() + "세대 공급 " + vol_info + "</div></div>";
        detailHtml += "</div>";
        detailHtml += "</div>";

        for (var i = 0; i < nearby_info.length; i++) {
          detailHtml += "<div class='column_table'>";
          region_name_array = nearby_info[i][0].split(" ");
          short_region_name = "";
          for (var k = 1; k < region_name_array.length; k++) {
            short_region_name += region_name_array[k];
            short_region_name += " ";
          }

          detailHtml += "<div class='column_table_title'>" + short_region_name + "<span style='font-size:0.9em'>(" + nearby_info[i][5].toFixed(1) + " km)</span>";
          detailHtml += "</div>";
          detailHtml += "<div class='column_table_content'>";
          if (nearby_info[i][2] - nearby_info[i][3] > 0) {
            vol_info = "과다";
          } else if (nearby_info[i][2] - nearby_info[i][3] < 0) {
            vol_info = "부족";
          } else if (nearby_info[i][2] - nearby_info[i][3] == 0) {
            vol_info = "적정";
          }
          //detailHtml += "<div class='supplySubTable'><div class='supplyContent'>" + "" + "</div>" + "<div class='supplyResult'>" + (nearby_info[i][3].toFixed()).toLocaleString() + "세대 적정 공급</div></div>";
          detailHtml +=
            "<div class='supplySubTable'><div class='supplyResult'>" +
            Math.abs(nearby_info[i][2] - nearby_info[i][3]).toFixed().toLocaleString() + "세대 공급 " + vol_info +
            "</div></div>";
          detailHtml += "</div>";
          detailHtml += "</div>";
        }
        detailHtml += "</div></div></div></div></div>";
      }
      avgSupplyScore = (Math.round((regSupplySum / itemNum) * 100) / 100).toFixed(2);

      //인구
      detailHtml += "<div class='card'>";
      detailHtml += "<div class='card-header'>";
      detailHtml += "<div class='popTitle'><i class='fas fa-user-friends'></i>&nbsp&nbsp인구</div>";
      detailHtml += "</div>";
      detailHtml += "<div class='card-body'>";
      detailHtml += "<div id='popInfra'>";
      detailHtml += "<div class='graph' style='height: 120px'> <canvas id='popChart'></canvas></div>";
      detailHtml += "<div class='popTable'>";
      detailHtml += "<div class='popSubTable'><div class='popContent'>" + "인구수" + "</div>" + "<div class='popResult'>" + regPop.toLocaleString() + "명 </div></div>";
      detailHtml += "<div class='popSubTable'><div class='popContent'>" + "인구증가" + "</div>" + "<div class='popResult'>" + Math.round(regPopUpDown).toLocaleString() + "명</div></div>";
      detailHtml += "</div></div></div></div>";
      avgPopScore = (Math.round((regPopSum / itemNum) * 100) / 100).toFixed(2);

      //일자리
      detailHtml += "<div class='card'>";
      detailHtml += "<div class='card-header'>";
      detailHtml += "<div class='popTitle'><i class='fas fa-user-md'></i></i>&nbsp&nbsp일자리</div>";
      detailHtml += "</div>";
      detailHtml += "<div class='card-body'>";
      detailHtml += "<div id='popEducation'>";
      detailHtml += "<div class='graph' style='height: 120px'> <canvas id='jobChart'></canvas></div>";
      detailHtml += "<div class='popTable'>";
      detailHtml += "<div class='popSubTable'><div class='popContent'>" + "일자리수" + "</div>" + "<div class='popResult'>" + regJob.toLocaleString() + "개</div></div>";
      detailHtml += "<div class='popSubTable'><div class='popContent'>" + "평균소득" + "</div>" + "<div class='popResult'>" + regIncome.toLocaleString() + "원</div></div>";
      detailHtml += "</div></div></div></div>";
      avgJobScore = (Math.round((regJobSum / itemNum) * 100) / 100).toFixed(2);

      //매매, 전세가격지수
      if (rateExist.includes(regName) && Number(selectedMonth) > 202203) {
        url = "https://www.realrankus.com/" + selectedMonth + "/Price_Rate/" + regName + ".json" + update_ver;

        detailHtml += "<div class='card'>";
        detailHtml += "<div class='card-header'>";
        detailHtml += "<div class='popTitle'><i class='fa-solid fa-chart-line'></i>&nbsp&nbsp매매/전세 가격 지수</div>";
        detailHtml += "</div>";
        detailHtml += "<div class='card-body'>";
        detailHtml += "<div id='popEducation'>";
        detailHtml += "<div class='graph' style='height: 200px;'> <canvas id='priceRateChart'></canvas></div>";
        detailHtml += "<hr><div class='comment2'>매매/전세 가격 지수는 KB부동산 정보를 참조하며, 2022년 1월의 가격을 100.0으로 설정한 기준으로 산정됩니다. 100초과는 매수우위, 100미만은 매도우위를 의미합니다.</div>";
        detailHtml += "</div></div></div>";
      }

      //Footer에 아파트보기 버튼
      var shortName = regName.substring(regName.search(" "), regName.length);
      var rName = regName.substring(0, regName.search(" "));
      for (var i = 0; i < regions.length; i++) {
        if (regions[i][0] == rName) {
          regionValue = regions[i][1];
        } else {
        }
      }

      shareTitle = "[리얼랭커스 ";
      shareTitle += selectedMonth.substr(2, 2) + "년 " + Number(selectedMonth.substr(4, 2)).toString() + "월]\n\n";
      shareText = "『" + regName + "』";
      //shareText += "\nㆍ순위 : " + regRank + " (" + regValue + "점)";
      shareText += "\nㆍ투자등급 : Rank " + region_grade
      shareText += "\nㆍ인구수 : " + regPop.toLocaleString() + "명";
      shareText += "\nㆍ공급량 : " + Math.round(regSupplyUpDown).toLocaleString() + "세대 " + regSupplyLevel;
      shareText += "\nㆍ일자리 : " + regJob.toLocaleString() + "개";
      shareText += "\n\n";
      shareURL = "https://www.realrankus.com" + "?reg=" + selectedRegion + "&sub=" + selectedSubRegion + "&mon=" + selectedMonth;

      footerHtml += "<div class='modal-footer'>";
      //footerHtml += "<div></div>"

      if (UserAgent.indexOf("inApp") > -1) {
        footerHtml += "<div><button type='button' class='goApt' data-dismiss='modal' onClick='show_apt(selectedMonth, linked, regionValue)'>" + shortName + " 아파트 보기</button></div>";
        if (checkMobile() == "ios") {
          footerHtml += "<div class='tShare' onClick='share(shareTitle, shareText, shareURL)'><i class='fa-solid fa-arrow-up-right-from-square'></i></div>";
        } else {
          footerHtml += "<div class='kakaoShare' onClick='kakaoShare(shareTitle, shareText, shareURL)'><img src = './kakao_icon.png' height='32px'></div>";
        }
        footerHtml += "<div class='tShare' onClick='CopyToClipboard(shareText, popMsg)'><i class='fa-regular fa-copy'></i></div>";
      } 
      else {
        footerHtml += "<div><button type='button' class='goApt' data-dismiss='modal' onClick='show_apt(selectedMonth, linked, regionValue)'>" + shortName + " 아파트 보기</button></div>";
        if (checkMobile() == "ios") {
          footerHtml += "<div class='tShare' onClick='CopyToClipboard(shareText, popMsg)'><i class='fa-regular fa-copy'></i></div>";
        } else {
          footerHtml += "<div class='kakaoShare' onClick='kakaoShare(shareTitle, shareText, shareURL)'><img src = './kakao_icon.png' height='32px'></div>";
        }
        footerHtml += "<div class='tShare' onClick='share(shareTitle, shareText, shareURL)'><i class='fa-solid fa-arrow-up-right-from-square'></i></div>";
      }
      footerHtml += "</div>";

      $("#baseModalLabel").html(titleHtml);
      $("#aptDetail").html(detailHtml);
      $("#footer").html(footerHtml);

      //if(UserAgent.indexOf("inApp")>-1){
      //  $('.modal-footer').css({"grid-template-columns" : "0.2fr 1fr 0.2fr", "text-align":"center"})
      //}
      //else{
      $(".modal-footer").css({
        "grid-template-columns": "1fr 0.15fr 0.15fr",
        "text-align": "center",
      });
      //}

      /*
      if (Number(selectedMonth) > 202203) {
        rank_history = regData.data[index]["rank_history"];
        rankMonth = [""];
        rankData = [null];
        for (var j = 0; j < rank_history.length; j++) {
          if (rank_history[j][1] == 9999) {
          } else if (rank_history[j][1] == 0) {
            rankMonth.push(rank_history[j][0]);
            rankData.push(regData.data[index]["rank"]);
          } else {
            rankMonth.push(rank_history[j][0]);
            rankData.push(rank_history[j][1]);
          }
        }
        rankMonth.push("");
        rankData.push(null);

        rankMonth.reverse();
        rankData.reverse();

        drawRankChart(rankMonth, rankData, regData.data[itemNum - 1]["rank"]);
      }
      */

      drawChart(regValue, regSupplyScore, regPopScore, regJobScore, "region");
      //drawSubChart(regSupplyScore, avgSupplyScore, "공급량총점", "전국평균", "#fe4040", "#9f9f9f", "supplyChart")
      drawSubChart(regPopScore, avgPopScore, "인구총점", "전국평균", "#fe4040", "#9f9f9f", "popChart");
      drawSubChart(regJobScore, avgJobScore, "일자리총점", "전국평균", "#fe4040", "#9f9f9f", "jobChart");
      //drawPriceRateChart(dateArray, salesArray, rentArray)

      if (Number(selectedMonth) > 202203) {
        var dateArray = ["", ""];
        var salesArray = [null, null];
        var rentArray = [null, null];

        $.getJSON(url, function (json) {
          rateData = json;
          for ( var i = rateData.data.length - 36; i < rateData.data.length; i++) {
            pushed_date = "'" + rateData.data[i]["Date"].toString().substr(2, 2) + "." + rateData.data[i]["Date"].toString().substr(4, 2);
            dateArray.push(pushed_date);
            salesArray.push(rateData.data[i]["Sales"]);
            rentArray.push(rateData.data[i]["Rent"]);
          }

          dateArray.push("");
          dateArray.push("");
          salesArray.push(null);
          salesArray.push(null);
          rentArray.push(null);
          rentArray.push(null);

          drawPriceRateChart(dateArray, salesArray, rentArray);
        });
      }
      
      setTimeout(function(){
        closeUnifiedSearch()
        $('#baseModal').modal("show")            
      }, 150)
    }

    function show_apt(month, filename, sido) {
      $("#sido").val(sido).prop("selected", true);
      selectedMonth = month;
      selectedSubRegion = filename;
      selectedRegion = $("#sido option:selected").val();

      $("#regionSearchCard").animate(
        {
          opacity: 0.0,
          top: "-150px",
        },
        400,
        "easeInQuad"
      );
      $("#closeRegionSearch_floating").animate(
        {
          opacity: 0.0,
          right: "-200px",
        },
        400,
        "easeInQuad"
      );
      $("#regionInputSearch").val("");

      $("#rearrangeRegionCard").animate(
        {
          opacity: 0.0,
          top: "-150px",
        },
        400,
        "easeInQuad"
      );
      $("#closeRegionRearrange_floating").animate(
        {
          opacity: 0.0,
          right: "-200px",
        },
        400,
        "easeInQuad"
      );
      rearrangeSelection = "rearrangeRegionScore";

      $("#baseModal").modal("hide");
      $("#toggleModal1").modal("hide");
      $("#toggleModal2").modal("hide");

      optionChange(filename, "");
      updateRegion();
    }

    var pcDevice = "win16|win32|win64|mac|macintel";

    function openNaver(code) {
      //nURL = "https://new.land.naver.com/complexes/" + code;

      if(isMobile){        
        nURL = "https://m.land.naver.com/complex/info/" + code;
      }
      else{        
        nURL = "https://new.land.naver.com/complexes/" + code;
      }
      //window.open(nURL)
      if (checkMobile() == "ios") {
        window.location.href = nURL;
      } else {
        window.open(nURL)       
      }
    }

    function openHGNN(code) {
      hURL = "https://hogangnono.com/apt/" + code;
      //window.open(hURL)
      if (checkMobile() == "ios") {
        window.location.href = hURL;
      } else {
        window.open(hURL);
      }
    }

    function showBlogGuide() {
      $(".offcanvas").offcanvas("hide") //offcanvas
      
      noticePop = true;
      var titleHtml = "<div class='popupTitle'> 리얼포스팅은요... </div>";
      var footerHtml = "";
      var detailHtml = "";
      detailHtml += "<ul>"
      detailHtml += "<li><div class='realPosting'>리얼랭커스의 리얼포스팅 등록은 무료이며, <a href='https://open.kakao.com/me/realrankus' target='_blank'>카카오톡 오픈채팅</a>을 통해 신청 가능합니다.</div>";
      detailHtml += "<li><div class='realPosting'>오픈채팅으로 <span class='blogFocus'>\"리얼포스팅 등록 신청 합니다\'</span> 말씀하시고,포스팅 링크를 보내시면 됩니다.</div>";
      detailHtml += "<li><div class='realPosting'>리얼랭커스에 등록 가능한 포스팅은 <span class='blogFocus'>반드시 리얼랭커스를 통한 단지의 총평 또는 분석 결과가 스크린샷 이미지와 함께 포함</span>되어야 합니다.</div>";
      detailHtml += "<li><div class='realPosting'>리얼포스팅 등록을 신청하시면 검토 후, 해당하는 단지 팝업에 표시됩니다.</div>";
      detailHtml += "<li><div class='realPosting'>리얼포스팅은 각 단지별 최대 3개로 노출되며, 그 이상 되는 경우 무작위로 노출됩니다.</div>";
      detailHtml += "</ul>"

      $("#noticeModalLabel").html(titleHtml);
      $("#noticeDetail").html(detailHtml);
      $("#noticeFooter").html(footerHtml);

      $("#noticeModal").modal("show"); //offcanvas
      $("#baseModal").css({"z-index":"1030"})
      $(".modal-backdrop").css({"width":"100%"})
    }

    function showNotice() {      
      $(".offcanvas").offcanvas("hide") //offcanvas
      
      noticePop = true;
      var titleHtml =
        "<div class='popupTitle'> 리얼랭커스에서 알려드립니다 </div>";
      var footerHtml = "";
      var detailHtml = "";
      /*
      if (selectedMonth == "202203") {
        detailHtml += notice_202203;
      }
      if (selectedMonth == "202204") {
        detailHtml += notice_202204;
      }
      if (selectedMonth == "202205") {
        detailHtml += notice_202205;
      }
      if (selectedMonth == "202206") {
        detailHtml += notice_202206;
      }
      if (selectedMonth == "202207") {
        detailHtml += notice_202207;
      }
      if (selectedMonth == "202208") {
        detailHtml += notice_202208;
      }
      if (selectedMonth == "202209") {
        detailHtml += notice_202209;
      }
      if (selectedMonth == "202210") {
        detailHtml += notice_202210;
      }
      if (selectedMonth == "202211") {
        detailHtml += notice_202211;
      }
      if (selectedMonth == "202212") {
        detailHtml += notice_202212;
      }
      if (selectedMonth == "202301") {
        detailHtml += notice_202301;
      }
      if (selectedMonth == "202302") {
        detailHtml += notice_202302;
      }
      if (selectedMonth == "202303") {
        detailHtml += notice_202303;
      }
      if (selectedMonth == "202304") {
        detailHtml += notice_202304;
      }
      if (selectedMonth == "202305") {
        detailHtml += notice_202305;
      }
      if (selectedMonth == "202306") {
        detailHtml += notice_202306;
      }
      if (selectedMonth == "202307") {
        detailHtml += notice_202307;
      }
      if (selectedMonth == "202308") {
        detailHtml += notice_202308;
      }
      if (selectedMonth == "202309") {
        detailHtml += notice_202309;
      }
      if (selectedMonth == "202310") {
        detailHtml += notice_202310;
      }
      if (selectedMonth == "202311") {
        detailHtml += notice_202311;
      }
      if (selectedMonth == "202312") {
        detailHtml += notice_202312;
      }
      if (selectedMonth == "202401") {
        detailHtml += notice_202401;
      }
      if (selectedMonth == "202402") {
        detailHtml += notice_202402;
      }
      if (selectedMonth == "202403") {
        detailHtml += notice_202403;
      }
      if (selectedMonth == "202404") {
        detailHtml += notice_202404;
      }
      */
      if (selectedMonth == "202405") {
        detailHtml += notice_202405;
      }
      if (selectedMonth == "202406") {
        detailHtml += notice_202406;
      }
      if (selectedMonth == "202407") {
        detailHtml += notice_202407;
      }
      if (selectedMonth == "202408") {
        detailHtml += notice_202408;
      }
      if (selectedMonth == "202409") {
        detailHtml += notice_202409;
      }
      if (selectedMonth == "202410") {
        detailHtml += notice_202410;
      }              

      detailHtml += "<div class='popupTitle' style='text-align: center; padding-bottom: 1em'>리얼랭커스란?</div>";
      detailHtml += "<div class='notice'>리얼랭커스는 '주거', '인프라', '교통', '교육환경'을 AI로 분석하여 점수로 계산하여 입지 정보를 제공하는 서비스 입니다.</div>";
      detailHtml += "<div class='notice'>리얼랭커스의 점수는 '가격' 및 '지형고도'를 제외하고 산정되며, 그 결과는 생각하시는 순위와 크게 다를 수 있습니다.</div>";
      detailHtml += "<div class='notice'><strong> 리얼랭커스의 점수는 투자지표가 아님을 말씀드리며, 투자 판단에 대한 모든 책임은 투자자 본인에게 있습니다.</strong></div>";
      detailHtml += "<div class='notice'>업데이트 알림은 <a href='http://pf.kakao.com/_vESNb' target='_blank'>카카오톡 채널</a>을 통해 전달됩니다.</div>";
      detailHtml += "<hr>";
      detailHtml += "<ul>";
      detailHtml += "<li><div class='notice'>아파트 랭크의 점수는 투자지표가 아님을 말씀드립니다. 투자 판단에 대한 모든 책임은 투자자 본인에게 있습니다.</div></li>";
      detailHtml += "<li><div class='notice'>모든 점수는 환경 요소를 분석한 AI가 선정하며, 일체의 임의적 조작을 가하지 않습니다.</div></li>";
      detailHtml += "<li><div class='notice'>점수는 해당 지역구의 상대 점수이며, 다른 지역구의 동일 점수와 같은 가치를 나타내지 않습니다.</div></li>";
      detailHtml += "<li><div class='notice'>단지의 정보는 네이버 부동산 정보를 참조합니다.</div></li>";
      detailHtml += "<li><div class='notice'>80세대 이하의 단지는 통계에서 제외됩니다. (2022년 3월 이전은 100세대 이하 제외)</div></li>";
      detailHtml += "<li><div class='notice'>재건축 단지의 경우, 용적률과 건폐율로 주거 점수를 산정합니다.</div></li>";
      detailHtml += "<li><div class='notice'>수도권 교통 정보는 지하철역 위치 정보를 기반으로 산정됩니다.</div></li>";
      detailHtml += "<li><div class='notice'>인프라 정보는 각 백화점/마트 홈페이지, 은행연합회, 자원순환정보시스템, 공공데이터 포탈의 정보를 기반으로 산정됩니다.</div></li>";
      detailHtml += "<li><div class='notice'>교육 정보는 교육통계서비스 정보를 기반으로 산정됩니다.</div></li>";
      detailHtml += "<li><div class='notice'>지역구 정보는 공공데이터포탈 정보를 기반으로 산정됩니다.</div></li>";
      detailHtml += "<li><div class='notice'>모든 정보는 월 1회 업데이트 예정이며, 각 기반 정보의 업데이트 시점에 따라 변동 가능성이 있습니다.</div></li>";
      detailHtml += "<li><div class='notice'>문의사항, 오류수정, 개선제안은 이메일 또는 카카오톡을 통해 문의해 주세요.</div></li>";
      detailHtml += "<li><div class='notice'>" + connectionOS + " " + connectionWebApp +"으로 접속되었습니다.</div></li>";
      detailHtml += "</ul>";

      footerHtml += "<div class='modal-footer'>";
      footerHtml +=
        " <div id='footerCheck'><input class='form-check-input' type='checkbox' value='' id='flexCheckDefault'><label class='form-check-label' for='flexCheckDefault'><span class='notice'>일주일 동안 보지 않기</span></label></div>";
      if (checkMobile() == "ios") {
        footerHtml += " <div id='footerBtn1'><button type='button' class='goApt' style='font-size: 0.85em' onClick='openOuterLink(\"https://apps.apple.com/kr/app/id6448044104\")'>iOS 앱 설치</button></div>";
      } else {
        footerHtml += " <div id='footerBtn1'><button type='button' class='goApt' style='font-size: 0.85em' onClick='openOuterLink(\"https://play.google.com/store/apps/details?id=com.aptrank.app\")'>Android 앱 설치</button></div>";
        //footerHtml += " <div><a href='https://open.kakao.com/o/sPYY0LZd' target='_blank'><button type='button' class='gokakao'>카카오톡 문의하기</button></a></div>"
        footerHtml += " <div id='footerBtn1'><button type='button' class='goApt' style='font-size: 0.85em' onClick='openOuterLink(\"https://apps.apple.com/kr/app/id6448044104\")'>iOS 앱 설치</button></div>";
      }
      footerHtml += " <div id='footerBtn3'><button type='button' class='gokakao' style='font-size: 0.85em' onClick='openOuterLink(\"https://pf.kakao.com/_vESNb\")'>카카오톡 채널</button></div>";
      footerHtml += " <div id='footerBtn3'><button type='button' class='gokakao' style='font-size: 0.85em' onClick='openOuterLink(\"https://pf.kakao.com/_vESNb/chat\")'>카카오톡 1:1 문의</button></div>";
      footerHtml += "</div>";

      $("#noticeModalLabel").html(titleHtml);
      $("#noticeDetail").html(detailHtml);
      $("#noticeFooter").html(footerHtml);

      $("#footerCheck").css({ "grid-column": "span 2", height: "2em" });
      if (checkMobile() == "ios") {
        $("#footerBtn1").css({ "grid-column": "span 2" });
      } else {
        $("#footerBtn1").css({ "grid-column": "1fr 1fr" });
      }
      $(".modal-footer").css({ "padding-top": "3px" });

      if ($.cookie("popCookie") != "202410") {
        $("#flexCheckDefault").prop("checked", false);
      } else {
        $("#flexCheckDefault").prop("checked", true);
      }

      $("#flexCheckDefault").change(function () {
        if ($(this).is(":checked")) {
          $.cookie("popCookie", "202410", { expires: 7, path: "/" });
          console.log($.cookie("popCookie"));
        } else {
          $.removeCookie("popCookie", null, { path: "/" });
        }
      });      
      $("#noticeModal").modal("show"); //offcanvas
      $(".modal-backdrop").css({"width":"100%"})
    }
    function dong_filter(selection){      
      $("#blank_list").html("")
      $("#blank_list").css({'height' : '3em'})
      selected_class = "." + selection.id
      if(selection.id == "dong_0"){
        $(".listBox2").hide()
        $(".listBox2").fadeIn(950, 'easeOutQuart')
      }
      else if(selection.id == "dong_1"){
        $(".listBox2").hide()
        $(".liked").fadeIn(950, 'easeOutQuart')        
        if($(".liked").length === 0){
          $("#blank_list").html("<br>좋아요 단지가 없어요<br><br>가장 먼저 마음에 드는 단지에<br><span style='color:#e31939'>\"<i class='fa-regular fa-thumbs-up'></i> 좋아요\"</span> 를 해 주시는건 어떨까요?")
          $("#blank_list").css({'height' : '10em'})
        }
        else{
          $("#blank_list").html("")
          $("#blank_list").css({'height' : '3em'})
        }
      }
      else{
        $(".listBox2").hide()
        $(selected_class).fadeIn(950, 'easeOutQuart')
      }
      $('html').scrollTop(0)
    }
  </script>
</html>
