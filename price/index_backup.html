<!DOCTYPE html>
<html lang="ko">
<head>
  <!-- Google Tag Manager -->
  <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
  new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
  j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
  'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
  })(window,document,'script','dataLayer','GTM-KNL2VQN');</script>
  <!-- End Google Tag Manager -->

<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-TEV7JMPP7S"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-TEV7JMPP7S');

  if ('serviceWorker' in navigator) {
  navigator.serviceWorker.register('serviceWorker.js')
    .then((reg) => {
    });
  }
  </script>

  <title>리얼랭커스Price</title>
  <meta property="og:type" content="website">
  <meta property="og:title" content="리얼랭커스Price">
  <meta property="og:description" content="보기 편한 아파트 실거래가">
  <meta property="og:image" content="https://www.realrankus.com/price/thumbnail_price.png">
  <meta property="og:url" content="https://www.realrankus.com/price/">

  <meta name="twitter:card" content="summary">
  <meta name="twitter:url" content="https://www.realrankus.com/price/">
  <meta name="twitter:title" content="리얼랭커스">
  <meta name="twitter:description" content="보기 편한 아파트 실거래가">

  <meta name="keyword" content="부동산, 실거래가, 아파트, 입지, 순위, 아파트입지, 우리동네, 호가, 대장아파트, 최고가, 신고가, 호재, AI, 등수">
  <meta name="description" content="보기 편한 아파트 실거래가">
  <meta name="author" content="리얼랭커스">
  <meta name="robots" content="index,follow">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, minimal-ui, viewport-fit=cover">
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
  <meta charset="utf-8">

  <!-- 주소창 등의 웹 브라우저 UI를 표시하지 않기 -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <!-- 상태 바의 스타일을 지정 -->
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <meta name="theme-color" content="#fff">
  <!-- 홈 화면에서 표시되는 앱 이름을 지정 -->
  <meta name="apple-mobile-web-app-title" content="리얼랭커스Price">
  <!-- 홈 화면에서 표시되는 앱 아이콘을 지정 -->
  <link rel="apple-touch-icon" href="https://www.realrankus.com/price/apt-rank-price-152x152.png">
  <!-- 웹 앱 매니페스트를 읽어 들이기 -->
  <link rel="manifest" href="manifest_price.json">  

  <link rel="canonical" href="https://www.realrankus.com/price/">
  <link href="https://fonts.googleapis.com/css?family=Roboto:100,300,400,500,700,900" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/@mdi/font@6.x/css/materialdesignicons.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" integrity="sha512-9usAa10IRO0HhonpyAIVpjrylPvoDwiPUiKdWk5t3PyolY1cOd4DSE0Ga+ri4AuTroPR5aQvXU9xC6qOPnzFeg==" crossorigin="anonymous" referrerpolicy="no-referrer" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
  <link rel="shortcut icon" href="https://www.realrankus.com/price/apt-rank-price.png"/>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href='https://cdnjs.cloudflare.com/ajax/libs/spoqa-han-sans/3.2.1/css/SpoqaHanSansNeo.min.css' rel='stylesheet' type='text/css'>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@100;200;300;400;500;600;700;800;900&display=swap" rel="stylesheet">  

  <script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
  <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js" integrity="sha256-VazP97ZCwtekAsvgPBSUwPFKdrwD3unUfSGVYrahUqU=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/0.5.0-beta4/html2canvas.min.js"  crossorigin="anonymous"></script>
  <script src="https://developers.kakao.com/sdk/js/kakao.js"></script>
  <script type="text/javascript" src="https://openapi.map.naver.com/openapi/v3/maps.js?ncpClientId=uod39kursd"></script>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.css" rel="stylesheet">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js"></script>
  
  <script src="../js/menu_select_box_price.js" type="text/javascript"></script>
  <script src="../js/draw_chart_price.js" type="text/javascript"></script>
  <script src="../js/sort.js" type="text/javascript"></script>
  <script src="../js/search.js" type="text/javascript"></script>
  <script src="../js/unfied_search.js" type="text/javascript"></script>
  <script src="../js/rearrange.js" type="text/javascript"></script>
  <script src="../js/share.js" type="text/javascript"></script>
  <script src="../js/weight_cal.js" type="text/javascript"></script>
  <script src="../js/weight_array.js" type="text/javascript"></script>
  <script src="../js/simulation.js" type="text/javascript"></script>
  <script src="../js/top300.js" type="text/javascript"></script>
  <script src="../js/kakao_sendtome.js" type="text/javascript"></script>
  <script src="../js/notice_aptrank.js" type="text/javascript"></script>
  <script src="../js/ad_aptrank_price.js" type="text/javascript"></script>
  <script src="../js/post_json.js" type="text/javascript"></script>

  <link href="../css/style_common.css" rel="stylesheet"/>
  <link href="../css/style_price.css" rel="stylesheet"/>
  <link href="../css/slider.css" rel="stylesheet"/>

  <script src="../js/doubleSlider.js" type="text/javascript"></script>
</head>
<style>
</style>

<body ontouchstart="">
  <!-- Google Tag Manager (noscript) -->
  <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-KNL2VQN"
  height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
  <!-- End Google Tag Manager (noscript) -->

  <div id="container">
    <div id="centerBox">
      <div id="titleBar">
        <!--검색 버튼 표시-->
        <div id='share1'></div>
        <!--재정렬 버튼 표시-->
        <div id="share2"></div>
        <!--타이틀 표시-->
        <div id="title" onClick='scrollUp()'><img src="./apt-rank_price_blank.png" height="34px"/></div>
        <!-- <div id="title" onClick='sendTo()'>리얼랭커스</div> -->
        <!--공유 버튼-->
        <!-- <div id="search" onClick='share(shareTitle, shareText, shareURL)'><i class='fa-solid fa-arrow-up-right-from-square'></i></div> -->
        <!--단지 가중치 설정 버튼 표시-->
        <div id='sort' data-clipboard-text=""></div>
        <div id="help" data-bs-toggle="offcanvas" data-bs-target="#offcanvasRight" id="offcanvas_right" aria-controls="offcanvasRight"><i class="fa-solid fa-ellipsis"></i></div>

      </div>

      <div id="selections">
        <div id="sido_selection"><select id="sido" onChange="sidoChange()"></select></div>
        <div id="gungu_selection"><select id="gungu" onChange="updateRegion()"></select></div>    
        <div id="month_selection">
          <select id="month" onChange="updateMonth()">
            <option value="latest_deal" id="recent_deal">오늘 등록된</option>
            <option value="202401" selected>2024년 01월</option>
            <option value="202312">2023년 12월</option>
            <option value="202311">2023년 11월</option>
            <option value="202310">2023년 10월</option>
            <option value="202309">2023년 09월</option>
            <!--
            <option value="202308">2023년 08월</option>            
            <option value="202307">2023년 07월</option>
            <option value="202306">2023년 06월</option>
            <option value="202305">2023년 05월</option>
            <option value="202304">2023년 04월</option>
            -->
          </select>
        </div>
      </div>

      <!--단지 가중치 표시창-->
      <!-- <div id="weight" data-bs-toggle='modal' data-bs-target='#baseModal' onClick='showSorting()'></div> -->
      <div id="weight"></div>

      <!--단지 검색창-->
      <div id="searchCard">
        <div id="iconSearch"><i class="fas fa-search"></i></div>
        <div id="searchGuide">
          <div id="searchNotice"></div>
          <div id="inputBox"><input id="inputSearch" type="text" placeholder="어느 단지를 찾아볼까요?" onkeyup="aptSearch()"></div>
          <div id="searchExample">예) 서초동, 래미안, 힐스테이트, 주공</div>
        </div>
        <div id="closeSearch" onClick='closeSearch()' ><i class="fas fa-times"></i></div>
      </div>

      <!--통합 검색창-->
      <div id="unifiedSearchCard">
        <div id="iconSearch"><i class="fas fa-search"></i></div>
        <div id="unifiedSearchGuide">
          <div id="unifiedSearchNotice">
            <div>
              <label>
                <input type="radio" class="searchRadio" name="options" id="option1" autocomplete="off" value = "global" checked onchange="radioActive(this.value)"><span style="padding-left: 5px; vertical-align: middle;">전국검색</span>
              </label>
            </div>
            <div>
              <label>
                <input type="radio" class="searchRadio" name="options" id="option2" autocomplete="off" value = "local" onchange="radioActive(this.value)"><span id='localSearch' style="padding-left: 5px; vertical-align: middle;">지역내검색</span>
              </label>
            </div>
          </div>
          <div id="unifiedInputBox"><input id="inputUnifiedSearch" type="text" placeholder="두 글자 이상 입력해 주세요" onkeyup="goSearchBySearchType()"></div>
          <div id="unifiedSearchExample">예) 서초동, 래미안, 힐스테이트, 주공</div>
        </div>
        <div id="closeUnifiedSearch" onClick='closeUnifiedSearch()' ><i class="fas fa-times"></i></div>
      </div>

      <!--시군구 검색창-->
      <div id="regionSearchCard">
        <div id="iconSearch"><i class="fas fa-search"></i></div>
        <div id="regionSearchGuide">
          <div id="regionSearchNotice">전국 시군구 이름으로 검색합니다.</div>
          <div id="regionInputBox"><input id="regionInputSearch" type="text" placeholder="어느 시군구를 찾아볼까요?" onkeyup="regionSearch()"></div>
          <div id="regionSearchExample">예) 서울, 창원, 강남, 서구</div>
        </div>
        <div id="closeRegionSearch" onClick='closeRegionSearch()' ><i class="fas fa-times"></i></div>
      </div>

      <!--단지 정렬창-->
      <div id="rearrangeCard">
        <div id="iconRearrange"><i class="fa-solid fa-arrow-down-wide-short"></i></div>
        <div id="rearrangeContatiner">
            <div id="rearrangeNotice"></div>
            <div class='rearrangeArea'>
              <div><input type='radio' class='btn-check' name='btnRearrange' autocomplete='off' id='rearrangeScore' onClick='rearrangeAPTList(this)'><label class='btn btn-outline-danger' for='rearrangeScore'>총점순</label></div>
              <div><input type='radio' class='btn-check' name='btnRearrange' autocomplete='off' id='rearrangeRank' onClick='rearrangeAPTList(this)'><label class='btn btn-outline-danger' for='rearrangeRank'>순위변동순</label></div>
              <div><input type='radio' class='btn-check' name='btnRearrange' autocomplete='off' id='rearrangePrice' onClick='rearrangeAPTList(this)'><label class='btn btn-outline-danger' for='rearrangePrice'>실거래가순</label></div>
              <div><input type='radio' class='btn-check' name='btnRearrange' autocomplete='off' id='rearrangeNew' onClick='rearrangeAPTList(this)'><label class='btn btn-outline-danger' for='rearrangeNew'>신축순</label></div>
              <div><input type='radio' class='btn-check' name='btnRearrange' autocomplete='off' id='rearrangeHouse' onClick='rearrangeAPTList(this)'><label class='btn btn-outline-danger' for='rearrangeHouse'>세대수순</label></div>
            </div>
        </div>
        <div id="closeRearrange" onClick='closeRearrange()' ><i class="fas fa-times"></i></div>
      </div>

      <!--시군구 정렬창-->
      <div id="rearrangeRegionCard">
        <div id="iconRearrange"><i class="fa-solid fa-arrow-down-wide-short"></i></div>
        <div id="rearrangeContatiner">
            <div id="rearrangeRegionNotice"></div>
            <div class='rearrangeArea'>
              <div><input type='radio' class='btn-check' name='btnRearrange' autocomplete='off' id='rearrangeRegionScore' onClick='rearrangeRegionList(this)'><label class='btn btn-outline-danger' for='rearrangeRegionScore'>총점순</label></div>
              <div><input type='radio' class='btn-check' name='btnRearrange' autocomplete='off' id='rearrangeRegionRank' onClick='rearrangeRegionList(this)'><label class='btn btn-outline-danger' for='rearrangeRegionRank'>순위변동순</label></div>
              <div><input type='radio' class='btn-check' name='btnRearrange' autocomplete='off' id='rearrangeRegionPop' onClick='rearrangeRegionList(this)'><label class='btn btn-outline-danger' for='rearrangeRegionPop'>인구순</label></div>
              <div><input type='radio' class='btn-check' name='btnRearrange' autocomplete='off' id='rearrangeRegionPopUpDown' onClick='rearrangeRegionList(this)'><label class='btn btn-outline-danger' for='rearrangeRegionPopUpDown'>인구증감순</label></div>
              <div><input type='radio' class='btn-check' name='btnRearrange' autocomplete='off' id='rearrangeRegionJob' onClick='rearrangeRegionList(this)'><label class='btn btn-outline-danger' for='rearrangeRegionJob'>일자리순</label></div>
              <div><input type='radio' class='btn-check' name='btnRearrange' autocomplete='off' id='rearrangeRegionIncome' onClick='rearrangeRegionList(this)'><label class='btn btn-outline-danger' for='rearrangeRegionIncome'>소득순</label></div>
            </div>
        </div>
        <div id="closeRegionRearrange" onClick='closeRegionRearrange()' ><i class="fas fa-times"></i></div>
      </div>
      <!--리스트 데이터 붙여넣는 영역-->
      <div id="dataList"></div>

      <!--리얼랭커스 연결-->
      <div id="linkToAptrank">
        <div id = 'tab1' onClick='openExternalLink("https://www.realrankus.com#aptrank.kr")'>아파트R</div>
        <div id = 'tab2' style="background-color: #e31939; color:white;">PRICE</div>
        <div id = 'tab3' onClick='openExternalLink("https://www.realrankus.com/theme#aptrank.kr")'>THEME</i></div>
        <div id = 'tab4' onClick='openExternalLink("https://www.realrankus.com/op#aptrank.kr")'>오피스텔R</div>        
        <div id = 'tab5' onClick='openExternalLink("https://www.realrankus.com/newsinfo#aptrank.kr")'>NEWS</div>
        <div id = 'tab6' onClick='openExternalLink("https://www.realrankus.com/biz#aptrank.kr")'>BIZ</div>
      </div>

      <!--단지 검색창 닫기 플로팅 버튼-->
      <div id="closeSearch_floating" onClick='closeSearch()'>
        <div id='closeSearch_floting_wraper'>
          <div id="closeIcon_floating"><i class="fas fa-times"></i></div>
          <div id="clostText_floating">검색닫기</div>
        </div>
      </div>
      <!--통합 검색창 닫기 플로팅 버튼-->
      <div id="closeUnifiedSearch_floating" onClick='closeUnifiedSearch()'>
        <div id='closeSearch_floting_wraper'>
          <div id="closeIcon_floating"><i class="fas fa-times"></i></div>
          <div id="clostText_floating">검색닫기</div>
        </div>
      </div>
      <!--시군구 검색창 닫기 플로팅 버튼-->
      <div id="closeRegionSearch_floating" onClick='closeRegionSearch()'>
        <div id='closeSearch_floting_wraper'>
          <div id="closeIcon_floating"><i class="fas fa-times"></i></div>
          <div id="clostText_floating">검색닫기</div>
        </div>
      </div>
      <!--단지 재정렬창 닫기 플로팅 버튼-->
      <div id="closeRearrange_floating" onClick='closeRearrange()'>
        <div id='closeSearch_floting_wraper'>
          <div id="closeIcon_floating"><i class="fas fa-times"></i></div>
          <div id="clostText_floating">정렬닫기</div>
        </div>
      </div>
      <!--단지 재정렬창 닫기 플로팅 버튼-->
      <div id="closeRegionRearrange_floating" onClick='closeRegionRearrange()'>
        <div id='closeSearch_floting_wraper'>
          <div id="closeIcon_floating"><i class="fas fa-times"></i></div>
          <div id="clostText_floating">정렬닫기</div>
        </div>
      </div>

    </div>
  </div>

  <!-- Vertically centered scrollable modal -->
  <!-- Button trigger modal -->
  <!-- Modal -->
  <div class="modal fade" id="baseModal" tabindex="-1" aria-labelledby="baseModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="baseModalLabel">Modal title</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body" id='aptDetail'></div>
        <div id='footer'></div>
      </div>
    </div>
  </div>
  <div class="modal fade" id="toggleModal1" tabindex="-1" aria-labelledby="toggleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="toggleModalLabel">Modal title</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body" id='simulDetail'></div>
        <div id='toggle1footer'></div>
      </div>
    </div>
  </div>
  <div class="modal fade" id="toggleModal2" tabindex="-1" aria-labelledby="toggleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="toggleModalLabe2">Modal title</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body" id='simulResult'></div>
        <div id='toggle2footer'></div>
      </div>
    </div>
  </div>

  <!-- Offcanvas Right -->
  <div class="offcanvas offcanvas-end" tabindex="-1" id="offcanvasRight" aria-labelledby="offcanvasRightLabel">
    <div class="offcanvas-header">
      <h5 id="offcanvasRightLabel">SERVICES</h5>
      <button type="button" class="btn-close text-reset btn-close-white" data-bs-dismiss="offcanvas" aria-label="Close"></button>
    </div>
    <div class="offcanvas-body"></div>
  </div>  

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@3.0.0/dist/chart.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2"></script>

  <script src="https://www.gstatic.com/firebasejs/8.8.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.8.1/firebase-database.js"></script>   

</body>

<script type="module" src="../js/con_counter.js"></script>

<script>
  var selectedMonth = "202401"
  var selectedRegion = "Korea"
  var selectedSubRegion = "1000000000_Korea"
  var selectedComplex = ""
  var searchType = "global"
  var update_ver = "?v=1.4"

  var pageName = "aptrank_PRICE" //20231020  

  var regionName = ""
  var linked = ""
  var regionValue = ""

  var itemNum = 0;
  var aptData = "";
  var sortData = "";
  var prevValue = 0;
  var regData = "";
  var regSortData = "";
  var adData = "";
  var blank_height = "3em"
  var count_data = ""

  var newHigh = 0
  var newLow = 0
  var newDeal = 0

  var modalState = 0;
  var searchState = 0;
  var popupHistory = [];

  var startNotice = false;
  var noticePop = false;
  var sortingPop = false;
  var alwaysSortingPop = "on";
  var regionSelection = false;

  var sales_history_price = []
  var sales_history_date = []
  var priceCharts = []
  var currentMenu = ""

  var count_info = ""

  var region_all = false

  var today = new Date()
  var prev_date = new Date()
  prev_date = prev_date.setMonth(prev_date.getMonth()-1)
  var monthago = new Date(prev_date)
  var today_day = dateReturn( today.getDate() );
  if (today_day == 1){    
    today = new Date(today.setDate(today.getDate() - 1))
  }
  var today_year = today.getFullYear();
  var today_month = dateReturn( (today.getMonth() + 1))
  var today_num = Number("" + today_year + today_month + today_day)  
  var today_str = today_year + "-" + today_month + "-" + today_day
  var today_short_str = (today.getMonth() + 1) + "/" + today_day
  var this_month = "" + (today_year) + today_month
  var prev_month = "" + (monthago.getFullYear()) + dateReturn( (monthago.getMonth() + 1))

  var start_date_str = (today.getMonth() + 1) + "/1"
  var end_date_str = (today.getMonth() + 1) + "/" + today.getDate()

  var updated_datetime = ""

  var lastScrollY_d00
  var lastScrollY_d01

  function dateReturn(n){
    return n<10 ? "0"+n : n
  }

  var broswerInfo = navigator.userAgent;
  var UserAgent = navigator.userAgent; 
  if (UserAgent.match(/iPhone|ipad|Android|Windows CE|BlackBerry|Symbian|Windows Phone|webOS|Opera Mini|Opera Mobi|POLARIS|IEMobile|lgtelecom|nokia|SonyEricsson/i) != null || UserAgent.match(/LG|SAMSUNG|Samsung/) != null)
  {
    var isMobile = true
  }

  $(document).ready(function(){
    //document.cookie = "safeCookie1=foo; SameSite=Lax";
    //document.cookie = "safeCookie2=foo";
    //document.cookie = "crossCookie=bar; SameSite=None; Secure";

    Kakao.init(kakaoKey);

    $('div.modal').on('show.bs.modal', function() {
      var modal = this;
      var hash = modal.id;
      window.location.hash = hash;
      window.onhashchange = function() {
        if (!location.hash){
          $(modal).modal('hide');
        }
      }
    });    

    // SDK 초기화 여부를 판단합니다.
    //console.log(Kakao.isInitialized());

    var option = ""
    for(i = 0 ; i < regions.length ; i++){
        option += "<option value='" + regions[i][1] + "'>" + regions[i][0] + "</option>"
    }
    $('#sido').html(option)

    var lastRegion = localStorage.getItem('lastRegion_price')
    var lastSubRegion = localStorage.getItem('lastSubRegion_price')
    var lastMonth = localStorage.getItem('lastMonth_price')
    //var lastNoticed = localStorage.getItem('lastNoticed_price')

    //var lastScrollY = sessionStorage.getItem('lastScrollY')
    //var lastSubRegion = sessionStorage.getItem('lastSubRegion')
    //var lastMonth = sessionStorage.getItem('lastMonth')

    const url = new URL(window.location.href)
    const urlParams = url.searchParams
    //console.log(urlParams)

    if(urlParams.has('preg')){
      //console.log(urlParams.get('reg'))
      selectedRegion = urlParams.get('preg')
    }
    else if(lastRegion != null){
      selectedRegion = lastRegion
    }

    if(urlParams.has('psub')){
      //console.log(urlParams.get('sub'))
      selectedSubRegion = urlParams.get('psub')
    }
    else if(lastSubRegion != null){
      selectedSubRegion = lastSubRegion
    }

    if(urlParams.has('pmon')){
      //console.log(urlParams.get('mon'))
      selectedMonth = urlParams.get('pmon')
    }
    else if(lastMonth != null){
      selectedMonth = lastMonth
    }
    else{
      initSorting()
    }

    if (selectedRegion != 'Korea' && urlParams.has('pmon') == false){
        selectedMonth = 'latest_deal'
    }
    
    $("#month").val(selectedMonth).prop("selected", true);
    $("#sido").val(selectedRegion).prop("selected", true);
    regionName = $("#sido option:selected").val();

    $('#dataList').html("");

    optionChange(selectedSubRegion)
    updateRegion()

    if(checkMobile() == "ios"){
      share1Html = "<div class='tShare' onClick='CopyToClipboard(shareText, popMsg)'><i class='fa-regular fa-copy'></i></div>"
    }
    else{
      share1Html = "<div class='tShare' onClick='kakaoShare(shareTitle, shareText, shareURL)'><img src=\"kakao_icon.png\" height=\"28px\"/></div>"
    }    
    $('#share1').html(share1Html)

    if(broswerInfo.indexOf("inApp")>-1){
      share2Html = "<div class='tShare' onClick='CopyToClipboard(shareText, popMsg)'><i class='fa-regular fa-copy'></i></div>"
    }
    else{
      //share2Html = "<div class='tShare' onClick='CopyToClipboard(shareText, popMsg)'><i class='fa-solid fa-copy'></i></div>"
      share2Html = "<div class='tShare' onClick='share(shareTitle, shareText, shareURL)'><i class='fa-solid fa-arrow-up-right-from-square'></i></div>"
    }

    $('#share2').html(share2Html)

    if(checkMobile() == "ios"){ blank_height = "3em" }
    else{ blank_height = "3em" }
    $("#linkToAptrank").css('height', blank_height)
    $("#linkToAptrank").css('line-height', blank_height)

    if(selectedRegion == "Korea"){ $("#recent_deal").hide() }
    else{ $("#recent_deal").show() }

    currentMenu = "aptrank_price"  //offcanvas  
    setOffcanvasMenu() //offcanvas

  });

  simple_view = 0
  function simple_and_detail(){
    if(isMobile){
      if(simple_view == 0){
        $(".compare_price").slideUp(450)
        $(".hided_ratio").fadeIn(450)
        $(".price_content").animate({
          'margin-top' : '0px'
        }, 450)        
        $(".date_saperator_icon").html("<i class='fa-solid fa-up-right-and-down-left-from-center'></i>")
        $(".hidden_saperator_icon").html("<i class='fa-solid fa-up-right-and-down-left-from-center'></i>")
        simple_view = 1
      }
      else{
        $(".compare_price").slideDown(450)
        $(".hided_ratio").fadeOut(450)
        $(".price_content").animate({
          'margin-top' : '5px'
        }, 450)        
        $(".date_saperator_icon").html("<i class='fa-solid fa-down-left-and-up-right-to-center'></i>")
        $(".hidden_saperator_icon").html("<i class='fa-solid fa-down-left-and-up-right-to-center'></i>")
        simple_view = 0
      }    
    }
  }

  function showWeight(){
      $('#weight').show()
      $('#dataList').css({'padding-top': '115px'})

      var weightInfo = "업데이트 : " + updated_datetime
      $('#weight').html(weightInfo)
  }

  function radioActive(val){
    searchType = val
    $("#inputUnifiedSearch").val("")
    goSearchBySearchType()
    $('#inputUnifiedSearch').focus();
  }

  function sidoChange(){
    regionSelection = true
    optionChange()    

    if(selectedRegion == "Korea"){
      $("#recent_deal").hide()
      $("#month option:eq(1)").prop("selected", true);
      selectedMonth = $("#month option:selected").val()
    }
    else{
      $("#recent_deal").show()
      $("#month option:eq(0)").prop("selected", true);
      selectedMonth = $("#month option:selected").val()
    }

    updateRegion()
  }

  function saveLocalStorage(){
    localStorage.setItem('lastRegion_price', selectedRegion)
    localStorage.setItem('lastSubRegion_price', selectedSubRegion)
    //localStorage.setItem('lastMonth', selectedMonth)

    //sessionStorage.setItem('lastRegion', selectedRegion)
    //sessionStorage.setItem('lastSubRegion', selectedSubRegion)
    //sessionStorage.setItem('lastMonth', selectedMonth)
  }

  function saveSessionStorage(){
    if(selectedRegion == "Korea"){      
      if(selectedSubRegion == "1000000000_Korea"){
        sessionStorage.setItem('lastScrollY_d00', lastScrollY_d00)
      }
      else{
        sessionStorage.setItem('lastScrollY_d01', lastScrollY_d01)
      }
    }        
    //sessionStorage.setItem('lastSubRegion', selectedSubRegion)
    //sessionStorage.setItem('lastMonth', selectedMonth)
  }  

  window.onpageshow = function(event) {
    if ( event.persisted || (window.performance && window.performance.navigation.type == 2)) {
      // Back Forward Cache로 브라우저가 로딩될 경우 혹은 브라우저 뒤로가기 했을 경우
      if(selectedRegion == "Korea"){
        if(selectedSubRegion == "1000000000_Korea"){
          lastScrollY_d00 = sessionStorage.getItem('lastScrollY_d00')
          lastScrollY_d01 = sessionStorage.getItem('lastScrollY_d01')
        }
      }
    }  
  }

  document.addEventListener('scroll', function() {
      var currentScrollValue = document.documentElement.scrollTop;
      if(selectedRegion == "Korea"){
        if(selectedSubRegion == "1000000000_Korea"){
          lastScrollY_d00 = currentScrollValue
        }
        else{
          lastScrollY_d01 = currentScrollValue
        }
        saveSessionStorage()
      }      
  });

  function scrollUp(){
    $( 'html, body' ).animate( { scrollTop : 0 }, 50 );
  }

  function optionChange(subRegion){
    selectedSubRegion = subRegion
    regionName = $("#sido option:selected").val();
    selectedRegion = regionName
    var changeItem

    if(regionName == 'Korea'){
      changeItem = inKorea
    }
    if(regionName == 'Seoul'){
      changeItem = inSeoul
    }
    if(regionName == 'Busan'){
      changeItem = inBusan
    }
    if(regionName == 'Incheon'){
      changeItem = inIncheon
    }
    if(regionName == 'Daegu'){
      changeItem = inDaegu
    }
    if(regionName == 'Gwangju'){
      changeItem = inGwangju
    }
    if(regionName == 'Daejeon'){
      changeItem = inDaejeon
    }
    if(regionName == 'Ulsan'){
      changeItem = inUlsan
    }
    if(regionName == 'Sejong'){
      changeItem = inSejong
    }
    if(regionName == 'Gyeonggi'){
      changeItem = inGyeonggi
    }
    if(regionName == 'Gangwondo'){
      changeItem = inGangwondo
    }
    if(regionName == 'Chungcheongbukdo'){
      changeItem = inChungcheongbukdo
    }
    if(regionName == 'Chungcheongnamdo'){
      changeItem = inChungcheongnamdo
    }
    if(regionName == 'Jeollabukdo'){
      changeItem = inJeollabukdo
    }
    if(regionName == 'Jeollanamdo'){
      changeItem = inJeollanamdo
    }
    if(regionName == 'Gyeongsangbukdo'){
      changeItem = inGyeongsangbukdo
    }
    if(regionName == 'Gyeongsangnamdo'){
      changeItem = inGyeongsangnamdo
    }
    if(regionName == 'Jejudo'){
      changeItem = inJejudo
    }
    $('#gungu').empty();

    for(var i = 0 ; i < changeItem.length; i++){
      var subOption = $("<option value='" + changeItem[i][1] + "'>" + changeItem[i][0] + "</option>")
      $('#gungu').append(subOption);
    }

    if(selectedSubRegion == undefined){
      $("#gungu").val(changeItem[0][1]).prop("selected", true);
      selectedSubRegion = $("#gungu option:selected").val()
    }
    else{
      $("#gungu").val(selectedSubRegion).prop("selected", true);
    }
    //updateRegion()
  }

  var monthSelect = false;

  function updateMonth(){    
    selectedMonth = $("#month option:selected").val()
    //monthSelect = true
    updateRegion()
    regionName = $("#sido option:selected").text()
    //saveLocalStorage()
  }
  function updateRegion(){    
    selectedRegion = $("#sido option:selected").val()
    selectedSubRegion = $("#gungu option:selected").val()
    
    if( $("#gungu option:selected").text() == "전체" ){
      region_all = true
      $("#month option:contains('20')").prop('hidden', true)          
      $("#month option:eq(0)").prop('selected', true)
      selectedMonth = "latest_deal"
    }
    else{
      region_all = false
      $("#month option:contains('20')").prop('hidden', false)
    }    

    $.ajaxSetup({ async: false });
    count_url = "https://www.realrankus.com/price/recent/" + selectedMonth + "/daily_count.json?v=" + Math.random()
    
    $.getJSON(count_url, function(json){
      count_data = json
      updated_info = count_data['data'][1]['daily_count']      
      updated_datetime = updated_info[updated_info.length-1][2]
      if(updated_datetime == undefined){
        updated_datetime = updated_info[0][0].substr(0, 4) + "-" + updated_info[0][0].substr(4, 2) + "-" + updated_info[0][0].substr(6, 2) + ", 23:59"
      }
      
      for(var y = 0 ; y < count_data['data'].length; y++){        
        if(count_data['data'][y]['file_name'] == selectedSubRegion){
          count_info = count_data['data'][y]['daily_count']
          BYG_count_info = count_data['data'][y]['daily_count_BYG']
          region_count_info = count_data['data'][y]['region_count']
          latest_count_info = count_data['data'][y]['new_deal_count']
          break;
        }
      }
    })

    if( regData == undefined || regData == "" ){
      url = "https://www.realrankus.com/price/recent/" + selectedMonth + "/sales_volume.json?v=" + Math.random()
      $.getJSON(url, function(json) {        
          regData = json;
          regSortData = regData;        
      })
    }
    $.ajaxSetup({ async: true });

    localSearchText = shortRegionName($("#sido option:selected").text() + " " + $("#gungu option:selected").text())
    $("#localSearch").html(localSearchText + " 검색")

    if (selectedRegion == "Korea"){
      $("#recent_deal").hide()
      updateRegionTable(selectedSubRegion)
    }
    else{
      $("#recent_deal").show()
      updateTable(selectedSubRegion)
    }    
    showWeight()
  }

function updateTable(region){
    //$('div.modal').modal("hide");    
    $('#sort').css("visibility", "visible")
    $('#rearrange').css("visibility", "visible")
    $('html').scrollTop(0)
    //initSorting()

    $('#dataList').html("");

    //광고정보 로딩
    $.ajaxSetup({ async: false }); 
    load_parrtnership(region)    
    $.ajaxSetup({ async: true });

    //prev_url = "https://www.realrankus.com/price/recent/" + load_this_month + "/" + region + ".json?v=" + Math.random()
    //this_url = "https://www.realrankus.com/price/recent/" + load_prev_month + "/" + region + ".json?v=" + Math.random()

    regionName = $("#sido option:selected").text() + " " + $("#gungu option:selected").text()
    if (selectedMonth == 'latest_deal'){
      shareTitle = "[" + regionName + " 오늘(" + today_short_str + ") 실거래]"
    }
    else{
      shareTitle = "[" + regionName + " " + start_date_str + "~" + end_date_str + " 실거래]"
    }
    //shareURL = "https://www.realrankus.com/price" + "?preg=" + $("#sido option:selected").val() + "&psub=" + $("#gungu option:selected").val() + "&pmon=" + selectedMonth
    shareURL = get_sURL(region)

    if (selectedMonth == 'latest_deal'){
      shareText = "[" + regionName + " 오늘(" + today_short_str + ") 등록된 실거래]\n"
    }
    else{
      shareText = "[" + regionName + ", " + start_date_str + "~" + end_date_str + " 실거래]\n"
    }

    url = "https://www.realrankus.com/price/recent/" + selectedMonth + "/" + region + ".json?v=" + Math.random()
    $.getJSON(url, function(json) {
        //console.log(json);
        aptData = json;
        //sortData = json;
        //aptData.data = Object.assign(aptData.data, this_apt_data.data)
        itemNum = aptData.data.length;

        newHigh = 0
        newLow = 0
        newDeal = 0
        higherDeal = 0
        lowerDeal = 0

        regionCountUp(pageName, region) //20231020

        //aptData.data = (aptData.data).reverse()
        reverse_count_info = count_info.reverse()

        if(selectedMonth == 'latest_deal'){
          region_deal_count_info = latest_count_info
        }
        else{
          region_deal_count_info = region_count_info
        }
      
        sep_array = []
        count_sum = 0

        for(var y = 0 ; y < region_deal_count_info.length ; y++){
          if(y==0){
            sep_array.push([ region_deal_count_info[y][0], 0, [region_deal_count_info[y][2]] ])
            count_sum = region_deal_count_info[y][1]
          }
          else{            
            sep_array.push([ region_deal_count_info[y][0], count_sum, [region_deal_count_info[y][2]] ])            
            count_sum += region_deal_count_info[y][1]
          }          
        }

        var addon_html = ""

        //[ ['20230404', 12, '2023-04-03, 17:43'], ['20230403', 9, '2023-04-03, 17:43'], ['20230402', 4, '2023-04-02, 23:26']]

        //광고정보표시
        show_partnership() 

        if(itemNum == 0){
          if(selectedMonth == 'latest_deal'){
            addon_html = "<div class='data_empty'>" + "오늘 (" + today_short_str + ") 등록된 실거래 정보가 없네요.<br><span style='font-size:0.8em'>(업데이트 시간이 안 되었을 수도 있으니 조금 기다려주세요!)</span>" + "</div>"
          }
          else{
            exp_start_date = reverse_count_info[0][0].substr(0, 4) + "-" + reverse_count_info[0][0].substr(4, 2) + "-01"
            exp_date = reverse_count_info[0][0].substr(0, 4) + "-" + reverse_count_info[0][0].substr(4, 2) + "-" + reverse_count_info[0][0].substr(6, 2)
            addon_html = "<div class='data_empty'>" + "등록된 실거래 정보가 없네요.<br>(" + exp_start_date + " ~ " + exp_date + ")" + "</div>"
          }
          $('#dataList').append(addon_html);
        }
        else{
          addon_html = "<div class='data_selection'>"
            addon_html += "<div><input type='radio' class='btn-check' name='btnRearrange' autocomplete='off' id='rearrangeAll' onClick='rearrangeList(this, 0)' checked><label class='btn btn-outline-danger' id='label_all' for='rearrangeAll'>#전체</label></div>"
            addon_html += "<div><input type='radio' class='btn-check' name='btnRearrange' autocomplete='off' id='rearrangeHigher' onClick='rearrangeList(this, higherDeal)'><label class='btn btn-outline-danger' id='label_higher' for='rearrangeHigher'>#상승</label></div>"
            addon_html += "<div><input type='radio' class='btn-check' name='btnRearrange' autocomplete='off' id='rearrangeLower' onClick='rearrangeList(this, lowerDeal)'><label class='btn btn-outline-danger' id='label_lower' for='rearrangeLower'>#하락</label></div>"

            addon_html += "<div><input type='radio' class='btn-check' name='btnRearrange' autocomplete='off' id='rearrangeHighest' onClick='rearrangeList(this, newHigh)'><label class='btn btn-outline-danger' id='label_newHigh' for='rearrangeHighest'>#신고가</label></div>"
            addon_html += "<div><input type='radio' class='btn-check' name='btnRearrange' autocomplete='off' id='rearrangeLowest' onClick='rearrangeList(this, newLow)'><label class='btn btn-outline-danger' id='label_newLow' for='rearrangeLowest'>#신저가</label></div>"            
            //addon_html += "<div><input type='radio' class='btn-check' name='btnRearrange' autocomplete='off' id='rearrangeNewdeal' onClick='rearrangeList(this, newDeal)'><label class='btn btn-outline-danger' id='label_newDeal' for='rearrangeNewdeal'>#최근</label></div>"
            addon_html += "<div></div>"
          addon_html += "</div>"

          $('#dataList').append(addon_html);
        }

        share_count = 0

        shareText += "(전체 " + itemNum + "건)\n\n"

        addon_html = "<div class='hidden_saperator' onClick='simple_and_detail()'>"
          addon_html += "<div class = 'hidden_saperator_text'></div>"
          addon_html += "<div class = 'hidden_saperator_icon'><i class='fa-solid fa-down-left-and-up-right-to-center'></i></div>"
        addon_html += "</div>"
        $('#dataList').append(addon_html);        

        for(var i = 0 ; i < itemNum ; i++){
          addon_html = ""
          
          deal_count = itemNum
          for(var j = 0; j < sep_array.length ; j++){
            if(i == sep_array[j][1]){
              exp_region = sep_array[j][0]
              deal_count = region_deal_count_info[j][1]
              //gap_count = region_count_info[j][2]
              //new_count = gap_count

              if(isMobile){
                addon_html = "<div class='date_saperator' onClick='simple_and_detail()'>"
                addon_html += "<div class = 'date_saperator_text'>" + exp_region + " (" + deal_count + "건)" + "</div>"
                addon_html += "<div class = 'date_saperator_icon'><i class='fa-solid fa-down-left-and-up-right-to-center'></i></div>"
              }
              else{
                addon_html += "<div class='date_saperator_web'>"
                  addon_html += "<div class = 'date_saperator_text'>" + exp_region + " (" + deal_count + "건)" + "</div>"
                  addon_html += "<div></div>"
              }
                
              addon_html += "</div>"
            }
          }

          var aptName = aptData.data[i]["아파트"]
          var apt_m = aptData.data[i]["전용면적"]
          var apt_p = (Number(apt_m)/3.3058)
          if(apt_m < 84){ apt_p += 7 }
          else if(apt_m >= 84){ apt_p += 8 }
          var deal_type = aptData.data[i]["거래유형"]
          var deal_price = aptData.data[i]["거래금액"]
          deal_price = deal_price.replaceAll(",", "")
          var deal_price_num = Number(deal_price)
          var deal_new_old = aptData.data[i]["type"]
          var apt_build = aptData.data[i]["건축년도"]
          var year_gap = (today_year - apt_build) + 1

          var road_address = ""
          if(aptData.data[i]["도로명건물본번호코드"] != null){
            var road_address = $("#sido option:selected").text() + " " + $("#gungu option:selected").text() + " " + aptData.data[i]["도로명"] + " " + Number(aptData.data[i]["도로명건물본번호코드"])
            if(Number(aptData.data[i]["도로명건물부번호코드"]) != 0){
              road_address += "-" + Number(aptData.data[i]["도로명건물부번호코드"])
            }
          }

          if(region_all){
            var lawed_address = $("#sido option:selected").text() + " " + exp_region
          }
          else{
            var lawed_address = $("#sido option:selected").text() + " " + $("#gungu option:selected").text() + " " + aptData.data[i]["법정동"]
          }
          
          //var lawed_address = aptData.data[i]["법정동"]
          if(Number(aptData.data[i]["법정동본번코드"] != null)){
            lawed_address += " " + Number(aptData.data[i]["법정동본번코드"])
            if(Number(aptData.data[i]["법정동부번코드"]) != 0){
              lawed_address += "-" + Number(aptData.data[i]["법정동부번코드"])
            }
          }
          else{
            if(Number(aptData.data[i]["지번"] != null)){
              lawed_address += " " + (aptData.data[i]["지번"]).toString()
            }
            else{
              lawed_address += ""
            }
          }

          var dealed_year = aptData.data[i]["년"]
          var dealed_month = aptData.data[i]["월"]
          var dealed_day = aptData.data[i]["일"]
          if(Number(dealed_month) < 10){dealed_month = "0" + dealed_month}
          if(Number(dealed_day) < 10){dealed_day = "0" + dealed_day}

          var dealed_date = dealed_year + "-" + dealed_month + "-" + dealed_day

          var deal_floor = aptData.data[i]["층"]

          var canceled = aptData.data[i]["해제여부"]
          var canceled_date = aptData.data[i]["해제사유발생일"]

          var dealed_history_date = aptData.data[i]["history_date"]
          var dealed_history_price = aptData.data[i]["history_price"]

          var graph_history_date = aptData.data[i]["graph_history_date"]
          var graph_history_price = aptData.data[i]["graph_history_price"]

          var max_price_deal = aptData.data[i]["max_price"]
          var min_price_deal = aptData.data[i]["min_price_from_2019"]

          var naver_code = ""
          if(aptData.data[i]["code"] != null){
            naver_code = (aptData.data[i]["code"]).toString()
          }
          var coord_x = aptData.data[i]["x"]
          var coord_y = aptData.data[i]["y"]

          compare_list = compare_price(deal_price_num, max_price_deal, min_price_deal, dealed_history_date, dealed_history_price, dealed_date)

          list_class_name = "listBox"
          if(Number(deal_price) > Number(max_price_deal[1])){
            list_class_name += " highest"
            newHigh++
          }
          if(Number(deal_price) < Number(min_price_deal[1])){
            list_class_name += " lowest"
            newLow++
          }
          if(Number(deal_price) > last_dealed_price){
            list_class_name += " higher"
            higherDeal++
          }
          if(Number(deal_price) < last_dealed_price){
            list_class_name += " lower"
            lowerDeal++
          }

          addon_html += "<div class='" + list_class_name + "' data-bs-toggle='modal' data-bs-target='#baseModal' id='aptSelect' onClick='showDetail(" + i + ",\"" + exp_region + "\")'>";

          addon_html += "<div class='content'>";
          if(deal_new_old == "BYG"){
            apt_type_tag = "<span class='BYG_mark'>분양권</span> "
            addon_html += "<div class='apt_name'>" + aptName + apt_type_tag +"<span style='color: gray; font-size: 0.75em'> / " + lawed_address +"</span></div>";
          }
          else{
            apt_type_tag = ""
            addon_html += "<div class='apt_name'>" + aptName + apt_type_tag +"<span style='color: gray; font-size: 0.75em'> / " + year_gap + "년차 / " + lawed_address +"</span></div>";
          }          

          addon_html += "<div class='price_content'>"

            addon_html += "<div class='price_table2'>"
              addon_html += "<div class='price_info'>"
                addon_html += "<div class='price_num'>" + Korean_price(deal_price_num) + "</div>"
                addon_html += "<div class='hided_ratio'>직전대비 " + compare_last_tag + "</div>"
              addon_html += "</div>"
              addon_html += "<div class='complex_table'>"
                addon_html += "<div class='apt_address' style='color:black'>" + deal_floor + "층, 약 " + apt_p.toFixed(0) + "평 (" + apt_m + ")</div>"
                if(deal_type != "중개거래"){
                  addon_html += "<div class='apt_address'><span style='color: #e31939'>"  + deal_type + "</span> | " + dealed_date + "</div>"
                }
                else{
                  addon_html += "<div class='apt_address'>"  + deal_type + " | " + dealed_date + "</div>"
                }                
              addon_html += "</div>"
            addon_html += "</div>"

            addon_html += "<div class='compare_price'>"
              if(last_dealed_date == undefined){
                addon_html += "<div>직전거래 대비</div>" + "<div>" + compare_last_tag + "</div>" + "<div>" + Korean_price(last_dealed_price) + " (정보없음)</div>"
              }
              else{
                addon_html += "<div>직전거래 대비</div>" + "<div>" + compare_last_tag + "</div>" + "<div>" + Korean_price(last_dealed_price) + " (" + last_dealed_date + ")</div>"
              }
              addon_html += "<div>최고가 대비</div>" + "<div>" + compare_max_tag + "</div>"  + "<div>" + Korean_price(max_price_deal[1]) + " (" + max_price_deal[0] + ")</div>"
              addon_html += "<div>최저가 대비</div>" + "<div>" + compare_min_tag + "</div>"  + "<div>" + Korean_price(min_price_deal[1]) + " (" + min_price_deal[0] + ")</div>"
            addon_html += "</div>"
          addon_html += "</div>"

          if(itemNum < 5){
            share_count = reverse_count_info.length
          }
          else{
            share_count = 5
          }
          
          if(i < share_count){
            shareText += "『" + aptName
            if(deal_new_old == "BYG"){
              shareText += " (분양권)』\n"
            }
            else{
              shareText += " (" + year_gap + "년차)』\n"
            }
            shareText += "ㆍ" + Korean_price(deal_price_num) + " (" + dealed_date + ")\n"
            shareText += "ㆍ" + deal_floor + "층, 약 " + apt_p.toFixed(0) + "평 (" + apt_m + ")\n"
            shareText += "ㆍ직전대비 : " + compare_last_ratio + "\n\n"
          }

          $('#dataList').append(addon_html);
        }

        if(itemNum == 0){
            shareText += "등록된 실거래 정보 없음"
        }

        shareText += shareURL
        popMsg = "'" + regionName + "'" + " 거래량 정보가 복사되었습니다."
      
        if(isMobile){
          $(".price_content").css('grid-template-columns', '1fr')
          $(".price_table2").css('grid-template-columns', '110px 1fr')
          $(".price_table2").css('border-right', '0px')
          $(".price_table2").css('margin-top', '5px')
          //$(".price_table").css('margin-bottom', '5px')
          $(".price_table2").css('padding-bottom', '5px')
          //$(".price_table").css('border-top', '1px solid #ddd')
          //$(".price_table").css('border-bottom', '1px solid #eee')
          $(".price_num").css('line-height', '1.2em')
          $(".price_num").css('font-size', '1em')
          $(".apt_name").css('font-size', '0.9em')
          $(".compare_price").css('font-size', '0.7em')         
          $(".compare_price").css('font-weight', '600')
          $(".compare_price").css('padding-top', '10px')
          $(".compare_price").css('border-top', '1px solid #eee')
          //$(".date_saperator:active").css('background-color', '#e0e0e0')
        }        
        $(".hided_ratio").hide()
        $(".hidden_saperator").hide()

        $('#label_all').html("#전체 (" + itemNum + ")")
        $('#label_newHigh').html("#신고가 (" + newHigh + ")")
        $('#label_newLow').html("#신저가 (" + newLow + ")")
        //$('#label_newDeal').html("#최근 (" + newDeal + ")")
        $('#label_higher').html("#상승 (" + higherDeal + ")")
        $('#label_lower').html("#하락 (" + lowerDeal + ")")

        $('#dataList').append("<div style='height: " + blank_height + "'></div>");
    })
    showWeight()
    //saveLocalStorage()    
  }

  function Korean_price(price){
    price_exp_num1 = Math.floor(price/10000)
    price_exp_num2 = Math.round( ((price/10000)%1) * 10000 , 0)
    if(price_exp_num1 == 0){ price_exp_1 = "" }
    else{ price_exp_1 = price_exp_num1 + "억" }

    if(price_exp_num2 == 0){ price_exp_2 = "" }
    else{ price_exp_2 = price_exp_num2 + "만" }

    if(isNaN(price_exp_num1)){
      return "---"
    }
    else{
      return price_exp_1 + " " + price_exp_2
    }
  }

  function searchAndShow(searched_code){
    var itemNums = aptData.data.length
    for(var p = 0 ; p < itemNums ; p++){        
        var aptCode = aptData.data[p]["검색코드"]
        if(aptCode == searched_code){
          return p
        }        
    }
  }

  function compare_price(deal_price_num, max_price_deal, min_price_deal, dealed_history_date, dealed_history_price, dealed_date){
    last_dealed_date = dealed_history_date[dealed_history_date.length - 1]
    last_dealed_price = dealed_history_price[dealed_history_price.length - 1]
    
    //console.log("last_dealed_date :", last_dealed_date)
    //console.log("dealed_date :", dealed_date)

    if(last_dealed_date == dealed_date){
      last_dealed_date = dealed_history_date[dealed_history_date.length - 2]
      last_dealed_price = dealed_history_price[dealed_history_price.length - 2]
    }
    else{
      last_dealed_date = dealed_history_date[dealed_history_date.length - 1]
      last_dealed_price = dealed_history_price[dealed_history_price.length - 1]
    }

    compare_last = ((deal_price_num/last_dealed_price) - 1) * 100
    compare_max = ((deal_price_num/max_price_deal[1]) - 1) * 100
    compare_min = ((deal_price_num/min_price_deal[1]) - 1) * 100

    if(compare_last > 0){ compare_last_tag = "<span style='color:#eb5050'>▲" + (Math.abs(compare_last)).toFixed(2) + "%</span>" 
                        compare_last_ratio = "▲" + (Math.abs(compare_last)).toFixed(2) + "%" }
    else if(compare_last < 0){ compare_last_tag = "<span style='color:#3d7fca'>▼" + (Math.abs(compare_last)).toFixed(2) + "%</span>"
                              compare_last_ratio = "▼" + (Math.abs(compare_last)).toFixed(2) + "%" }
    else if( isNaN(compare_last)){ compare_last_tag = "<span style='color:black'>정보없음</span>" 
                                 compare_last_ratio = "정보없음" }
    else { compare_last_tag = "<span style='color:black'>= " + (Math.abs(compare_last)).toFixed(2) + "%</span>" 
          compare_last_ratio = "=" + (Math.abs(compare_last)).toFixed(2) + "%" }

    if(compare_max > 0){ compare_max_tag = "<span style='color:#eb5050'>▲" + (Math.abs(compare_max)).toFixed(2) + "%</span>" }
    else if(compare_max < 0){ compare_max_tag = "<span style='color:#3d7fca'>▼" + (Math.abs(compare_max)).toFixed(2) + "%</span>" }
    else if( isNaN(compare_max)){ compare_max_tag = "<span style='color:black'>정보없음</span>" }
    else { compare_max_tag = "<span style='color:black'>= " + (Math.abs(compare_max)).toFixed(2) + "%</span>" }
    
    if(compare_min > 0){ compare_min_tag = "<span style='color:#eb5050'>▲" + (Math.abs(compare_min)).toFixed(2) + "%</span>" }
    else if(compare_min < 0){ compare_min_tag = "<span style='color:#3d7fca'>▼" + (Math.abs(compare_min)).toFixed(2) + "%</span>" }
    else if( isNaN(compare_min)){ compare_min_tag = "<span style='color:black'>정보없음</span>" }
    else { compare_min_tag = "<span style='color:black'>= " + (Math.abs(compare_min)).toFixed(2) + "%</span>" }
    
    return {'last_dealed_date' : last_dealed_date, 'last_dealed_price' : last_dealed_price, 'compare_last_ratio' : compare_last_ratio, 'compare_last_tag' : compare_last_tag, 'compare_max_tag' : compare_max_tag, 'compare_min_tag' : compare_min_tag}
  }

  function showDetail(index, addr_gungu){
    titleHtml = "";
    detailHtml = "";
    footerHtml = "";

    var aptName = aptData.data[index]["아파트"]
    var apt_m = aptData.data[index]["전용면적"]
    var apt_p = (Number(apt_m)/3.3058)
    if(apt_m < 84){ apt_p += 7 }
    else if(apt_m >= 84){ apt_p += 8 }
    var deal_type = aptData.data[index]["거래유형"]
    var deal_price = aptData.data[index]["거래금액"]
    deal_price = deal_price.replaceAll(",", "")
    var deal_price_num = Number(deal_price)
    var deal_new_old = aptData.data[index]["type"]
    var apt_build = aptData.data[index]["건축년도"]
    var year_gap = (today_year - apt_build) + 1    
    var rankAddr_split = ""

    var road_address = ""
    if(aptData.data[index]["도로명건물본번호코드"] != null){
      if(region_all){
        road_address = $("#sido option:selected").text() + " " + addr_gungu + " " + aptData.data[index]["도로명"] + " " + Number(aptData.data[index]["도로명건물본번호코드"])
      }
      else{
        road_address = $("#sido option:selected").text() + " " + $("#gungu option:selected").text() + " " + aptData.data[index]["도로명"] + " " + Number(aptData.data[index]["도로명건물본번호코드"])
      }      
      if(Number(aptData.data[index]["도로명건물부번호코드"]) != 0){
        road_address += "-" + Number(aptData.data[index]["도로명건물부번호코드"])
      }
    }

    //var lawed_address = $("#sido option:selected").text() + " " + $("#gungu option:selected").text() + " " + aptData.data[index]["법정동"]

    if(region_all){
      var lawed_address = $("#sido option:selected").text() + " " + addr_gungu
      rankAddr_split = addr_gungu.split(" ")
      if(rankAddr_split[0] == "고양시" || rankAddr_split[0] == "안양시" || rankAddr_split[0] == "수원시" || rankAddr_split[0] == "안산시" || rankAddr_split[0] == "성남시" || 
        rankAddr_split[0] == "용인시" || rankAddr_split[0] == "청주시" || rankAddr_split[0] == "창원시" || rankAddr_split[0] == "포항시" || rankAddr_split[0] == "천안시" || rankAddr_split[0] == "전주시"){
          rankAddr = rankAddr_split[0] + " " + rankAddr_split[1]
        }
        else{
          rankAddr = rankAddr_split[0]
        }
    }
    else{
      var lawed_address = $("#sido option:selected").text() + " " + $("#gungu option:selected").text() + " " + aptData.data[index]["법정동"]
      rankAddr = $("#gungu option:selected").text()
    }

    if(Number(aptData.data[index]["법정동본번코드"] != null)){
      lawed_address += " " + Number(aptData.data[index]["법정동본번코드"])
      if(Number(aptData.data[index]["법정동부번코드"]) != 0){
        lawed_address += "-" + Number(aptData.data[index]["법정동부번코드"])
      }
    }
    else{
      lawed_address += " " + (aptData.data[index]["지번"]).toString()
    }

    var dealed_year = aptData.data[index]["년"]
    var dealed_month = aptData.data[index]["월"]
    var dealed_day = aptData.data[index]["일"]
    if(Number(dealed_month) < 10){dealed_month = "0" + dealed_month}
    if(Number(dealed_day) < 10){dealed_day = "0" + dealed_day}

    var dealed_date = dealed_year + "-" + dealed_month + "-" + dealed_day

    var deal_floor = aptData.data[index]["층"]

    var canceled = aptData.data[index]["해제여부"]
    var canceled_date = aptData.data[index]["해제사유발생일"]

    var dealed_history_date = aptData.data[index]["history_date"]
    var dealed_history_price = aptData.data[index]["history_price"]
    var dealed_history_floor = aptData.data[index]["history_floor"]

    var graph_history_date = aptData.data[index]["graph_history_date"]
    var graph_history_price = aptData.data[index]["graph_history_price"]

    var max_price_deal = aptData.data[index]["max_price"]
    var min_price_deal = aptData.data[index]["min_price_from_2019"]

    var naver_code = ""    
    if(aptData.data[index]["code"] != null){
      naver_code = (aptData.data[index]["code"]).toString()
    }
    var coord_x = aptData.data[index]["x"]
    var coord_y = aptData.data[index]["y"]

    var rank_info = eval(aptData.data[index]["rank_info"])
    
    //타이틀
    //titleHtml += "<div class='popupTitle'>" + aptName + " " + apt_p + "(" + apt_m + ")</div>";
    //titleHtml += "<div class='popupTitle'><a href='#' onclick='return false;' style='text-decoration: none; color: black'>" + aptName + "</a></div>";
    if(deal_new_old == "BYG"){
      titleHtml += "<div class='popupTitle'><h1 style='font-size: 1em; font-weight: 600'>" + aptName + "</h><span style='font-size: 0.75em'> (분양권)</span></div>";
    }
    else{
      titleHtml += "<div class='popupTitle'><h1 style='font-size: 1em; font-weight: 600'>" + aptName + "</h><span style='font-size: 0.75em'> (" + year_gap + "년차)</span></div>";
    }
    if(road_address != ""){
      titleHtml += "<div class='popupSubtitle' style='font-size: 0.6em'>(신) " + road_address + "</div>";
    }
    titleHtml += "<div class='popupSubtitle' style='font-size: 0.6em'>(구) " + lawed_address + "</div>";    

    if(coord_x != null){
      //지도
      detailHtml += "<div class='card'>";      
      detailHtml += "<div class='card-body' style='padding: 0'>";
      if(naver_code != ""){
        go_url = "https://new.land.naver.com/complexes/" + naver_code
        detailHtml += "<div id='part_map_wrap' onClick='goMap(go_url)'>"
      }
      else{
        go_url = "https://m.land.naver.com/map/" + coord_y + ":" + coord_x + ":17:/APT/A1"
        detailHtml += "<div id='part_map_wrap' onClick='goMap(go_url)'>"
      }      
      detailHtml += "<div id='detail_map' ></div>"
      detailHtml += "</div>"
      detailHtml += "</div></div></div>"
    }

    //가격 그래프
    detailHtml += "<div class='card'>";
    detailHtml += "<div class='card-body'>";
    detailHtml += "<div id='popLiving'>"    
    detailHtml += "<div class='popTable'>"
    detailHtml += "<div class='popSubTable'><div class='popContent'>" + "최근 실거래가" + "</div>" + "<div class='popResult' style='color:#eb5050'>" + Korean_price(deal_price_num) + "</div></div>";
    detailHtml += "<div class='popSubTable'><div class='popContent'>" + "최근 실거래일" + "</div>" + "<div class='popResult'>" + dealed_date + "</div></div>";
    detailHtml += "<div class='popSubTable'><div class='popContent'>" + "거래 유형" + "</div>" + "<div class='popResult'>" + deal_type + "</div></div>";
    detailHtml += "<div class='popSubTable'><div class='popContent'>" + "거래 층수" + "</div>" + "<div class='popResult'>" + deal_floor + "층</div></div>";
    detailHtml += "<div class='popSubTable'><div class='popContent'>" + "거래 면적" + "</div>" + "<div class='popResult'>" + "약 " + apt_p.toFixed(0) + "평 (" + apt_m + ")</div></div>";    

    compare_list = compare_price(deal_price_num, max_price_deal, min_price_deal, dealed_history_date, dealed_history_price, dealed_date)    

    if(last_dealed_date == undefined){
      detailHtml += "<div class='popSubTable'><div class='popContent'>" + "직전거래 대비" + "</div>" + "<div class='popResult'>" + compare_last_tag + "<br><span style='font-size:0.8em; color:gray'>" + Korean_price(last_dealed_price) + " (정보없음)</span></div></div>";
    }
    else{
      detailHtml += "<div class='popSubTable'><div class='popContent'>" + "직전거래 대비" + "</div>" + "<div class='popResult'>" + compare_last_tag + "<br><span style='font-size:0.8em; color:gray'>" + Korean_price(last_dealed_price) + " (" + last_dealed_date + ")</span></div></div>";
    }

    
    detailHtml += "<div class='popSubTable'><div class='popContent'>" + "최고가 대비" + "</div>" + "<div class='popResult'>" + compare_max_tag + "<br><span style='font-size:0.8em; color:gray'>" + Korean_price(max_price_deal[1]) + " (" + max_price_deal[0] + ")</span></div></div>";
    detailHtml += "<div class='popSubTable'><div class='popContent'>" + "최저가 대비" + "</div>" + "<div class='popResult'>" + compare_min_tag + "<br><span style='font-size:0.8em; color:gray'>" + Korean_price(min_price_deal[1]) + " (" + min_price_deal[0] + ")</span></div></div>";
    detailHtml += "</div></div></div></div>"

    detailHtml += "<div class='card'>"
    detailHtml += "<div class='card-body'>";
    detailHtml += "<div class='graph' style='height: 120px'> <canvas id='priceChart'></canvas></div>"

    //detailHtml += "<div class='table-responsive' style='max-height: 200px; overflow-y: scroll'>"
    detailHtml += "<div class='table-responsive'>"
        detailHtml += "<table class='table table-striped' style='font-size:0.8em'>"
          detailHtml += "<thead class='table-light' style='position:sticky ;top: 0'>"
            detailHtml += "<tr>"
              detailHtml += "<th scope='col'>" + "계약일자" + "</th>"
              detailHtml += "<th scope='col'>" + "거래금액" + "</th>"
              detailHtml += "<th scope='col'>" + "거래층수" + "</th>"
            detailHtml += "</tr>"
          detailHtml += "</thead>"

          detailHtml += "<tbody>"
              reverse_dealed_history_date = dealed_history_date.reverse()
              reverse_dealed_history_price = dealed_history_price.reverse()
              reverse_dealed_history_floor = dealed_history_floor.reverse()
              if(reverse_dealed_history_date.length > 30){
                history_length = 30
              }
              else{
                history_length = reverse_dealed_history_date.length
              }

              for(var k = 0 ; k < history_length ; k++){
                detailHtml += "<tr>"
                  detailHtml += "<td>" + reverse_dealed_history_date[k] + "</td>"
                  detailHtml += "<td>" + Korean_price(reverse_dealed_history_price[k]) + "</td>"
                  detailHtml += "<td>" + reverse_dealed_history_floor[k] + "층</td>"
                detailHtml += "</tr>"
              }
          detailHtml += "</tbody>"
        detailHtml += "</table>"
        detailHtml += "</div>"

    detailHtml += "</div></div>"

    //Footer에 네이버 부동산 버튼
    footerHtml += "<div class='modal-footer'>"
    //footerHtml += "<div></div>"
    
    if(selectedMonth == 'latest_deal'){
      if(deal_new_old == "BYG"){
        shareTitle_detail = "『" + aptName + " (분양권)』 " + "오늘 등록 실거래 (" + today_short_str + ")\n"
        shareText_detail = "『" + aptName + " (분양권)』 " + "\n오늘 등록 실거래 (" + today_short_str + ")\n"
      }
      else{
        shareTitle_detail = "『" + aptName + " (" + year_gap + "년차)』 " + "오늘 등록 실거래 (" + today_short_str + ")\n"
        shareText_detail = "『" + aptName + " (" + year_gap + "년차)』 " + "\n오늘 등록 실거래 (" + today_short_str + ")\n"
      }
    }
    else{
      if(deal_new_old == "BYG"){
        shareTitle_detail = "『" + aptName + " (분양권)』 " + Number(selectedMonth.substr(4, 2)) +"월 실거래\n"
        shareText_detail = "『" + aptName + " (분양권)』 " + Number(selectedMonth.substr(4, 2)) +"월 실거래\n"
      }
      else{
        shareTitle_detail = "『" + aptName + " (" + year_gap +"년차)』 " + Number(selectedMonth.substr(4, 2)) +"월 실거래\n"
        shareText_detail = "『" + aptName + " (" + year_gap +"년차)』 " + Number(selectedMonth.substr(4, 2)) +"월 실거래\n"
      }
    }    
    shareURL_detail = get_sURL($("#gungu option:selected").val())
    //shareURL_detail = "https://www.realrankus.com/price" + "?preg=" + $("#sido option:selected").val() + "&psub=" + $("#gungu option:selected").val() + "&pmon=" + selectedMonth

    shareText_detail += "ㆍ주소 : " + lawed_address + "\n"
    shareText_detail += "ㆍ실거래가 : " + Korean_price(deal_price_num) + "\n"
    shareText_detail += "ㆍ계약일 : " + dealed_date + " (" + deal_type + ")\n"
    shareText_detail += "ㆍ층,평 : " + deal_floor + "층, (약 " + apt_p.toFixed(0) + "평)\n"
    shareText_detail += "ㆍ직전대비 : " + compare_last_ratio + "\n"
    shareText_detail += "ㆍ직전거래 : " + Korean_price(last_dealed_price) + " (" + last_dealed_date + ")\n"
    shareText_detail += shareURL_detail + "\n\n"
    kakaoShareURL_detail = "https://www.realrankus.com/price" + "?preg=" + $("#sido option:selected").val() + "&psub=" + $("#gungu option:selected").val() + "&pmon=" + selectedMonth + "#aptrank.kr"

    popMsg_detail = "'" + aptName + "'" + " 실거래 정보가 복사되었습니다."
    
    outerLink = aptData.data[index]["sURL"]
    if(coord_x != null){    
      if(naver_code != ""){
        go_button_url = "https://new.land.naver.com/complexes/" + naver_code
      }
      else{
        go_button_url = "https://m.land.naver.com/map/" + coord_y + ":" + coord_x + ":17:/APT/A1"
      }
    }

    if(broswerInfo.indexOf("inApp")>-1){
      if(naver_code != ""){
        footerHtml += "<div><button type='button' class='goLink' onclick='openNaver(" + naver_code + ")'>네이버 부동산 보기</button>"
        if(rank_info[2] != null){
          footerHtml += "<button type='button' class='goLink_aptrank' onclick='goMap(outerLink)'>" + rankAddr + " " + setGrade(rank_info[2]) +" 랭크</button></div>"
        }
        else{
          footerHtml += "</div>"
        }
      }
      else if(coord_x != null){
        footerHtml += "<div><button type='button' class='goLink' onclick='goMap(go_button_url)'>네이버 부동산 보기</button></div>"
      }
      else{
        footerHtml += "<div><button type='button' class='goLink' disabled>연결된 외부 링크가 없어요</button></div>"
      }

      if(checkMobile() == "ios"){
        footerHtml += "<div class='toShare' onClick='share(shareTitle_detail, shareText_detail, shareURL_detail)'><i class='fa-solid fa-arrow-up-right-from-square'></i></div>"
      }
      else{
        footerHtml += "<div class='kakaoShare' onClick='kakaoShare(shareTitle_detail, shareText_detail, kakaoShareURL_detail)'><img src = './kakao_icon.png' height='32px'></div>"            
      }
      
      footerHtml += "<div class='toShare' onClick='CopyToClipboard(shareText_detail, popMsg_detail)'><i class='fa-regular fa-copy'></i></div>"
    }
    else{
      if(naver_code != ""){
        footerHtml += "<div><button type='button' class='goLink' onclick='openNaver(" + naver_code + ")'>네이버 부동산 보기</button>"
          if(rank_info[2] != null){
          footerHtml += "<button type='button' class='goLink_aptrank' onclick='goMap(outerLink)'>" + rankAddr + " " + setGrade(rank_info[2]) +" 랭크</button></div>"
        }
        else{
          footerHtml += "</div>"
        }
      }
      else if(coord_x != null){
        footerHtml += "<div><button type='button' class='goLink' onclick='goMap(go_button_url)'>네이버 부동산 보기</button></div>"
      }
      else{
        footerHtml += "<div><button type='button' class='goLink' disabled>연결된 외부 링크가 없어요</button></div>"
      }

      if(checkMobile() == "ios"){
        footerHtml += "<div class='toShare' onClick='CopyToClipboard(shareText_detail, popMsg_detail)'><i class='fa-regular fa-copy'></i></div>"
      }
      else{
        footerHtml += "<div class='kakaoShare' onClick='kakaoShare(shareTitle, shareText, kakaoShareURL_detail)'><img src = './kakao_icon.png' height='32px'></div>"      
      }
      
      footerHtml += "<div class='toShare' onClick='share(shareTitle_detail, shareText_detail, shareURL_detail)'><i class='fa-solid fa-arrow-up-right-from-square'></i></div>"
      //footerHtml += "<div><button type='button' class='toShare' onClick='CopyToClipboard(shareText_detail, popMsg_detail)' style='background:#ffffff; font-size:1.2em'><i class='fa-regular fa-copy'></i></button></div>"
    }
    footerHtml += "</div>"

    $('#baseModalLabel').html(titleHtml);
    $('#aptDetail').html(detailHtml);
    $('#footer').html(footerHtml);

    if(coord_x != null){
      //지도 그리는 함수
      if ( pcDevice.indexOf(navigator.platform.toLowerCase()) < 0 ) {
        var dw = $(window).width() - 40;
        //var dw = 372;	 
      }
      else{
        var dw = 459;	 
      }    
      var dh = 200;

      var detailMapOptions = {
        center: new naver.maps.LatLng(Number(coord_y), Number(coord_x)),
        size: new naver.maps.Size(dw, dh),
        zoom: 15, //지도의 초기 줌 레벨
        zoomControl: false, //줌 컨트롤의 표시 여부
        draggable: false,
        pinchZoom: false,
        scrollWheel: false,
        keyboardShortcuts: false,
        disableDoubleTapZoom: true,
        disableDoubleClickZoom: true,
        disableTwoFingerTapZoom: true,
      };

      var detailMap = new naver.maps.Map('detail_map', detailMapOptions);    
      
      var detailMarker = new naver.maps.Marker({
          position: new naver.maps.LatLng(Number(coord_y), Number(coord_x)),
          map: detailMap
      });
    }

    //if(broswerInfo.indexOf("inApp")>-1){
    //  $('.modal-footer').css({"grid-template-columns" : "0.2fr 1fr 0.2fr", "text-align":"center", "text-align": "-webkit-center"})
    //}
    //else{
      $('.modal-footer').css({"grid-template-columns" : "1fr 0.15fr 0.15fr", "text-align":"center", "text-align": "-webkit-center"})
    //}

    graph_history_date_short = graph_history_date.slice(-48, -1)
    graph_history_price_short = graph_history_price.slice(-48, -1)
    graph_history_price_short_num = []
    for(var j = 0 ; j < graph_history_price_short.length ; j++){
      graph_history_price_short_num.push((graph_history_price_short[j]/10000).toFixed(2))
    }

    priceMax = Math.max(...graph_history_price_short_num) * 1.3
    drawPriceChart(graph_history_date_short, graph_history_price_short_num, priceMax)
  }


  function updateRegionTable(region){
    $('html').scrollTop(0)
    //$('#sort').css("visibility", "hidden")
    //$('#rearrange').css("visibility", "visible")

    regionName = $("#gungu option:selected").text()
    if(Number(selectedMonth) == this_month){
      shareTitle = "[" + regionName + " " + start_date_str + "~" + end_date_str + " 거래량]"
      shareText = "[" + regionName + " " + start_date_str + "~" + end_date_str + " 거래량]\n\n"
    }
    else{
      shareTitle = "[" + regionName + " " + selectedMonth.substr(0, 4) + "년 " + Number(selectedMonth.substr(4, 2)) + "월 거래량]"
      shareText = "[" + regionName + " " + selectedMonth.substr(0, 4) + "년 " + Number(selectedMonth.substr(4, 2)) + "월 거래량]\n\n"
    }
    //shareURL = "https://www.realrankus.com/price" + "?preg=" + $("#sido option:selected").val() + "&psub=" + $("#gungu option:selected").val() + "&pmon=" + selectedMonth

    url = "https://www.realrankus.com/price/recent/" + selectedMonth + "/sales_volume.json?v=" + Math.random()

    $('#dataList').html("");

    count_Korea = 0
    count_prev_Korea = 0
    sido_count = {}
    sido_prev_count = {}
    gap_count_Korea = 0
    
    sido_gap = {}    
    sido_gap_count = 0
    
    gungu_gap = {}
    gungu_gap_count = 0

    sido_deal_count_this_month = {}
    sido_deal_count_prev_month = {}
    deal_count_Korea_this_month = 0
    deal_count_Korea_prev_month = 0

    for(var k = 0 ; k < count_data['data'].length; k++){
      sido_name = count_data['data'][k]['sido']
      sido_code = count_data['data'][k]['file_name']
      sido_code_arr = sido_code.split("_")
      daily_info = count_data['data'][k]['daily_count']
      daily_BYG_info = count_data['data'][k]['daily_count_BYG']
      daily_gap_info = count_data['data'][k]['region_count']
      deal_count_prev_month = count_data['data'][k]['deal_count_prev_month']
      deal_count_this_month = count_data['data'][k]['deal_count_this_month']

      //sido_gap['gap_count_' + sido_name] = 0 
      //gungu_gap['gap_count_' + sido_code] = 0

      if(sido_deal_count_this_month['count_' + sido_name] == undefined){
        sido_deal_count_this_month['count_' + sido_name] = deal_count_this_month
        sido_deal_count_prev_month['count_' + sido_name] = deal_count_prev_month
      }
      else{
        sido_deal_count_this_month['count_' + sido_name] += deal_count_this_month
        sido_deal_count_prev_month['count_' + sido_name] += deal_count_prev_month
      }

      if(sido_code_arr.length >= 3){
        deal_count_Korea_this_month += deal_count_this_month
        deal_count_Korea_prev_month += deal_count_prev_month
      }
      
      d_count = Number(daily_info[daily_info.length-1][1])
      
      if(daily_info.length == 1){
        d_prev_count = Number(daily_info[daily_info.length-1][1])
      }
      else{
        d_prev_count = Number(daily_info[daily_info.length-2][1])
      }      

      if(sido_count['count_' + sido_name] == undefined){
        sido_count['count_' + sido_name] = d_count
      }
      else{
        sido_count['count_' + sido_name] += d_count
      }
      
      if(sido_prev_count['count_' + sido_name] == undefined){
        sido_prev_count['count_' + sido_name] = d_prev_count
      }
      else{
        sido_prev_count['count_' + sido_name] += d_prev_count
      }      
      
      for(var d = 0 ; d < daily_gap_info.length ; d++){
        if(sido_gap['gap_count_' + sido_name] == undefined){
          sido_gap['gap_count_' + sido_name] = daily_gap_info[d][2]
        }
        else{
          sido_gap['gap_count_' + sido_name] += daily_gap_info[d][2]
        }
        
        if(gungu_gap['gap_count_' + sido_code] == undefined){
          gungu_gap['gap_count_' + sido_code] = daily_gap_info[d][2]
        }
        else{        
          gungu_gap['gap_count_' + sido_code] += daily_gap_info[d][2]
        }
        gap_count_Korea += daily_gap_info[d][2]
      }

      if(sido_code_arr.length >= 3){
        count_Korea += d_count      
        count_prev_Korea += d_prev_count
      }
      //gap_count_Korea += sido_gap['gap_count_' + sido_name]      
    }

    //광고정보 로딩
    $.ajaxSetup({ async: false }); 
    load_parrtnership(region)
    $.ajaxSetup({ async: true });
    
    $.getJSON(url, function(json) {
        regData = json;
        regSortData = regData;
        itemNum = json.data.length;

        shareURL = get_sURL($("#gungu option:selected").val())

        //광고정보표시
        show_partnership()

        for(var i = 0 ; i < itemNum ; i++){
          var regName = regData.data[i]["시군구"]
          var regCode = regData.data[i]["코드"]
          var regSido = (regCode.split("_"))[1]
          var reg_vol_this_month = regData.data[i]["당월"]
          var reg_vol_1month_ago = regData.data[i]["1개월전"]
          var reg_vol_2month_ago = regData.data[i]["2개월전"]
          var reg_vol_3month_ago = regData.data[i]["3개월전"]
          var reg_sURL = regData.data[i]["sURL"]

          if(Number(selectedMonth) == this_month || Number(selectedMonth) == prev_month){
            var reg_vol_month_end_predition = regData.data[i]["월말예측"]
          }

          var reg_vol_yoy = regData.data[i]["전년동월"]
          var reg_ratio_yoy = regData.data[i]["전년동월대비"]

          var reg_vol_3y_avg = regData.data[i]["3년평균"]          
          var reg_ratio_3y_avg = regData.data[i]["3년평균대비"]
          var today_vol = sido_count['count_' + regSido]
          var today_prev_vol = sido_prev_count['count_' + regSido]

          var deal_this_vol = sido_deal_count_this_month['count_' + regSido]
          var deal_prev_vol = sido_deal_count_prev_month['count_' + regSido]

          if(selectedSubRegion == "1000000000_Korea"){
            if((regCode.split("_")).length <= 2){
              var addon_html = "<div class='listBox' onClick='gotoLink(" + i + ")'>";

                addon_html += "<div class='reg_name'>" + regName + "</div>";      

                addon_html += "<div class='volume_content'>"
                  addon_html += "<div class='price_table'>"
                    if(regCode == "1000000000_Korea"){
                      deal_vol = count_Korea.toLocaleString()
                      deal_prev_vol = count_prev_Korea.toLocaleString()
                      count_gap = (count_Korea - count_prev_Korea).toLocaleString()
                      //count_gap = gap_count_Korea                      
                      deal_this_vol = deal_count_Korea_this_month
                      deal_prev_vol = deal_count_Korea_prev_month                      
                    }
                    else{
                      deal_vol = today_vol.toLocaleString()
                      //deal_prev_vol = today_prev_vol.toLocaleString()
                      count_gap = (today_vol - today_prev_vol).toLocaleString()
                      //count_gap = sido_gap['gap_count_' + regSido]
                    }

                    //if(isNaN(deal_vol)){
                    //  addon_html += "<div class='vol_num'>0건</div>" 
                    //}
                    //else{
                      addon_html += "<div class='vol_num'>" + deal_vol + "건</div>" 
                    //}                    
                    /*              
                    if(count_gap == 0){
                      if(Number(selectedMonth) < this_month){
                        addon_html += "<div class='vol_num'>" + deal_vol + "건</div>"                        
                      }
                      else{
                        addon_html += "<div class='vol_num'>" + deal_vol + "건 <span style='font-size: 0.7em'> (변동없음) </span></div>"
                      }
                       
                    }
                    else{
                      addon_html += "<div class='vol_num'>" + deal_vol + "건 <span style='font-size: 0.7em'>(+" + count_gap + ")</span></div>"
                      //addon_html += "<div class='vol_num'>" + deal_vol + "건</div>"
                    }
                    */
                    addon_html += "<div class='compare_volume_sub'>"
                      if(selectedMonth == this_month || selectedMonth == prev_month){
                        addon_html += "<div>월말거래량 예측 </div>" + "<div></div>" + "<div>" + Number(reg_vol_month_end_predition.toFixed(0)).toLocaleString() + "건</div>"
                      }

                      if(reg_ratio_yoy > 0){ reg_ratio_yoy_tag = "<span style='color:#eb5050'>▲" + (Math.abs(reg_ratio_yoy)).toFixed(2) + "%</span>" }
                      else if(reg_ratio_yoy < 0){ reg_ratio_yoy_tag = "<span style='color:#3d7fca'>▼" + (Math.abs(reg_ratio_yoy)).toFixed(2) + "%</span>" }
                      else { reg_ratio_yoy_tag = "<span style='color:black'>= " + (Math.abs(reg_ratio_yoy)).toFixed(2) + "%</span>" }

                      if(reg_ratio_3y_avg > 0){ reg_ratio_3y_avg_tag = "<span style='color:#eb5050'>▲" + (Math.abs(reg_ratio_3y_avg)).toFixed(2) + "%</span>" }
                      else if(reg_ratio_3y_avg < 0){ reg_ratio_3y_avg_tag = "<span style='color:#3d7fca'>▼" + (Math.abs(reg_ratio_3y_avg)).toFixed(2) + "%</span>" }
                      else { reg_ratio_3y_avg_tag = "<span style='color:black'>= " + (Math.abs(reg_ratio_3y_avg)).toFixed(2) + "%</span>" }

                      addon_html += "<div>전년동월 대비</div>" + "<div>" + reg_ratio_yoy_tag + "</div>"  + "<div>" + Number(reg_vol_yoy.toFixed(0)).toLocaleString() + "건</div>"
                      addon_html += "<div>3년평균 대비</div>" + "<div>"  + reg_ratio_3y_avg_tag + "</div>"  + "<div>" + Number(reg_vol_3y_avg.toFixed(0)).toLocaleString() + "건</div>"
                    addon_html += "</div>"
                    
                  addon_html += "<div class='compare_volume'>"
                    addon_html += "<div class='compare_volume_title'>오늘 등록 거래</div>"

                    addon_html += "<div class='column2_2'>"
                      addon_html += "<div>" + Number(today_month) + "월</div><div class='deal_num'>" + deal_this_vol.toLocaleString() + "건</div>"
                    addon_html += "</div>"

                    addon_html += "<div class='column2_2'>"
                      //addon_html += "<div>" + (Number(today_month)-1) + "월</div><div class='deal_num'>" + deal_prev_vol.toLocaleString() + "건</div>"
                      addon_html += "<div>12월</div><div class='deal_num'>" + deal_prev_vol.toLocaleString() + "건</div>"
                    addon_html += "</div>"
                    
                  addon_html += "</div>"
                addon_html += "</div>"
              
              shareText += "『" + regName + "』\n"
              
              if(Number(this_month) == Number(selectedMonth) || Number(prev_month) == Number(selectedMonth) ){
                //shareText += "ㆍ국토부 신규 등록 : " + deal_vol + "건 (+" + count_gap + ")\n"
                shareText += "ㆍ국토부 신규 등록 : " + Number(Number(deal_this_vol) + Number(deal_prev_vol)).toLocaleString() + "건\n"
                //shareText += "ㆍ당월거래량 : " + Number(Number(reg_vol_this_month).toFixed(0)).toLocaleString() + "건\n"
                shareText += "ㆍ월말거래량 예측 : " + Number(Number(reg_vol_month_end_predition).toFixed(0)).toLocaleString() + "건\n"
              }
              else{
                if(reg_ratio_yoy > 0){ reg_ratio_yoy_share = "▲" + (Math.abs(reg_ratio_yoy)).toFixed(2) + "%" }
                else if(reg_ratio_yoy < 0){ reg_ratio_yoy_share = "▼" + (Math.abs(reg_ratio_yoy)).toFixed(2) + "%" }
                else { reg_ratio_yoy_share = "= " + (Math.abs(reg_ratio_yoy)).toFixed(2) + "%" }

                if(reg_ratio_3y_avg > 0){ reg_ratio_3y_avg_share = "▲" + (Math.abs(reg_ratio_3y_avg)).toFixed(2) + "%" }
                else if(reg_ratio_3y_avg < 0){ reg_ratio_3y_avg_share = "▼" + (Math.abs(reg_ratio_3y_avg)).toFixed(2) + "%" }
                else { reg_ratio_3y_avg_share = "= " + (Math.abs(reg_ratio_3y_avg)).toFixed(2) + "%" }
                
                shareText += "ㆍ" + today_year + "년 " + Number(selectedMonth.substr(4, 2)) + "월 거래량 : " + Number(Number(reg_vol_this_month).toFixed(0)).toLocaleString() + "건\n"
                shareText += "ㆍ전년동월 대비 : " + reg_ratio_yoy_share + " (" + Number(reg_vol_yoy.toFixed(0)).toLocaleString() +"건)\n"
                shareText += "ㆍ3년평균 대비 : " + reg_ratio_3y_avg_share + " (" + Number(reg_vol_3y_avg.toFixed(0)).toLocaleString() +"건)\n"                 
              }
              //shareText += "https://www.realrankus.com/price" + "?preg=" + $("#sido option:selected").val() + "&psub=" + regCode + "&pmon=" + selectedMonth + "\n\n"
              shareText +=  reg_sURL + "\n\n"              

              popMsg = "'" + "전체시도" + "'" + " 거래량 정보가 복사되었습니다."

              $('#dataList').append(addon_html);
              //scrollTo(0, lastScrollY_d00)
            }
          }
          else{
            if(regCode.indexOf((selectedSubRegion.split("_"))[1]) >= 0 && regCode.indexOf(selectedSubRegion.substr(0, 2)) >= 0){              
            //if((regCode.split("_")).length > 2 && regCode.indexOf((selectedSubRegion.split("_"))[1]) >= 0 && regCode.indexOf(selectedSubRegion.substr(0, 2)) >= 0){
              var addon_html = "<div class='listBox' onClick='gotoLink(" + i + ")'>";

                if((regCode.split("_")).length == 2){
                  addon_html += "<div class='reg_name'>" + regName + " 전체</div>";
                }
                else{
                  addon_html += "<div class='reg_name'>" + regName + "</div>";
                }                
                for(var j = 0 ; j < count_data['data'].length; j++){
                  searching_region = count_data['data'][j]
                                 
                  if(searching_region['file_name'] == regCode){
                    t_vol_arr = searching_region['daily_count']
                    t_vol = t_vol_arr[t_vol_arr.length-1][1]
                    today_count_prev_month = searching_region['deal_count_prev_month']
                    today_count_this_month = searching_region['deal_count_this_month']
                    
                    if(searching_region['daily_count'].length == 1){
                      t_prev_vol = t_vol_arr[t_vol_arr.length-1][1]
                    }
                    else{
                      t_prev_vol = t_vol_arr[t_vol_arr.length-2][1]
                    }
                    for (var h = 0 ; h < searching_region['region_count'].length ; h++){
                      gungu_gap['gap_count_' + regCode] += searching_region['region_count'][h][2]
                    }
                  }
                }
              
                count_vol_gap = t_vol - t_prev_vol
                //count_vol_gap = gungu_gap['gap_count_' + regCode]

                addon_html += "<div class='volume_content'>"
                  addon_html += "<div class='price_table'>"
                    if(isNaN(t_vol)){
                      addon_html += "<div class='vol_num'>0건</div>" 
                    }
                    else{
                      addon_html += "<div class='vol_num'>" + Number(t_vol).toLocaleString() + "건</div>" 
                    }
                                        
                    /*
                    if(count_vol_gap == 0){
                      if(Number(selectedMonth) != Number(this_month)){
                        addon_html += "<div class='vol_num'>" + Number(t_vol).toLocaleString() + "건</div>"                        
                      }
                      else{
                        addon_html += "<div class='vol_num'>" + Number(t_vol).toLocaleString() + "건 <span style='font-size: 0.7em'>(변동없음)</span></div>"
                      }
                    }
                    else{                      
                      addon_html += "<div class='vol_num'>" + Number(t_vol).toLocaleString() + "건 <span style='font-size: 0.7em'>(+" + count_vol_gap + ")</span></div>"
                      //addon_html += "<div class='vol_num'>" + Number(t_vol).toLocaleString() + "건</div>"
                    }
                    */

                  addon_html += "<div class='compare_volume_sub'>"
                    if( selectedMonth == this_month || selectedMonth == prev_month ){
                      addon_html += "<div>월말거래량 예측 </div>" + "<div></div>" + "<div>" + Number(reg_vol_month_end_predition.toFixed(0)).toLocaleString() + "건</div>"
                    }

                    if(reg_ratio_yoy > 0){ reg_ratio_yoy_tag = "<span style='color:#eb5050'>▲" + (Math.abs(reg_ratio_yoy)).toFixed(2) + "%</span>" }
                    else if(reg_ratio_yoy < 0){ reg_ratio_yoy_tag = "<span style='color:#3d7fca'>▼" + (Math.abs(reg_ratio_yoy)).toFixed(2) + "%</span>" }
                    else { reg_ratio_yoy_tag = "<span style='color:black'>= " + (Math.abs(reg_ratio_yoy)).toFixed(2) + "%</span>" }

                    if(reg_ratio_3y_avg > 0){ reg_ratio_3y_avg_tag = "<span style='color:#eb5050'>▲" + (Math.abs(reg_ratio_3y_avg)).toFixed(2) + "%</span>" }
                    else if(reg_ratio_3y_avg < 0){ reg_ratio_3y_avg_tag = "<span style='color:#3d7fca'>▼" + (Math.abs(reg_ratio_3y_avg)).toFixed(2) + "%</span>" }
                    else { reg_ratio_3y_avg_tag = "<span style='color:black'>= " + (Math.abs(reg_ratio_3y_avg)).toFixed(2) + "%</span>" }

                    addon_html += "<div>전년동월 대비</div>" + "<div>" + reg_ratio_yoy_tag + "</div>"  + "<div>" + Number(reg_vol_yoy.toFixed(0)).toLocaleString() + "건</div>"
                    addon_html += "<div>3년평균 대비</div>" + "<div>"  + reg_ratio_3y_avg_tag + "</div>"  + "<div>" + Number(reg_vol_3y_avg.toFixed(0)).toLocaleString() + "건</div>"
                  addon_html += "</div>"

                  addon_html += "<div class='compare_volume'>"
                    addon_html += "<div class='compare_volume_title'>오늘 등록 거래</div>"

                    addon_html += "<div class='column2_2'>"
                      addon_html += "<div>" + Number(today_month) + "월</div><div class='deal_num'>" + today_count_this_month + "건</div>"
                    addon_html += "</div>"

                    addon_html += "<div class='column2_2'>"
                      addon_html += "<div>" + (Number(today_month)-1) + "월</div><div class='deal_num'>" + today_count_prev_month + "건</div>"
                    addon_html += "</div>"

                  addon_html += "</div>"
                addon_html += "</div>"
              
              shareText += "『" + regName + "』\n"              
              if( this_month == Number(selectedMonth) || prev_month == Number(selectedMonth) ){
                //shareText += "ㆍ국토부 신규 등록 : " + t_vol.toLocaleString() + "건 (+" + count_vol_gap + ")\n"
                shareText += "ㆍ국토부 신규 등록 : " + (today_count_this_month + today_count_prev_month).toLocaleString() + "건\n"                
                //shareText += "ㆍ당월거래량 : " + Number(Number(reg_vol_this_month).toFixed(0)).toLocaleString() + "건\n"
                shareText += "ㆍ월말거래량 예측 : " + Number(Number(reg_vol_month_end_predition).toFixed(0)).toLocaleString() + "건\n"
              }
              else{
                if(reg_ratio_yoy > 0){ reg_ratio_yoy_share = "△" + (Math.abs(reg_ratio_yoy)).toFixed(2) + "%" }
                else if(reg_ratio_yoy < 0){ reg_ratio_yoy_share = "▽" + (Math.abs(reg_ratio_yoy)).toFixed(2) + "%" }
                else { reg_ratio_yoy_share = "= " + (Math.abs(reg_ratio_yoy)).toFixed(2) + "%" }

                if(reg_ratio_3y_avg > 0){ reg_ratio_3y_avg_share = "△" + (Math.abs(reg_ratio_3y_avg)).toFixed(2) + "%" }
                else if(reg_ratio_3y_avg < 0){ reg_ratio_3y_avg_share = "▽" + (Math.abs(reg_ratio_3y_avg)).toFixed(2) + "%" }
                else { reg_ratio_3y_avg_share = "= " + (Math.abs(reg_ratio_3y_avg)).toFixed(2) + "%" }
                
                shareText += "ㆍ" + today_year + "년 " + Number(selectedMonth.substr(4, 2)) + "월 거래량 : " + Number(reg_vol_this_month.toFixed(0)).toLocaleString() + "건\n"
                shareText += "ㆍ전년동월 대비 : " + reg_ratio_yoy_share + " (" + Number(reg_vol_yoy.toFixed(0)).toLocaleString() +"건)\n"
                shareText += "ㆍ3년평균 대비 : " + reg_ratio_3y_avg_share + " (" + Number(reg_vol_yoy.toFixed(0)).toLocaleString() +"건)\n"                
              }
              
              //shareText += "https://www.realrankus.com/price" + "?preg=" + regSido + "&psub=" + regCode + "&pmon=" + selectedMonth + "\n\n"
              shareText +=  reg_sURL + "\n\n"

              popMsg = "'" + regionName + "'" + " 거래량 정보가 복사되었습니다."

              $('#dataList').append(addon_html);              
            }            
          }
        }

        if(isMobile){
          $(".volume_content").css('grid-template-columns', '1fr')
          $(".price_table").css('grid-template-columns', '100px 1fr')
          $(".price_table").css('border-right', '0px')
          $(".price_table").css('border-bottom', '0px')
          $(".price_table").css('margin-top', '5px')
          //$(".price_table").css('margin-bottom', '5px')
          $(".price_table").css('padding-bottom', '5px')
          $(".price_table").css('margin-right', '0px')
          
          $(".vol_num").css('line-height', '1.5em')
          $(".vol_num").css('font-size', '1.1em')
          $(".reg_name").css('font-size', '1em')
          $(".compare_volume_sub").css('font-size', '0.75em')
          $(".compare_volume_sub").css('font-weight', '600')
          $(".compare_volume_sub").css('border-right', '0px')

          $(".compare_volume").css('grid-template-columns', '94px 1fr 1fr')
          $(".compare_volume").css('grid-column', 'span 2')          
          $(".compare_volume").css('padding-left', '0')
          $(".compare_volume").css('margin-top', '6px')
          $(".compare_volume").css('padding-top', '3px')
          $(".compare_volume").css('padding-bottom', '3px')
          $(".compare_volume").css('padding-left', '6px')          
          $(".compare_volume").css('text-align', 'left')
          $(".compare_volume").css('background', '#ededed')
          $(".compare_volume").css('width', '100%')
          $(".compare_volume_title").css('text-align', 'left')
          $(".compare_volume_title").css('border-right', '1px solid #ccc')
          $(".compare_volume_title").css('grid-column', 'span 1')
          $(".deal_num").css('text-align', 'left')
          $(".column2_2").css('padding-left', '15px')
          $(".column2_2").css('border-bottom', '0px')
        }

        $('#dataList').append("<div style='height: " +  blank_height + "'></div>");

        if(selectedSubRegion == "1000000000_Korea"){
          if(lastScrollY_d00 != undefined){
            scrollTo(0, lastScrollY_d00)
            //$('html, body').scrollTop(lastScrollY_d00)
            //$('html, body').animate({scrollTop: lastScrollY_d00}, 0);            
          }          
        }
        else{
          if(lastScrollY_d01 != undefined){
            scrollTo(0, lastScrollY_d01)
            //$('html, body').scrollTop(lastScrollY_d01)
            //$('html, body').animate({scrollTop: lastScrollY_d01}, 0);            
          }
        }
    })
  }

  function show_apt(month, filename, sido){
    $("#sido").val(sido).prop("selected", true);
    selectedMonth = month
    selectedSubRegion = filename
    selectedRegion = $("#sido option:selected").val();

    $("#regionSearchCard").animate({
        opacity: 0.0,
        top: '-150px'
      }, 400, 'easeInQuad'
    );
    $("#closeRegionSearch_floating").animate({
        opacity: 0.0,
        right: '-200px'
      }, 400, 'easeInQuad'
    );
    $('#regionInputSearch').val("")

    $("#rearrangeRegionCard").animate({
        opacity: 0.0,
        top: '-150px'
      }, 400, 'easeInQuad'
    );
    $("#closeRegionRearrange_floating").animate({
        opacity: 0.0,
        right: '-200px'
      }, 400, 'easeInQuad'
    );
    rearrangeSelection = "rearrangeRegionScore"

    $('#baseModal').modal('hide');
    $('#toggleModal1').modal("hide");
    $('#toggleModal2').modal("hide");

    optionChange(filename)    
    updateRegion()
  }

  var pcDevice = "win16|win32|win64|mac|macintel"

  function openNaver(code){
    nURL = "https://new.land.naver.com/complexes/" + code
    if(checkMobile() == "ios"){
      window.location.href = nURL
    }
    else{
      window.open(nURL)
    }
  }

  function openHGNN(code){
    hURL = "https://hogangnono.com/apt/" + code
    if(checkMobile() == "ios"){
      window.location.href = hURL
    }
    else{
      window.open(hURL)
    }
  }

  function showNotice(){
    $(".offcanvas").offcanvas("hide") //offcanvas

    noticePop = true
    var titleHtml = "<div class='popupTitle'> 리얼랭커스PRICE </div>";
    var footerHtml = ""
    var detailHtml = ""

    detailHtml += "<ul>";
    detailHtml += "<li><div class='notice'>리얼랭커스PRICE의 실거래가 정보는 국토부에서 제공되는 정보를 사용합니다.</div></li>";
    detailHtml += "<li><div class='notice'>당월 거래량은 호갱노노 정보를 참조하며, 국토부 등록건수와 상이합니다.</div></li>";
    detailHtml += "<li><div class='notice'>매매 이력은 2019년 1월부터의 정보로 제한하였습니다.</div></li>";
    detailHtml += "<li><div class='notice'>최저가 비교는 2019년 1월부터의 매매거래 내에서 비교합니다.</div></li>";
    detailHtml += "<li><div class='notice'>모든 정보는 일 2회, 오전 6:00와 오후 1:30에 업데이트 합니다.</div></li>";
    detailHtml += "<li><div class='notice'>문의사항, 오류수정, 개선제안은 이메일 또는 카카오톡을 통해 문의해 주세요.</div></li>";    
    detailHtml += "</ul>";

    footerHtml += "<div class='modal-footer'>"    
    footerHtml += " <div id='footerCheck'><input class='form-check-input' type='checkbox' value='' id='flexCheckDefault'><label class='form-check-label' for='flexCheckDefault'><span class='notice'>일주일 동안 보지 않기</span></label></div>"
    if(checkMobile() == 'ios'){
      footerHtml += " <div id='footerBtn1'><button type='button' class='goApt' style='font-size: 0.85em' onClick='openOuterLink(\"https://apps.apple.com/kr/app/%EC%95%84%ED%8C%8C%ED%8A%B8%EB%9E%AD%ED%81%AC/id6448044104\")'>iOS 앱 설치</button></div>"
    }
    else{
      footerHtml += " <div id='footerBtn1'><button type='button' class='goApt' style='font-size: 0.85em' onClick='openOuterLink(\"https://play.google.com/store/apps/details?id=com.aptrank.app\")'>Android 앱 설치</button></div>"
      //footerHtml += " <div><a href='https://open.kakao.com/o/sPYY0LZd' target='_blank'><button type='button' class='gokakao'>카카오톡 문의하기</button></a></div>"    
      footerHtml += " <div id='footerBtn1'><button type='button' class='goApt' style='font-size: 0.85em' onClick='openOuterLink(\"https://apps.apple.com/kr/app/%EC%95%84%ED%8C%8C%ED%8A%B8%EB%9E%AD%ED%81%AC/id6448044104\")'>iOS 앱 설치</button></div>"
    }  
    footerHtml += " <div id='footerBtn3'><button type='button' class='gokakao' style='font-size: 0.85em' onClick='openOuterLink(\"https://pf.kakao.com/_vESNb\")'>카카오톡 채널</button></div>"
    footerHtml += " <div id='footerBtn3'><button type='button' class='gokakao' style='font-size: 0.85em' onClick='openOuterLink(\"https://pf.kakao.com/_vESNb/chat\")'>카카오톡 1:1 문의</button></div>"
    footerHtml += "</div>"      


    $('#baseModalLabel').html(titleHtml);
    $('#aptDetail').html(detailHtml);
    $('#footer').html(footerHtml);

    $('#footerCheck').css({"grid-column" : "span 2", "height" : "2em"})
    if(checkMobile() == 'ios'){
      $('#footerBtn1').css({"grid-column" : "span 2"})
    }
    else{
      $('#footerBtn1').css({"grid-column" : "1fr 1fr"})
    } 
    $('.modal-footer').css({"padding-top" : "3px"})

    if($.cookie('popCookie') != '202303'){
      $('#flexCheckDefault').prop("checked", false)
    }
    else{
      $('#flexCheckDefault').prop("checked", true)
    }

    $('#flexCheckDefault').change(function(){
      if($(this).is(':checked')){
        $.cookie('popCookie', '202303', { expires: 7, path: '/' });
      }
      else{
        $.removeCookie('popCookie', null, { path: '/' });
      }
    })

    $("#baseModal").modal("show"); //offcanvas
  }

  function goMap(url){
      if(checkMobile() == "ios"){
        window.location.href = url
      }
      else{
        window.open(url)
      }    
  }

  function get_sURL(region){
  for (k = 0 ; k < (regData.data).length; k++){
      if(regData.data[k]['코드'] == region){
        return regData.data[k]['sURL']
      }
    }
  }

  function gotoLink(index){
    code = regData.data[index]['코드']
    
    go_region = (code.split('_'))[1]

    if(selectedSubRegion == "1000000000_Korea"){
      aURL = "https://www.realrankus.com/price" + "?preg=Korea&psub=" + code + "&pmon=" + selectedMonth + "#aptrank.kr"
      
      //selectedSubRegion = code      
      //$("#sido").val("Korea").prop("selected", true);
      //$("#gungu").val(code).prop("selected", true);
      //updateRegion()
    }
    else{
      aURL = "https://www.realrankus.com/price" + "?preg=" + go_region + "&psub=" + code + "#aptrank.kr"
      
      //selectedRegion = selectedSubRegion
      //$("#sido").val(go_region).prop("selected", true);
      //$("#gungu").val(code).prop("selected", true);
      //optionChange(code)
      //updateRegion()
    }
    //window.open(aURL)
    window.location = aURL
  }

  function rearrangeList(obj, count){
    selections = obj.id

    if(selections == "rearrangeAll"){
      $(".hidden_saperator").hide()      
      if(itemNum < 80){
        $(".listBox").fadeIn(450)
        $(".date_saperator").slideDown(450)
        $(".date_saperator_web").slideDown(450)
      }
      else{
        $(".listBox").show()
        $(".date_saperator").show()
        $(".date_saperator_web").show()
      }
      //$(".listBox").show()
      //$(".date_saperator").show()
      
      //$(".hidden_saperator").fadeOut(450)
    }
    else if(selections == "rearrangeHighest"){
      $(".listBox").hide()
      $(".date_saperator").hide()
      $(".date_saperator_web").hide()
      $(".hidden_saperator").hide()

      $(".highest").fadeIn(450)
      $(".hidden_saperator_text").html("#신고가 " + count + "건")
      $(".hidden_saperator").slideDown(450)
    }
    else if(selections == "rearrangeLowest"){
      $(".listBox").hide()
      $(".date_saperator").hide()
      $(".date_saperator_web").hide()
      $(".hidden_saperator").hide()

      $(".lowest").fadeIn(450)
      $(".hidden_saperator_text").html("#신저가 " + count + "건")
      $(".hidden_saperator").slideDown(450)
    }
    else if(selections == "rearrangeHigher"){
      $(".listBox").hide()
      $(".date_saperator").hide()
      $(".date_saperator_web").hide()
      $(".hidden_saperator").hide()

      $(".higher").fadeIn(450)
      $(".hidden_saperator_text").html("#상승 " + count + "건")
      $(".hidden_saperator").slideDown(450)
    }
    else if(selections == "rearrangeLower"){
      $(".listBox").hide()
      $(".date_saperator").hide()
      $(".date_saperator_web").hide()
      $(".hidden_saperator").hide()

      $(".lower").fadeIn(450)
      $(".hidden_saperator_text").html("#하락 " + count + "건")
      $(".hidden_saperator").slideDown(450)
    }
  }
</script>
</html>
